<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calcular presupuesto online y solicitar servicio de limpieza en menos de 2 minutos.">
    <link rel="icon" type="image/png" href="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png">
    <title>Calculadora y Solicitud - TeEchoUnaMano TUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
/* ================================================================
   DISEÑO COMPLETAMENTE RESPONSIVE Y OPTIMIZADO PARA MÓVILES
   Calculadora de Limpieza - TeEchoUnaMano TUM
   ================================================================ */

/* === FUNDAMENTOS === */
body {
    font-family: 'Montserrat', sans-serif;
    background: #F5F7FA;
    min-height: 100vh;
    font-size: clamp(15px, 4vw, 17px);
    line-height: 1.6;
    color: #1E293B;
    overflow-x: hidden;
}

* {
    box-sizing: border-box;
}

/* === EFECTOS BASE === */
.glass-effect {
    background: #FFFFFF;
    border: 1px solid #E2E8F0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    border-radius: 8px;
}

/* === BOTONES PRINCIPALES - CORREGIDOS === */
.button-gradient {
    background: #1E3A8A;
    transition: background 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: none;
    color: #FFFFFF;
    min-height: 48px;
    font-size: clamp(15px, 3.5vw, 17px);
    font-weight: 600;
    border-radius: 6px;
    padding: 12px 20px;
    cursor: pointer;
    width: 100%;
    margin-bottom: 12px;
}

.button-gradient:hover {
    background: #1E40AF;
}

.button-gradient:active {
    background: #1E3A8A;
    transform: scale(0.98);
}

.button-secondary {
    background: #64748B;
    transition: background 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: none;
    color: #FFFFFF;
    min-height: 48px;
    font-size: clamp(15px, 3.5vw, 17px);
    font-weight: 600;
    border-radius: 6px;
    padding: 12px 20px;
    cursor: pointer;
    width: 100%;
    margin-bottom: 12px;
}

.button-secondary:hover {
    background: #475569;
}

/* === GRÁFICO === */
.chart-container {
    position: relative;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    height: clamp(220px, 50vw, 280px);
}

/* === CHECKBOXES Y LABELS === */
.checkbox-label {
    transition: all 0.2s ease;
    border-radius: 6px;
    cursor: pointer;
    border: 2px solid #E2E8F0;
    background: #FFFFFF;
    min-height: 48px;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 8px;
}

.checkbox-label:hover {
    background: #F8FAFC;
    border-color: #CBD5E1;
}

input:checked + .checkbox-label {
    background: #EFF6FF;
    border-color: #1E3A8A;
}

.is-selected {
    background: #EFF6FF !important;
    border-color: #1E3A8A !important;
}

/* === CONTROLES DE CONTADOR === */
.count-controls {
    display: flex;
    align-items: center;
    gap: clamp(10px, 3vw, 16px);
    flex-shrink: 0;
}

.count-btn {
    background: #F1F5F9;
    color: #475569;
    width: clamp(40px, 10vw, 48px);
    height: clamp(40px, 10vw, 48px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(16px, 4vw, 20px);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid #E2E8F0;
    flex-shrink: 0;
}

.count-btn:hover {
    background: #1E3A8A;
    color: white;
    border-color: #1E3A8A;
}

.count-btn:active {
    transform: scale(0.95);
}

.count-display {
    width: clamp(44px, 12vw, 56px);
    text-align: center;
    font-weight: 800;
    font-size: clamp(18px, 5vw, 22px);
    color: #1E293B;
    flex-shrink: 0;
}

/* === ELEMENTOS FLOTANTES - CORREGIDOS === */
#floating-elements-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 50;
}

#floating-cart-button {
    background: #1E3A8A;
    color: white;
    border-radius: 50%;
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 3px solid rgba(255, 255, 255, 0.3);
}

#floating-cart-button:hover {
    transform: translateY(-4px) scale(1.08);
    box-shadow: 0 8px 20px rgba(30, 58, 138, 0.5);
    background: #1E40AF;
}

#floating-total-cost-display {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #10B981;
    color: white;
    border-radius: 50%;
    padding: 0.3rem 0.6rem;
    font-size: 0.75rem;
    font-weight: 800;
    display: none;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
}

#floating-total-cost-display.visible {
    display: block;
    animation: pulse 2s infinite;
}

/* === MODAL - TAMAÑO REDUCIDO === */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    visibility: hidden;
    opacity: 0;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
    padding: 12px;
}

.modal-overlay.open {
    visibility: visible;
    opacity: 1;
}

.modal-content {
    background: white;
    border-radius: 8px;
    padding: clamp(14px, 3vw, 20px);
    width: 100%;
    max-width: 500px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    transform: scale(0.95);
    transition: transform 0.2s ease;
    max-height: 85vh;
    overflow-y: auto;
}

.modal-overlay.open .modal-content {
    transform: scale(1);
}

.modal-close-btn {
    background: transparent;
    color: #94a3b8;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    opacity: 0.5;
}

.modal-close-btn:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    transform: rotate(90deg) scale(1.15);
    opacity: 1;
}

.modal-item-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.modal-item-btn {
    background: #F1F5F9;
    color: #475569;
    width: 1.75rem;
    height: 1.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid #E2E8F0;
    font-size: 0.75rem;
}

.modal-item-btn:hover {
    background: #1E3A8A;
    color: white;
    border-color: #1E3A8A;
    transform: scale(1.15);
}

.modal-remove-btn {
    background: transparent;
    color: #ef4444;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    width: 1.75rem;
    height: 1.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.modal-remove-btn:hover {
    color: #dc2626;
    background: #fee2e2;
    transform: scale(1.15);
}

.button {
    display: inline-block;
    padding: 12px 20px;
    font-weight: 600;
    font-size: clamp(15px, 3.5vw, 17px);
    color: #ffffff;
    background: #64748B;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    min-height: 48px;
    width: 100%;
    margin-bottom: 12px;
}

.button:hover {
    background: #475569;
}

/* === TIPOGRAFÍA === */
.main-title {
    font-size: clamp(1.5rem, 6vw, 2.25rem);
    font-weight: 800;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #1E293B;
}

.section-title {
    font-size: clamp(1.25rem, 5vw, 1.875rem);
    font-weight: 700;
    letter-spacing: -0.01em;
    line-height: 1.3;
    color: #1E293B;
}

.card-spacing {
    margin-bottom: 16px;
}

.button-spacing {
    margin-bottom: 12px;
}

/* === CONTENEDORES DE ADDONS - CORREGIDOS === */
.addon-container {
    margin-bottom: 16px;
    border-radius: 8px;
    background: #FFFFFF;
    border: 2px solid #E2E8F0;
    padding: clamp(12px, 3vw, 16px);
    transition: all 0.2s ease;
}

.addon-container:hover {
    border-color: #CBD5E1;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.addon-container h4 {
    color: #1E293B;
    font-weight: 700;
    font-size: clamp(15px, 4vw, 18px);
    margin-bottom: 12px;
}

.addon-group {
    gap: 12px;
    display: flex;
    flex-direction: column;
}

/* === HEADER === */
header {
    background: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 12px 0;
    margin-bottom: 24px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
    gap: 16px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 0;
}

.logo-img {
    width: clamp(44px, 12vw, 56px);
    height: clamp(44px, 12vw, 56px);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
}

.logo-text {
    min-width: 0;
    flex: 1;
}

/* Permitir que el texto del encabezado se ajuste en múltiples líneas en móvil */
.logo-text h1 {
    font-size: clamp(0.9rem, 3.5vw, 1.5rem);
    font-weight: 700;
    color: #1E3A8A;
    margin: 0;
    line-height: 1.2;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.logo-text p {
    font-size: clamp(10px, 2.5vw, 15px);
    color: #64748B;
    margin: 0;
    font-weight: 500;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.header-link {
    background: #1E3A8A;
    color: white;
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    transition: background 0.2s ease;
    border: none;
    font-size: clamp(12px, 3vw, 15px);
    min-height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    white-space: nowrap;
}

.header-link:hover {
    background: #1E40AF;
}

/* Mejorar responsive del header en pantallas muy pequeñas */
@media (max-width: 480px) {
    .header-content {
        gap: 8px;
    }
    
    .logo {
        gap: 8px;
    }
    
    .logo-img {
        width: 40px;
        height: 40px;
    }
    
    .header-link {
        padding: 8px 12px;
        font-size: 11px;
    }
}

/* === FORMULARIOS - CON ESPACIO ADICIONAL PARA EL CARRITO === */
.form-section {
    display: none;
}

.form-section.active {
    display: block;
    /* Añadir espacio adicional en la parte inferior para el carrito */
    padding-bottom: 100px !important;
}

.form-input {
    width: 100%;
    padding: 12px 12px 12px clamp(40px, 10vw, 48px);
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    font-size: clamp(15px, 4vw, 17px);
    font-family: inherit;
    color: #0F172A;
    transition: all 0.2s ease;
    font-weight: 500;
    min-height: 48px;
}

.form-input:focus {
    outline: none;
    border-color: #1E3A8A;
    background: white;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.form-input.error {
    border-color: #EF4444;
    background: #FEF2F2;
}

.error-message {
    display: none;
    color: #EF4444;
    font-size: clamp(12px, 3vw, 14px);
    margin-top: 6px;
    font-weight: 600;
}

.error-message.show {
    display: block;
}

.form-label {
    display: block;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 700;
    color: #0F172A;
    margin-bottom: 8px;
}

.form-group {
    margin-bottom: 20px;
}

/* === MODAL FINAL - TEXTO REDUCIDO PARA MÓVILES === */
.final-summary-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 200;
    visibility: hidden;
    opacity: 0;
    transition: all 0.2s ease;
    padding: 12px;
}

.final-summary-modal.open {
    visibility: visible;
    opacity: 1;
}

.final-summary-content {
    background: white;
    border-radius: 8px;
    padding: clamp(14px, 4vw, 24px);
    width: 100%;
    max-width: 600px;
    max-height: 92vh;
    overflow-y: auto;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.summary-header h2 {
    font-size: clamp(1.1rem, 4.5vw, 1.5rem);
    font-weight: 800;
    color: #1E3A8A;
    margin-bottom: 6px;
    line-height: 1.2;
}

.summary-header p {
    color: #64748B;
    font-size: clamp(12px, 3vw, 14px);
    margin: 0;
    font-weight: 500;
}

.summary-section {
    background: #F8FAFC;
    border-radius: 6px;
    padding: clamp(10px, 2.5vw, 14px);
    margin-bottom: 10px;
    border: 1px solid #E2E8F0;
}

.summary-section-title {
    display: flex;
    align-items: center;
    gap: clamp(6px, 1.5vw, 10px);
    font-size: clamp(13px, 3.5vw, 16px);
    font-weight: 700;
    color: #1E293B;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 2px solid #E2E8F0;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 8px;
    border-radius: 6px;
    flex-wrap: wrap;
}

.summary-section-title:hover {
    background: #F1F5F9;
}

.summary-section-title .edit-icon {
    margin-left: auto;
    font-size: clamp(12px, 3vw, 14px);
    color: #64748B;
    display: flex;
    align-items: center;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.3s ease;
    flex-shrink: 0;
}

.summary-section-title:hover .edit-icon {
    opacity: 1;
}

.edit-icon-text {
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: 600;
    text-transform: uppercase;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px solid #E2E8F0;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item-label {
    font-size: clamp(12px, 3vw, 14px);
    color: #64748B;
    font-weight: 600;
}

.summary-item-value {
    font-size: clamp(13px, 3.5vw, 15px);
    color: #1E293B;
    font-weight: 700;
}

.activation-fee-highlight {
    background: #FEF3C7;
    border: 2px solid #F59E0B;
    border-radius: 6px;
    padding: clamp(10px, 2.5vw, 14px);
    margin-bottom: 10px;
}

.activation-fee-highlight .summary-item-label,
.activation-fee-highlight .summary-item-value {
    color: #92400E;
    font-weight: 800;
}

.summary-total {
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    padding: clamp(12px, 3vw, 16px);
    margin-top: 14px;
    margin-bottom: 14px;
    text-align: center;
}

.summary-total-label {
    font-size: clamp(9px, 2.2vw, 11px);
    font-weight: 700;
    color: #64748B;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.summary-total-value {
    font-size: clamp(1.5rem, 6vw, 2rem);
    font-weight: 900;
    color: #1E3A8A;
    line-height: 1;
    margin-bottom: 10px;
}

.summary-total-per-person {
    background: #EFF6FF;
    border: 1px solid #BFDBFE;
    border-radius: 6px;
    padding: 8px;
    text-align: center;
    font-weight: 700;
    font-size: clamp(12px, 3vw, 14px);
    color: #1E40AF;
    margin-top: 10px;
}

.summary-actions {
    display: flex;
    gap: 8px;
    margin-top: 16px;
    flex-wrap: wrap;
}

.summary-btn {
    flex: 1;
    min-width: 120px;
    padding: clamp(10px, 2.5vw, 14px) clamp(14px, 3.5vw, 18px);
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(13px, 3vw, 15px);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-height: 44px;
}

.summary-btn-cancel {
    background: #F1F5F9;
    color: #475569;
    border: 2px solid #E2E8F0;
}

.summary-btn-cancel:hover {
    background: #E2E8F0;
}

.summary-btn-send {
    background: #10B981;
    color: white;
}

.summary-btn-send:hover {
    background: #059669;
}

/* === TARJETAS DE FORMULARIO === */
.form-card {
    background: white;
    border: 1px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(12px, 3vw, 20px);
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.form-card-header {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2.5vw, 12px);
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #F1F5F9;
}

.form-card-icon {
    width: clamp(32px, 8vw, 40px);
    height: clamp(32px, 8vw, 40px);
    background: #EFF6FF;
    color: #1E3A8A;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(16px, 4vw, 20px);
    border-radius: 8px;
    flex-shrink: 0;
}

.form-card-title {
    font-size: clamp(1rem, 4vw, 1.25rem);
    font-weight: 700;
    color: #1E293B;
    margin: 0;
    line-height: 1.3;
}

.form-input-wrapper {
    position: relative;
    margin-bottom: 12px;
}

.form-input-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: clamp(14px, 3.5vw, 18px);
    color: #64748B;
    pointer-events: none;
}

.form-input-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    margin-bottom: 12px;
}

.cost-display {
    background: #EFF6FF;
    border: 2px solid #BFDBFE;
    border-radius: 8px;
    padding: clamp(16px, 4vw, 24px);
    text-align: center;
    margin-bottom: 20px;
}

.cost-display h3 {
    font-size: clamp(12px, 3vw, 15px);
    color: #64748B;
    font-weight: 700;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.cost-per-person {
    background: white;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    text-align: center;
}

.cost-per-person p:first-child {
    font-size: clamp(11px, 3vw, 13px);
    color: #64748B;
    font-weight: 700;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.cost-per-person p:last-child {
    font-size: clamp(1.5rem, 6vw, 2rem);
    font-weight: 900;
    color: #1E3A8A;
    line-height: 1;
}

.date-selector {
    background: white;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(10px, 2.5vw, 14px);
}

.date-selector-label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: clamp(13px, 3vw, 15px);
    font-weight: 700;
    color: #1E293B;
    margin-bottom: 8px;
}

.date-selector input[type="date"] {
    width: 100%;
    padding: 10px;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    font-size: clamp(14px, 3.5vw, 16px);
    font-family: inherit;
    color: #1E293B;
    background: #F8FAFC;
    transition: all 0.2s ease;
}

.date-selector input[type="date"]:focus {
    outline: none;
    border-color: #1E3A8A;
    background: white;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.form-actions {
    display: flex;
    gap: 8px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.form-btn {
    flex: 1;
    min-width: 120px;
    padding: clamp(10px, 2.5vw, 14px) clamp(14px, 3.5vw, 20px);
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(14px, 3.5vw, 16px);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 44px;
}

.form-btn-back {
    background: white;
    color: #475569;
    border: 2px solid #E2E8F0;
}

.form-btn-back:hover {
    background: #F8FAFC;
    border-color: #CBD5E1;
}

.form-btn-submit {
    background: #1E3A8A;
    color: white;
}

.form-btn-submit:hover {
    background: #1E40AF;
}

.modal-continue-btn {
    width: 100%;
    padding: clamp(12px, 3vw, 16px);
    background: #1E3A8A;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(15px, 4vw, 18px);
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 12px;
    min-height: 50px;
}

.modal-continue-btn:hover {
    background: #1E40AF;
}

.referral-code-display {
    background: #D1FAE5;
    border: 2px solid #10B981;
    border-radius: 8px;
    padding: clamp(12px, 3vw, 16px);
    text-align: center;
    margin-bottom: 16px;
}

.referral-code-display .label {
    font-size: clamp(13px, 3.5vw, 15px);
    font-weight: 700;
    color: #065F46;
    margin-bottom: 6px;
}

.referral-code-display .code {
    font-size: clamp(18px, 4.5vw, 22px);
    font-weight: 900;
    color: #065F46;
    letter-spacing: 0.08em;
}

.referral-input-wrapper {
    background: #D1FAE5;
    border: 2px solid #10B981;
    border-radius: 8px;
    padding: clamp(12px, 3vw, 16px);
    margin-bottom: 16px;
}

.referral-input-wrapper label {
    display: block;
    font-size: clamp(13px, 3.5vw, 15px);
    font-weight: 700;
    color: #065F46;
    margin-bottom: 10px;
    text-align: center;
}

.referral-input-wrapper input {
    width: 100%;
    padding: 12px;
    border: 2px solid #10B981;
    border-radius: 6px;
    font-size: clamp(14px, 3.5vw, 16px);
    font-family: inherit;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    background: white;
    color: #065F46;
    transition: all 0.2s ease;
}

.referral-input-wrapper input:focus {
    outline: none;
    border-color: #059669;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
}

.security-banner {
    background: #EFF6FF;
    border: 2px solid #BFDBFE;
    border-radius: 8px;
    padding: clamp(8px, 2vw, 12px);
    display: flex;
    align-items: center;
    gap: clamp(6px, 2vw, 10px);
    margin-bottom: 16px;
}

.security-banner-icon {
    font-size: clamp(18px, 4.5vw, 24px);
    flex-shrink: 0;
}

.security-banner-content h4 {
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 700;
    color: #1E3A8A;
    margin: 0 0 4px 0;
}

.security-banner-content p {
    font-size: clamp(10px, 2.5vw, 12px);
    color: #64748B;
    margin: 0;
    font-weight: 500;
}

.info-banner {
    background: #FEF3C7;
    border: 2px solid #FCD34D;
    border-radius: 8px;
    padding: clamp(8px, 2vw, 12px);
    display: flex;
    align-items: center;
    gap: clamp(6px, 2vw, 10px);
    margin-top: 12px;
}

.info-banner-icon {
    font-size: clamp(18px, 4.5vw, 24px);
    flex-shrink: 0;
}

.info-banner-content h4 {
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 700;
    color: #92400E;
    margin: 0 0 4px 0;
}

.info-banner-content p {
    font-size: clamp(10px, 2.5vw, 12px);
    color: #78350F;
    margin: 0;
    font-weight: 500;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.pulsing-button {
    animation: pulse 2s infinite ease-in-out;
}

/* === RESPONSIVE - CORREGIDO === */
@media (max-width: 768px) {
    .addon-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-input-group {
        grid-template-columns: 1fr;
    }
    
    /* Mejorar espaciado de botones en móvil */
    .button, .button-gradient, .button-secondary {
        margin-bottom: 10px;
    }
    
    .checkbox-label {
        margin-bottom: 8px;
    }
    
    /* Reducir aún más el texto en móviles pequeños */
    .summary-section-title {
        font-size: clamp(12px, 3.2vw, 14px);
    }
    
    .summary-item-label, .summary-item-value {
        font-size: clamp(11px, 2.8vw, 13px);
    }
    
    .summary-total-value {
        font-size: clamp(1.3rem, 5.5vw, 1.8rem);
    }
    
    /* Añadir más espacio en móviles para el carrito */
    .form-section.active {
        padding-bottom: 120px !important;
    }
    
    /* Corrección específica para el formulario de datos del solicitante */
    #client-form-section .form-card {
        padding: 10px 12px;
    }
    
    #client-form-section .form-card-header {
        margin-bottom: 10px;
    }
    
    #client-form-section .form-input-wrapper {
        margin-bottom: 10px;
    }
    
    #client-form-section .form-input {
        font-size: clamp(14px, 3.5vw, 16px);
        padding: 10px 10px 10px 36px;
    }
    
    #client-form-section .form-input-icon {
        font-size: clamp(14px, 3.5vw, 16px);
        left: 10px;
    }
    
    #client-form-section .form-btn {
        min-height: 42px;
        font-size: clamp(13px, 3.2vw, 15px);
    }
}

/* Estilos adicionales para mejorar la disposición de botones */
@media (min-width: 769px) {
    .addon-group {
        flex-direction: row;
    }
    
    .addon-group .checkbox-label {
        flex: 1;
        min-width: 0;
    }
}

/* === BOTÓN PRINCIPAL CORREGIDO === */
#proceed-to-form-btn {
    background: #1E3A8A;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 14px 20px;
    font-weight: 700;
    font-size: clamp(15px, 3.5vw, 17px);
    cursor: pointer;
    transition: all 0.2s ease;
    min-height: 50px;
    width: 100%;
    margin-bottom: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#proceed-to-form-btn:hover {
    background: #1E40AF;
}

#proceed-to-form-btn:active {
    background: #1E3A8A;
    transform: scale(0.98);
}

/* === ESTILOS ESPECÍFICOS PARA EL RESUMEN DEL CARRITO - TAMAÑO REDUCIDO === */
.modal-summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #E2E8F0;
}

.modal-summary-item:last-child {
    border-bottom: none;
}

.modal-summary-label {
    font-size: clamp(12px, 2.8vw, 14px);
    color: #64748B;
    font-weight: 600;
}

.modal-summary-value {
    font-size: clamp(13px, 3vw, 15px);
    color: #1E293B;
    font-weight: 700;
}

.modal-summary-section {
    background: #F8FAFC;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 8px;
    border: 1px solid #E2E8F0;
}

.modal-summary-section-title {
    font-size: clamp(13px, 3.2vw, 15px);
    font-weight: 700;
    color: #1E293B;
    margin-bottom: 6px;
    padding-bottom: 6px;
    border-bottom: 1px solid #E2E8F0;
}

.modal-summary-total {
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    padding: 12px;
    margin-top: 12px;
    margin-bottom: 12px;
    text-align: center;
}

.modal-summary-total-label {
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: 700;
    color: #64748B;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.modal-summary-total-value {
    font-size: clamp(1.25rem, 5vw, 1.75rem);
    font-weight: 900;
    color: #1E3A8A;
    line-height: 1;
    margin-bottom: 8px;
}

.modal-summary-per-person {
    background: #EFF6FF;
    border: 1px solid #BFDBFE;
    border-radius: 6px;
    padding: 6px;
    text-align: center;
    font-weight: 700;
    font-size: clamp(11px, 2.8vw, 13px);
    color: #1E40AF;
    margin-top: 8px;
}
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png" alt="TeEchoUnaMano Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>TeEchoUnaMano TUM</h1>
                        <p>Servicios de Limpieza Profesional</p>
                    </div>
                </div>
                <a href="https://te-echounamano.blogspot.com" target="_blank" rel="noopener noreferrer" class="header-link">
                    Más información
                </a>
            </div>
        </div>
    </header>

    <!-- Sección de la calculadora -->
    <main class="container mx-auto px-4 py-6 md:py-12" id="calculator-section">
        <div class="text-center mb-12 md:mb-16">
            <div class="relative max-w-7xl mx-auto flex flex-col items-center">
                <div class="flex space-x-4 md:space-x-6 mb-6 md:mb-8 md:absolute md:top-0 md:right-0">
                    <a href="https://te-echounamano.blogspot.com/" target="_blank" title="TUM TeEchoUnaMano Web" class="text-xl md:text-3xl text-gray-700 hover:text-blue-600 transition-all duration-300 hover:scale-110">
                        🏠
                    </a>
                    <a href="https://apm-tum.blogspot.com/" target="_blank" title="Soporte A-TUM" class="text-xl md:text-3xl text-gray-700 hover:text-blue-600 transition-all duration-300 hover:scale-110">
                        🎧
                    </a>
                    <a href="https://t.me/TumAgenda_bot" target="_blank" title="Bot de Telegram" class="text-xl md:text-3xl text-gray-700 hover:text-blue-600 transition-all duration-300 hover:scale-110">
                        🤖
                    </a>
                </div>
                <h1 class="main-title mb-4 md:mb-6">🧹 Calculadora-Limpieza10</h1>
                <p class="text-base md:text-2xl text-gray-700 max-w-4xl mx-auto leading-relaxed px-4 font-medium">La limpieza de tu <b>piso de estudiante</b>, solucionada. Es la forma más fácil y económica de mantener vuestro piso limpio. Personaliza tu plan, comparte los gastos y olvídate de discutir por turnos.</p>
            </div>
        </div>

        <section id="how-it-works" class="mb-16 md:mb-20">
            <div class="max-w-5xl mx-auto">
                <h2 class="section-title text-center mb-12 md:mb-16">¿Cómo Funciona? Sencillo y Transparente</h2>
                <div class="flex flex-col md:flex-row items-stretch justify-center text-center gap-6 md:gap-8">
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-blue-600 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">1</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Una única cuota de <b>10€</b> te da acceso a un servicio de limpieza completo y a medida. Es tu pase directo a un espacio limpio.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-gray-300 md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-blue-600 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">2</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Elige las áreas de tu piso que necesitan un repaso por solo <b>10€</b> cada una y añade los complementos que quieras.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-gray-300 md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-green-600 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">✓</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Disfruta de tu casa impecable y divide el coste total entre tus compañeros de piso. Sin estrés, sin peleas.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="simulator" class="glass-effect rounded-3xl shadow-2xl p-5 md:p-12 mb-16 md:mb-20">
            <h2 class="text-2xl md:text-4xl font-bold text-center mb-3 md:mb-4 text-gray-800">Diseña tu Limpieza a Medida</h2>
            <p class="text-center text-gray-600 text-sm md:text-lg mb-3 md:mb-4 font-medium">Construye tu paquete de limpieza y mira el coste en tiempo real.</p>
            <p class="text-center text-gray-600 italic max-w-3xl mx-auto mb-8 md:mb-12 text-xs md:text-base font-medium">Este servicio está diseñado para una <b>limpieza rápida y eficiente</b>. Si necesitas un servicio más profundo, limpieza de ventanas u otras tareas, ofrecemos planes por hora y presupuestos personalizados. ¡Solo tienes que consultarnos!</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-16">
                <div>
                    <h3 id="areas-section" class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">1. Elige las áreas a limpiar (10€ c/u)</h3>
                    <div class="space-y-3 md:space-y-4 card-spacing">
                        <input type="checkbox" id="salon" class="hidden peer" data-price="10" data-label="Salón / Comedor" data-type="area">
                        <label for="salon" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🛋️</span>
                                <span class="font-semibold text-sm md:text-lg">Salón / Comedor</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                        </label>
                        
                        <input type="checkbox" id="cocina" class="hidden peer" data-price="10" data-label="Cocina" data-type="area">
                        <label for="cocina" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🍳</span>
                                <span class="font-semibold text-sm md:text-lg">Cocina</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                        </label>
                        
                        <div id="bano-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🚿</span>
                                <span class="font-semibold text-sm md:text-lg">Baños</span>
                            </div>
                            <div class="count-controls">
                                <button id="bano-decrement" class="count-btn">-</button>
                                <span id="bano-display" class="count-display">0</span>
                                <button id="bano-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <div id="habitacion-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🛏️</span>
                                <span class="font-semibold text-sm md:text-lg">Habitaciones</span>
                            </div>
                            <div class="count-controls">
                                <button id="habitacion-decrement" class="count-btn">-</button>
                                <span id="habitacion-display" class="count-display">0</span>
                                <button id="habitacion-increment" class="count-btn">+</button>
                            </div>
                        </div>

                        <input type="checkbox" id="lavanderia" class="hidden peer" data-price="10" data-label="Lavandería" data-type="area">
                        <label for="lavanderia" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🧺</span>
                                <span class="font-semibold text-sm md:text-lg">Lavandería</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                        </label>

                        <input type="checkbox" id="terrazas" class="hidden peer" data-price="10" data-label="Limpieza de Terrazas" data-type="area">
                        <label for="terrazas" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">☀️</span>
                                <span class="font-semibold text-sm md:text-lg">Limpieza de Terrazas</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                        </label>
                    </div>

                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 mt-8 md:mt-10 text-gray-800">2. Añade complementos</h3>
                    <div class="space-y-4 md:space-y-6">
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">🚪</span>
                                <span class="text-sm md:text-lg">Pasillo (área común)</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="pasillo">
                                <input type="checkbox" id="pasillo-5" class="hidden peer" data-price="5" data-label="Pasillo: menos de 5m²" data-type="addon">
                                <label for="pasillo-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">Menos de 5m²</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="pasillo-10" class="hidden peer" data-price="10" data-label="Pasillo: 5m² o más" data-type="addon">
                                <label for="pasillo-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">5m² o más</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">🍽️</span>
                                <span class="text-sm md:text-lg">Fregar Platos</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="platos">
                                <input type="checkbox" id="platos-5" class="hidden peer" data-price="5" data-label="Fregar Platos: 1 carga" data-type="addon">
                                <label for="platos-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1 Carga</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="platos-10" class="hidden peer" data-price="10" data-label="Fregar Platos: Más de 1 carga" data-type="addon">
                                <label for="platos-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">Más de 1 Carga</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">🪟</span>
                                <span class="text-sm md:text-lg">Limpieza de Mamparas</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="mamparas">
                                <input type="checkbox" id="mamparas-5" class="hidden peer" data-price="5" data-label="Mamparas: 1-2m" data-type="addon">
                                <label for="mamparas-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1-2m</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="mamparas-10" class="hidden peer" data-price="10" data-label="Mamparas: Más de 2m" data-type="addon">
                                <label for="mamparas-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">Más de 2m</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">🗑️</span>
                                <span class="text-sm md:text-lg">Recogida de Basura</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="basura">
                                <input type="checkbox" id="basura-5" class="hidden peer" data-price="5" data-label="Recogida de Basura: 1-2 bolsas" data-type="addon">
                                <label for="basura-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1-2 bolsas</span>
                                    <span class="text-xs md:text-sm text-gray-500 mb-1 font-medium">(Obligatorio con áreas)</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="basura-10" class="hidden peer" data-price="10" data-label="Recogida de Basura: Más de 2 bolsas" data-type="addon">
                                <label for="basura-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">Más de 2 bolsas</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <input type="checkbox" id="escalera" class="hidden peer" data-price="10" data-label="Limpieza de Escalera" data-type="addon">
                        <label for="escalera" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">🪜</span>
                                <span class="font-semibold text-sm md:text-lg">Limpieza de Escalera</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10€</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">3. ¿Cuántos sois en el piso?</h3>
                    <p class="text-gray-600 text-sm md:text-base mb-4 md:mb-6 font-medium">Si pagas el servicio para ti, selecciona 1 persona. Si sois más, selecciona el número de compañeros para dividir los gastos.</p>
                    <div id="roommates-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300 mb-6 md:mb-8">
                        <div class="flex items-center">
                            <span class="text-2xl md:text-3xl mr-3 md:mr-4">👥</span>
                            <span class="font-semibold text-sm md:text-lg">Compañeros</span>
                        </div>
                        <div class="count-controls">
                            <button id="roommates-decrement" class="count-btn">-</button>
                            <span id="roommates-count" class="count-display">1</span>
                            <button id="roommates-increment" class="count-btn">+</button>
                        </div>
                    </div>

                    <div class="sticky top-6">
                        <div class="grid grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                            <div class="p-5 md:p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl text-center border-2 border-blue-200">
                                <p class="text-gray-600 text-xs md:text-sm font-bold mb-2 uppercase tracking-wide">COSTE TOTAL</p>
                                <p id="total-cost" class="text-3xl md:text-4xl font-extrabold text-blue-600">0 €</p>
                            </div>
                            <div class="p-5 md:p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-2xl text-center border-2 border-green-200">
                                <p class="text-gray-600 text-xs md:text-sm font-bold mb-2 uppercase tracking-wide">POR PERSONA</p>
                                <p id="cost-per-person" class="text-3xl md:text-4xl font-extrabold text-green-600">0,00 €</p>
                            </div>
                        </div>

                        <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-center text-gray-800">Desglose del Coste</h3>
                        <div class="chart-container">
                            <canvas id="costBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center mt-12 md:mt-16 mb-16 md:mb-20">
            <h3 class="text-2xl md:text-4xl font-bold mb-4 md:mb-6 text-gray-800">¿Todo claro?</h3>
            <p class="text-gray-700 mb-8 md:mb-10 max-w-2xl mx-auto text-sm md:text-lg leading-relaxed px-4 font-medium">Ahora completa tus datos para solicitar tu primera limpieza y descubre lo fácil que es tener un piso impecable.</p>
            
            <!-- Campo de código de referido destacado con estilo premium -->
            <div class="max-w-md mx-auto mb-6 md:mb-8 px-4">
                <div class="referral-input-wrapper">
                    <label for="main-coupon-code">🎟️ ¿Tienes un código de referido?</label>
                    <div class="button-spacing">
                        <a class="button" href="https://teechounamano.github.io/activar-referido/" target="_blank" rel="noopener noreferrer" title="Activar Cupón">Quiero mi código</a>
                    </div>
                    <input type="text" id="main-coupon-code" placeholder="ESCRIBE TU CÓDIGO AQUÍ">
                </div>
            </div>

            <button id="proceed-to-form-btn" class="pulsing-button">Rellenar Datos del Cliente para la Solicitud</button>
        </footer>
    </main>

    <!-- Sección del formulario con banner de seguridad -->
    <section class="form-section container mx-auto px-4 py-6 md:py-12" id="client-form-section">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8 md:mb-12">
                <div class="inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-white rounded-3xl shadow-2xl mb-6 text-4xl md:text-5xl">
                    📋
                </div>
                <h2 class="text-3xl md:text-5xl font-bold text-gray-800 mb-3 md:mb-4">Datos del Solicitante</h2>
                <p class="text-gray-700 text-base md:text-xl max-w-2xl mx-auto font-medium">Completa tu información para procesar la solicitud de limpieza</p>
            </div>

            <!-- Banner de seguridad para tranquilizar al usuario -->
            <div class="security-banner">
                <div class="security-banner-icon">🔒</div>
                <div class="security-banner-content">
                    <h4>Tus datos están seguros</h4>
                    <p>Toda tu información está protegida y solo se usa para coordinar tu servicio de limpieza.</p>
                </div>
            </div>

            <form id="client-form">
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">👤</div>
                        <h3 class="form-card-title">Información Personal</h3>
                    </div>
                    
                    <div class="form-input-wrapper">
                        <div class="form-input-icon">✍️</div>
                        <input type="text" id="nombre" class="form-input" placeholder="Tu nombre completo" required>
                        <div class="error-message" id="errorNombre">Por favor, ingresa tu nombre completo</div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">🏠</div>
                        <h3 class="form-card-title">Dirección del Servicio</h3>
                    </div>
                    
                    <div class="form-input-wrapper">
                        <div class="form-input-icon">📍</div>
                        <input type="text" id="calle" class="form-input" placeholder="Calle y número (Ej: Calle Mayor, 123)" required>
                        <div class="error-message" id="errorCalle">Por favor, ingresa la calle y número</div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-input-wrapper">
                            <div class="form-input-icon">🚪</div>
                            <input type="text" id="portal" class="form-input" placeholder="Portal" required>
                            <div class="error-message" id="errorPortal">Requerido</div>
                        </div>

                        <div class="form-input-wrapper">
                            <div class="form-input-icon">🔢</div>
                            <input type="text" id="piso" class="form-input" placeholder="Piso" required>
                            <div class="error-message" id="errorPiso">Requerido</div>
                        </div>

                        <div class="form-input-wrapper">
                            <div class="form-input-icon">🚪</div>
                            <input type="text" id="puerta" class="form-input" placeholder="Puerta" required>
                            <div class="error-message" id="errorPuerta">Requerido</div>
                        </div>
                    </div>

                    <div class="info-banner">
                        <div class="info-banner-icon">ℹ️</div>
                        <div class="info-banner-content">
                            <h4>Valencia capital</h4>
                            <p>La visita es <strong>gratuita y sin compromiso</strong>. Nos desplazamos a tu domicilio para evaluar el servicio.</p>
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">📅</div>
                        <h3 class="form-card-title">Fechas Disponibles</h3>
                    </div>
                    
                    <p class="text-gray-600 text-sm md:text-base mb-4 md:mb-6 font-medium">Selecciona dos opciones de fecha para coordinar la visita. Nos pondremos en contacto contigo para confirmar.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="date-selector">
                            <div class="date-selector-label">
                                <span>📆</span>
                                <span>Primera opción</span>
                            </div>
                            <input type="date" id="fecha1" required>
                            <div class="error-message" id="errorFecha1">Selecciona la primera fecha</div>
                        </div>

                        <div class="date-selector">
                            <div class="date-selector-label">
                                <span>📆</span>
                                <span>Segunda opción</span>
                            </div>
                            <input type="date" id="fecha2" required>
                            <div class="error-message" id="errorFecha2">Selecciona la segunda fecha</div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="back-to-calculator-btn" class="form-btn form-btn-back">
                        <span>←</span>
                        <span>Volver a la Calculadora</span>
                    </button>
                    <button type="submit" class="form-btn form-btn-submit">
                        <span>Ver Resumen Completo</span>
                        <span>→</span>
                    </button>
                </div>
            </form>
        </div>
    </section>

    <div id="floating-elements-container">
        <button id="floating-cart-button" aria-label="Mostrar resumen de costes">
            <span style="font-size: 1.5rem;">🛒</span>
            <span id="floating-total-cost-display">0 €</span>
        </button>
    </div>

    <!-- Modal de resumen simplificado - solo botón X para cerrar -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center pb-4 border-b-2 border-gray-200 mb-4">
                <h3 class="text-lg md:text-xl font-bold text-gray-800">Resumen de mi pedido</h3>
                <button id="close-modal-button" class="modal-close-btn" aria-label="Cerrar">
                    ✕
                </button>
            </div>
            
            <div>
                <div id="summary-list" class="space-y-2 max-h-48 md:max-h-60 overflow-y-auto pr-2">
                    <p class="text-gray-500 text-center py-4 text-sm font-medium">Aún no has añadido nada. ¡Empieza a configurar tu limpieza!</p>
                </div>
            </div>

            <div id="modal-roommates-container" class="mt-4 p-3 border-2 border-gray-200 rounded-xl transition-all duration-300">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                        <span class="text-xl md:text-2xl mr-2">👥</span>
                        <span class="font-semibold text-sm md:text-base">Compañeros</span>
                    </div>
                    <div class="count-controls">
                        <button id="modal-roommates-decrement" class="count-btn">-</button>
                        <span id="modal-roommates-count" class="count-display">1</span>
                        <button id="modal-roommates-increment" class="count-btn">+</button>
                    </div>
                </div>
                <div class="text-center font-bold text-base md:text-lg text-green-600">
                    <span id="modal-cost-per-person">0,00 €</span> por persona
                </div>
            </div>

            <!-- Campo de código de referido destacado en el modal -->
            <div class="mt-4">
                <div class="referral-input-wrapper">
                    <label for="coupon-code">🎟️ ¿Tienes un código de referido?</label>
                    <input type="text" id="coupon-code" placeholder="ESCRIBE TU CÓDIGO AQUÍ">
                </div>
            </div>

            <div class="mt-4 flex justify-between items-center font-bold text-base md:text-lg">
                <span class="text-gray-800">Total:</span>
                <span id="summary-total" class="text-blue-600 text-xl md:text-2xl">0,00 €</span>
            </div>

            <button id="modal-proceed-to-form-btn" class="modal-continue-btn">
                Continuar con los Datos del Cliente →
            </button>
        </div>
    </div>

    <!-- Modal de resumen final con cuota de activación y código de referido destacados -->
    <div id="final-summary-modal" class="final-summary-modal">
        <div class="final-summary-content">
            <!-- Añadiendo botón X sutil para cerrar el modal de resumen final -->
            <div class="flex justify-between items-start mb-4">
                <div class="summary-header" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none; text-align: left; flex: 1;">
                    <h2>✨ Resumen de tu Solicitud</h2>
                    <p>Revisa todos los detalles antes de enviar</p>
                </div>
                <button onclick="document.getElementById('final-summary-modal').classList.remove('open')" class="modal-close-btn" aria-label="Cerrar" style="flex-shrink: 0; margin-left: 1rem;">
                    ✕
                </button>
            </div>

            <!-- Banner de seguridad en el resumen final -->
            <div class="security-banner" style="margin-bottom: 1.5rem;">
                <div class="security-banner-icon">🔒</div>
                <div class="security-banner-content">
                    <h4>Información protegida</h4>
                    <p>Tus datos están seguros con nosotros</p>
                </div>
            </div>

            <!-- Código de referido destacado con gradiente verde esmeralda -->
            <div id="referral-code-section" class="referral-code-display" style="display: none;">
                <div class="label">🎟️ Código de Referido</div>
                <div class="code" id="final-referral-code">-</div>
            </div>

            <!-- Sección de servicios con icono de edición interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('services')" role="button" tabindex="0">
                    <span>🧹</span>
                    <span>Servicios Seleccionados</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                </div>
                <div id="final-services-list"></div>
            </div>

            <!-- Cuota de activación destacada con gradiente dorado -->
            <div class="activation-fee-highlight">
                <div class="summary-item">
                    <span class="summary-item-label">💳 Cuota de Activación</span>
                    <span class="summary-item-value" id="final-activation-fee">10 €</span>
                </div>
            </div>

            <!-- Sección de datos del cliente con icono de edición interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('client-data')" role="button" tabindex="0">
                    <span>👤</span>
                    <span>Datos del Cliente</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Nombre</span>
                    <span class="summary-item-value" id="final-nombre">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Dirección</span>
                    <span class="summary-item-value" id="final-direccion">-</span>
                </div>
            </div>

            <!-- Sección de fechas con icono de edición interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('dates')" role="button" tabindex="0">
                    <span>📅</span>
                    <span>Fechas Disponibles</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Primera opción</span>
                    <span class="summary-item-value" id="final-fecha1">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Segunda opción</span>
                    <span class="summary-item-value" id="final-fecha2">-</span>
                </div>
            </div>

            <div class="summary-total">
                <div class="summary-total-label">Coste Total del Servicio</div>
                <div class="summary-total-value" id="final-total-cost">0 €</div>
                <div class="summary-total-per-person">
                    <span id="final-cost-per-person">0,00 €</span> por persona (<span id="final-roommates-count">1</span> compañero<span id="final-roommates-plural">s</span>)
                </div>
            </div>

            <div class="summary-actions">
                <button type="button" id="cancel-final-summary-btn" class="summary-btn summary-btn-cancel">
                    <span>✕</span>
                    <span>Cancelar</span>
                </button>
                <button type="button" id="send-whatsapp-btn" class="summary-btn summary-btn-send">
                    <span>📱</span>
                    <span>Enviar Solicitud por WhatsApp</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const ACTIVATION_FEE = 10;
        const WHATSAPP_NUMBER = '34602846694';

        const state = {
            banoCount: 0,
            habitacionCount: 0,
            roommatesCount: 1,
            selectedItems: {},
            totalCost: 0,
            costPerPerson: 0,
            currentSection: 'calculator',
            referralCode: ''
        };

        const totalCostDisplay = document.getElementById('total-cost');
        const costPerPersonDisplay = document.getElementById('cost-per-person');
        const floatingCostDisplay = document.getElementById('floating-total-cost-display');
        const summaryList = document.getElementById('summary-list');
        const summaryTotal = document.getElementById('summary-total');
        const modalCostPerPerson = document.getElementById('modal-cost-per-person');
        const modal = document.getElementById('summary-modal');
        const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
        const addonGroups = document.querySelectorAll('.addon-group');
        let costChart;

        const formatCurrency = (value, useDecimals = false) => {
            const options = useDecimals ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : { minimumFractionDigits: 0, maximumFractionDigits: 0 };
            return value.toLocaleString('es-ES', options) + ' €';
        };

        const formatDate = (dateString) => {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        const updateUI = () => {
            totalCostDisplay.textContent = formatCurrency(state.totalCost);
            costPerPersonDisplay.textContent = formatCurrency(state.costPerPerson, true);
            summaryTotal.textContent = formatCurrency(state.totalCost, true);
            modalCostPerPerson.textContent = formatCurrency(state.costPerPerson, true);

            if (state.totalCost > 0) {
                floatingCostDisplay.textContent = formatCurrency(state.totalCost);
                floatingCostDisplay.classList.add('visible');
            } else {
                floatingCostDisplay.classList.remove('visible');
            }

            document.getElementById('bano-display').textContent = state.banoCount;
            document.getElementById('habitacion-display').textContent = state.habitacionCount;
            document.getElementById('roommates-count').textContent = state.roommatesCount;
            document.getElementById('modal-roommates-count').textContent = state.roommatesCount;

            document.getElementById('bano-container').classList.toggle('is-selected', state.banoCount > 0);
            document.getElementById('habitacion-container').classList.toggle('is-selected', state.habitacionCount > 0);
            
            updateSummaryList();
            updateChart();
        };
        
        const updateSummaryList = () => {
            summaryList.innerHTML = '';

            if (state.totalCost === 0) {
                summaryList.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm font-medium">Aún no has añadido nada. ¡Empieza a configurar tu limpieza!</p>';
                return;
            }

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area').sort((a,b) => a.label.localeCompare(b.label));
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon').sort((a,b) => a.label.localeCompare(b.label));

            const createItemNode = (item) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'modal-summary-item';
                
                let controls = '';
                if (item.id === 'bano' || item.id === 'habitacion') {
                    controls = `
                        <div class="modal-item-controls">
                            <button class="modal-item-btn" data-action="decrement" data-id="${item.id}">-</button>
                            <span class="font-bold w-6 text-center text-sm">${item.quantity}</span>
                            <button class="modal-item-btn" data-action="increment" data-id="${item.id}">+</button>
                        </div>
                    `;
                } else {
                    controls = `<button class="modal-remove-btn" data-action="remove" data-id="${item.id}">🗑️</button>`;
                }
                
                const totalItemPrice = item.price * (item.quantity || 1);

                itemElement.innerHTML = `
                    <div class="flex-grow pr-2">
                        <p class="modal-summary-label">${item.label}</p>
                        ${item.quantity > 1 ? `<p class="text-xs text-gray-500 font-medium">${item.quantity} x ${formatCurrency(item.price)}</p>` : ''}
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="modal-summary-value">${formatCurrency(totalItemPrice)}</span>
                        ${controls}
                    </div>
                `;
                return itemElement;
            };

            if (areas.length > 0) {
                const container = document.createElement('div');
                container.className = 'modal-summary-section';
                const title = document.createElement('h4');
                title.className = 'modal-summary-section-title';
                title.textContent = 'Áreas';
                container.appendChild(title);
                areas.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            if (addons.length > 0) {
                const container = document.createElement('div');
                container.className = 'modal-summary-section';
                const title = document.createElement('h4');
                title.className = 'modal-summary-section-title';
                title.textContent = 'Complementos';
                container.appendChild(title);
                addons.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            const feeContainer = document.createElement('div');
            feeContainer.className = 'modal-summary-section';
            feeContainer.style.background = '#FEF3C7';
            feeContainer.style.border = '2px solid #F59E0B';
            feeContainer.innerHTML = `
                <div class="modal-summary-item">
                    <p class="modal-summary-label" style="color: #92400E; font-weight: 800;">💳 Cuota de activación</p>
                    <span class="modal-summary-value" style="color: #92400E; font-weight: 800;">${formatCurrency(ACTIVATION_FEE)}</span>
                </div>
            `;
            summaryList.appendChild(feeContainer);
        };

        const updateChart = () => {
            if (!costChart) return;
            
            const hasItems = Object.keys(state.selectedItems).length > 0 || state.totalCost > 0;
            const labels = [];
            const data = [];
            const colors = [];

            if (hasItems) {
                labels.push('Cuota Fija');
                data.push(ACTIVATION_FEE);
                colors.push('#f59e0b');
            }

            const areasCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'area')
                .reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

            if (areasCost > 0) {
                labels.push('Áreas');
                data.push(areasCost);
                colors.push('#1E3A8A');
            }

            const addonsCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'addon')
                .reduce((sum, item) => sum + item.price, 0);

            if (addonsCost > 0) {
                labels.push('Complementos');
                data.push(addonsCost);
                colors.push('#64748B');
            }

            if (data.length === 0) {
                costChart.data.labels = ['Vacío'];
                costChart.data.datasets[0].data = [1];
                costChart.data.datasets[0].backgroundColor = ['#e5e7eb'];
            } else {
                costChart.data.labels = labels;
                costChart.data.datasets[0].data = data;
                costChart.data.datasets[0].backgroundColor = colors;
            }

            costChart.update();
        };

        const calculateTotal = () => {
            const hasArea = Object.values(state.selectedItems).some(item => item.type === 'area');
            const hasGarbage = state.selectedItems['basura-5'] || state.selectedItems['basura-10'];

            if (hasArea && !hasGarbage) {
                const garbageCheckbox = document.getElementById('basura-5');
                if (garbageCheckbox) {
                    state.selectedItems['basura-5'] = {
                        id: 'basura-5',
                        price: parseFloat(garbageCheckbox.dataset.price),
                        label: garbageCheckbox.dataset.label,
                        type: 'addon'
                    };
                    garbageCheckbox.checked = true;
                }
            }

            let subtotal = 0;
            const items = Object.values(state.selectedItems);

            items.forEach(item => {
                const quantity = item.quantity || 1;
                subtotal += item.price * quantity;
            });
            
            if (items.length > 0) {
                state.totalCost = ACTIVATION_FEE + subtotal;
            } else {
                state.totalCost = 0;
            }
            
            state.costPerPerson = state.totalCost > 0 ? state.totalCost / state.roommatesCount : 0;
            updateUI();
        };
        
        const handleCheckboxChange = (e) => {
            const checkbox = e.target;
            const id = checkbox.id;
            const price = parseFloat(checkbox.dataset.price);
            const label = checkbox.dataset.label;
            const type = checkbox.dataset.type;
            const groupContainer = checkbox.closest('.addon-group');

            if (groupContainer) {
                const groupName = groupContainer.dataset.groupName;
                const otherCheckboxes = groupContainer.querySelectorAll(`input[type="checkbox"]:not(#${id})`);
                
                if (checkbox.checked) {
                    otherCheckboxes.forEach(other => {
                        if (other.checked) {
                            other.checked = false;
                            delete state.selectedItems[other.id];
                        }
                    });
                }
            }
            
            if (checkbox.checked) {
                state.selectedItems[id] = { id, price, label, type };
            } else {
                delete state.selectedItems[id];
            }

            calculateTotal();
        };

        const setupCounter = (id, stateKey, min, max, label, price, type) => {
            const decrementBtn = document.getElementById(`${id}-decrement`);
            const incrementBtn = document.getElementById(`${id}-increment`);
            const display = document.getElementById(`${id}-display`);

            const update = (newValue) => {
                newValue = Math.max(min, Math.min(newValue, max));
                state[stateKey] = newValue;
                
                if (label && price) {
                    const itemId = id;
                    if (newValue > 0) {
                        state.selectedItems[itemId] = {
                            id: itemId,
                            price: price,
                            label: label,
                            type: type,
                            quantity: newValue
                        };
                    } else {
                        delete state.selectedItems[itemId];
                    }
                }
                calculateTotal();
            };

            decrementBtn.addEventListener('click', () => update(state[stateKey] - 1));
            incrementBtn.addEventListener('click', () => update(state[stateKey] + 1));
        };

        setupCounter('bano', 'banoCount', 0, 10, 'Baños', 10, 'area');
        setupCounter('habitacion', 'habitacionCount', 0, 10, 'Habitaciones', 10, 'area');
        setupCounter('roommates', 'roommatesCount', 1, 20);
        setupCounter('modal-roommates', 'roommatesCount', 1, 20);

        allCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', handleCheckboxChange);
        });

        document.getElementById('floating-cart-button').addEventListener('click', () => {
            modal.classList.add('open');
        });

        document.getElementById('close-modal-button').addEventListener('click', () => {
            modal.classList.remove('open');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('open');
            }
        });

        summaryList.addEventListener('click', (e) => {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            const id = button.dataset.id;

            if (action === 'remove') {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = false;
                    delete state.selectedItems[id];
                    calculateTotal();
                }
            } else if (action === 'increment' || action === 'decrement') {
                const stateKey = id === 'bano' ? 'banoCount' : 'habitacionCount';
                const delta = action === 'increment' ? 1 : -1;
                const newValue = Math.max(0, Math.min(10, state[stateKey] + delta));
                
                if (newValue === 0) {
                    delete state.selectedItems[id];
                } else {
                    state.selectedItems[id].quantity = newValue;
                }
                
                state[stateKey] = newValue;
                calculateTotal();
            }
        });

        const mainCouponInput = document.getElementById('main-coupon-code');
        const modalCouponInput = document.getElementById('coupon-code');

        // Sincronizar cuando se escribe en el campo principal
        mainCouponInput.addEventListener('input', (e) => {
            const value = e.target.value.toUpperCase();
            modalCouponInput.value = value;
            state.referralCode = value.trim();
        });

        // Sincronizar cuando se escribe en el campo del modal
        modalCouponInput.addEventListener('input', (e) => {
            const value = e.target.value.toUpperCase();
            mainCouponInput.value = value;
            state.referralCode = value.trim();
        });

        document.getElementById('proceed-to-form-btn').addEventListener('click', () => {
            if (state.totalCost === 0) {
                alert('Por favor, selecciona al menos un servicio antes de continuar.');
                document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const mainCouponCode = document.getElementById('main-coupon-code').value.trim().toUpperCase();
            if (mainCouponCode) {
                state.referralCode = mainCouponCode;
            }

            document.getElementById('calculator-section').style.display = 'none';
            document.getElementById('client-form-section').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('modal-proceed-to-form-btn').addEventListener('click', () => {
            if (state.totalCost === 0) {
                alert('Por favor, selecciona al menos un servicio antes de continuar.');
                modal.classList.remove('open');
                document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const couponCode = document.getElementById('coupon-code').value.trim().toUpperCase();
            if (couponCode) {
                state.referralCode = couponCode;
            }

            modal.classList.remove('open');
            document.getElementById('calculator-section').style.display = 'none';
            document.getElementById('client-form-section').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('back-to-calculator-btn').addEventListener('click', () => {
            document.getElementById('client-form-section').classList.remove('active');
            document.getElementById('calculator-section').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('client-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const nombre = document.getElementById('nombre').value.trim();
            const calle = document.getElementById('calle').value.trim();
            const portal = document.getElementById('portal').value.trim();
            const piso = document.getElementById('piso').value.trim();
            const puerta = document.getElementById('puerta').value.trim();
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;

            let hasError = false;

            const validateField = (fieldId, errorId, value) => {
                const field = document.getElementById(fieldId);
                const error = document.getElementById(errorId);
                if (!value) {
                    field.classList.add('error');
                    error.classList.add('show');
                    hasError = true;
                } else {
                    field.classList.remove('error');
                    error.classList.remove('show');
                }
            };

            validateField('nombre', 'errorNombre', nombre);
            validateField('calle', 'errorCalle', calle);
            validateField('portal', 'errorPortal', portal);
            validateField('piso', 'errorPiso', piso);
            validateField('puerta', 'errorPuerta', puerta);
            validateField('fecha1', 'errorFecha1', fecha1);
            validateField('fecha2', 'errorFecha2', fecha2);

            if (hasError) {
                return;
            }

            const direccion = `${calle}, Portal ${portal}, Piso ${piso}, Puerta ${puerta}`;

            document.getElementById('final-nombre').textContent = nombre;
            document.getElementById('final-direccion').textContent = direccion;
            document.getElementById('final-fecha1').textContent = formatDate(fecha1);
            document.getElementById('final-fecha2').textContent = formatDate(fecha2);
            document.getElementById('final-total-cost').textContent = formatCurrency(state.totalCost);
            document.getElementById('final-cost-per-person').textContent = formatCurrency(state.costPerPerson, true);
            document.getElementById('final-roommates-count').textContent = state.roommatesCount;
            document.getElementById('final-roommates-plural').textContent = state.roommatesCount === 1 ? '' : 's';

            const servicesList = document.getElementById('final-services-list');
            servicesList.innerHTML = '';

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area');
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon');

            areas.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'summary-item';
                const quantity = item.quantity || 1;
                const totalPrice = item.price * quantity;
                itemDiv.innerHTML = `
                    <span class="summary-item-label">${item.label}${quantity > 1 ? ` (x${quantity})` : ''}</span>
                    <span class="summary-item-value">${formatCurrency(totalPrice)}</span>
                `;
                servicesList.appendChild(itemDiv);
            });

            addons.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'summary-item';
                itemDiv.innerHTML = `
                    <span class="summary-item-label">${item.label}</span>
                    <span class="summary-item-value">${formatCurrency(item.price)}</span>
                `;
                servicesList.appendChild(itemDiv);
            });

            if (state.referralCode) {
                document.getElementById('referral-code-section').style.display = 'block';
                document.getElementById('final-referral-code').textContent = state.referralCode;
            } else {
                document.getElementById('referral-code-section').style.display = 'none';
            }

            document.getElementById('final-summary-modal').classList.add('open');
        });

        document.getElementById('cancel-final-summary-btn').addEventListener('click', () => {
            document.getElementById('final-summary-modal').classList.remove('open');
        });

        document.getElementById('send-whatsapp-btn').addEventListener('click', () => {
            const nombre = document.getElementById('nombre').value.trim();
            const direccion = document.getElementById('final-direccion').textContent;
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;

            // Mensaje profesional y minimalista para WhatsApp
            let message = `SOLICITUD DE SERVICIO DE LIMPIEZA\n\n`;
            
            message += `INFORMACIÓN DEL CLIENTE\n`;
            message += `• Nombre: ${nombre}\n`;
            message += `• Dirección: ${direccion}\n\n`;
            
            message += `FECHAS DISPONIBLES PARA VISITA\n`;
            message += `• Primera opción: ${formatDate(fecha1)}\n`;
            message += `• Segunda opción: ${formatDate(fecha2)}\n\n`;
            
            message += `SERVICIOS SOLICITADOS\n`;
            
            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area');
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon');

            if (areas.length > 0) {
                message += `ÁREAS A LIMPIAR:\n`;
                areas.forEach(item => {
                    const quantity = item.quantity || 1;
                    const totalPrice = item.price * quantity;
                    message += `• ${item.label}${quantity > 1 ? ` (${quantity} unidades)` : ''}: ${formatCurrency(totalPrice)}\n`;
                });
                message += `\n`;
            }

            if (addons.length > 0) {
                message += `COMPLEMENTOS ADICIONALES:\n`;
                addons.forEach(item => {
                    message += `• ${item.label}: ${formatCurrency(item.price)}\n`;
                });
                message += `\n`;
            }

            message += `DETALLE DE COSTES\n`;
            message += `• Cuota de activación: ${formatCurrency(ACTIVATION_FEE)}\n`;
            message += `• Número de compañeros: ${state.roommatesCount}\n`;
            message += `• Coste total del servicio: ${formatCurrency(state.totalCost)}\n`;
            message += `• Coste por persona: ${formatCurrency(state.costPerPerson, true)}\n\n`;

            if (state.referralCode) {
                message += `CÓDIGO DE REFERIDO: ${state.referralCode}\n\n`;
            }

            message += `INFORMACIÓN ADICIONAL\n`;
            message += `Esta solicitud ha sido generada a través de la Calculadora-Limpieza10 de TeEchoUnaMano TUM. Nos pondremos en contacto para confirmar la fecha de visita y coordinar el servicio.\n\n`;
            
            message += `AGRADECEMOS SU CONFIANZA`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        });

        function editSection(section) {
            document.getElementById('final-summary-modal').classList.remove('open');
            
            if (section === 'services') {
                document.getElementById('client-form-section').classList.remove('active');
                document.getElementById('calculator-section').style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (section === 'client-data' || section === 'dates') {
                document.getElementById('calculator-section').style.display = 'none';
                document.getElementById('client-form-section').classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        const ctx = document.getElementById('costBreakdownChart').getContext('2d');
        costChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Vacío'],
                datasets: [{
                    data: [1],
                    backgroundColor: ['#e5e7eb'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 13,
                                weight: '600'
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + formatCurrency(context.parsed);
                            }
                        }
                    }
                }
            }
        });

        updateUI();
    </script>
</body>
</html>
