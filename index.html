<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calcular presupuesto online y solicitar servicio de limpieza en menos de 2 minutos.">
    <link rel="icon" type="image/png" href="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png">
    <title>Calculadora y Solicitud - TeEchoUnaMano TUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
/* ================================================================
   DISE√ëO COMPLETAMENTE RESPONSIVE Y OPTIMIZADO PARA M√ìVILES
   Calculadora de Limpieza - TeEchoUnaMano TUM
   ================================================================ */

/* === FUNDAMENTOS === */
body {
    font-family: 'Montserrat', sans-serif;
    background: #F5F7FA;
    min-height: 100vh;
    font-size: clamp(15px, 4vw, 17px);
    line-height: 1.6;
    color: #1E293B;
    overflow-x: hidden;
}

* {
    box-sizing: border-box;
}

/* === EFECTOS BASE === */
.glass-effect {
    background: #FFFFFF;
    border: 1px solid #E2E8F0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    border-radius: 8px;
}

/* === BOTONES PRINCIPALES === */
.button-gradient {
    background: #1E3A8A;
    transition: background 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: none;
    color: #FFFFFF;
    min-height: 48px;
    font-size: clamp(15px, 3.5vw, 17px);
    font-weight: 600;
    border-radius: 6px;
    padding: 12px 20px;
    cursor: pointer;
    width: 100%;
}

.button-gradient:hover {
    background: #1E40AF;
}

.button-gradient:active {
    background: #1E3A8A;
    transform: scale(0.98);
}

.button-secondary {
    background: #64748B;
    transition: background 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: none;
    color: #FFFFFF;
    min-height: 48px;
    font-size: clamp(15px, 3.5vw, 17px);
    font-weight: 600;
    border-radius: 6px;
    padding: 12px 20px;
    cursor: pointer;
    width: 100%;
}

.button-secondary:hover {
    background: #475569;
}

/* === GR√ÅFICO === */
.chart-container {
    position: relative;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    height: clamp(220px, 50vw, 280px);
}

/* === CHECKBOXES Y LABELS === */
.checkbox-label {
    transition: all 0.2s ease;
    border-radius: 6px;
    cursor: pointer;
    border: 2px solid #E2E8F0;
    background: #FFFFFF;
    min-height: 48px;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
}

.checkbox-label:hover {
    background: #F8FAFC;
    border-color: #CBD5E1;
}

input:checked + .checkbox-label {
    background: #EFF6FF;
    border-color: #1E3A8A;
}

.is-selected {
    background: #EFF6FF !important;
    border-color: #1E3A8A !important;
}

/* === CONTROLES DE CONTADOR === */
.count-controls {
    display: flex;
    align-items: center;
    gap: clamp(10px, 3vw, 16px);
    flex-shrink: 0;
}

.count-btn {
    background: #F1F5F9;
    color: #475569;
    width: clamp(40px, 10vw, 48px);
    height: clamp(40px, 10vw, 48px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(16px, 4vw, 20px);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid #E2E8F0;
    flex-shrink: 0;
}

.count-btn:hover {
    background: #1E3A8A;
    color: white;
    border-color: #1E3A8A;
}

.count-btn:active {
    transform: scale(0.95);
}

.count-display {
    width: clamp(44px, 12vw, 56px);
    text-align: center;
    font-weight: 800;
    font-size: clamp(18px, 5vw, 22px);
    color: #1E293B;
    flex-shrink: 0;
}

/* === ELEMENTOS FLOTANTES === */
#floating-elements-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 50;
}

#floating-cart-button {
    background: #1E3A8A;
    color: white;
    border-radius: 50%;
    width: clamp(52px, 14vw, 64px);
    height: clamp(52px, 14vw, 64px);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
    cursor: pointer;
    border: none;
    font-size: clamp(20px, 5vw, 28px);
}

#floating-cart-button:hover {
    background: #1E40AF;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
}

#floating-total-cost-display {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #DC2626;
    color: white;
    border-radius: 12px;
    padding: 4px 8px;
    font-size: clamp(11px, 3vw, 13px);
    font-weight: 800;
    display: none;
    border: 2px solid white;
    white-space: nowrap;
}

#floating-total-cost-display.visible {
    display: block;
}

/* === MODALES === */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    visibility: hidden;
    opacity: 0;
    transition: all 0.2s ease;
    padding: 16px;
}

.modal-overlay.open {
    visibility: visible;
    opacity: 1;
}

.modal-content {
    background: white;
    border-radius: 8px;
    padding: clamp(16px, 4vw, 24px);
    width: 100%;
    max-width: 550px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    max-height: 90vh;
    overflow-y: auto;
}

.modal-close-btn {
    background: #F1F5F9;
    color: #64748B;
    width: clamp(36px, 9vw, 40px);
    height: clamp(36px, 9vw, 40px);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(18px, 4.5vw, 20px);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #E2E8F0;
    flex-shrink: 0;
}

.modal-close-btn:hover {
    background: #FEE2E2;
    color: #DC2626;
    border-color: #FCA5A5;
}

.modal-item-controls {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 10px);
    flex-shrink: 0;
    flex-wrap: nowrap;
}

.modal-item-btn {
    background: #F1F5F9;
    color: #475569;
    width: clamp(32px, 8vw, 36px);
    height: clamp(32px, 8vw, 36px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #E2E8F0;
    font-size: clamp(12px, 3vw, 14px);
    flex-shrink: 0;
}

.modal-item-btn:hover {
    background: #1E3A8A;
    color: white;
    border-color: #1E3A8A;
}

.modal-remove-btn {
    background: transparent;
    color: #EF4444;
    border: none;
    cursor: pointer;
    font-size: clamp(16px, 4vw, 18px);
    padding: 6px;
    width: clamp(32px, 8vw, 36px);
    height: clamp(32px, 8vw, 36px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.modal-remove-btn:hover {
    color: #DC2626;
    background: #FEE2E2;
}

.button {
    display: inline-block;
    padding: 12px 20px;
    font-weight: 600;
    font-size: clamp(15px, 3.5vw, 17px);
    color: #ffffff;
    background: #64748B;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    min-height: 48px;
    width: 100%;
}

.button:hover {
    background: #475569;
}

/* === TIPOGRAF√çA === */
.main-title {
    font-size: clamp(1.5rem, 6vw, 2.25rem);
    font-weight: 800;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #1E293B;
}

.section-title {
    font-size: clamp(1.25rem, 5vw, 1.875rem);
    font-weight: 700;
    letter-spacing: -0.01em;
    line-height: 1.3;
    color: #1E293B;
}

.card-spacing {
    margin-bottom: 16px;
}

.button-spacing {
    margin-bottom: 12px;
}

/* === CONTENEDORES DE ADDONS === */
.addon-container {
    margin-bottom: 16px;
    border-radius: 8px;
    background: #FFFFFF;
    border: 2px solid #E2E8F0;
    padding: clamp(12px, 3vw, 16px);
    transition: all 0.2s ease;
}

.addon-container:hover {
    border-color: #CBD5E1;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.addon-container h4 {
    color: #1E293B;
    font-weight: 700;
    font-size: clamp(15px, 4vw, 18px);
    margin-bottom: 12px;
}

.addon-group {
    gap: 12px;
}

/* === HEADER === */
header {
    background: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 12px 0;
    margin-bottom: 24px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
    gap: 16px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 0;
}

.logo-img {
    width: clamp(44px, 12vw, 56px);
    height: clamp(44px, 12vw, 56px);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
}

.logo-text {
    min-width: 0;
}

.logo-text h1 {
    font-size: clamp(1rem, 4vw, 1.5rem);
    font-weight: 700;
    color: #1E3A8A;
    margin: 0;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.logo-text p {
    font-size: clamp(11px, 3vw, 15px);
    color: #64748B;
    margin: 0;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.header-link {
    background: #1E3A8A;
    color: white;
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    transition: background 0.2s ease;
    border: none;
    font-size: clamp(13px, 3.5vw, 15px);
    min-height: 40px;
    display: inline-flex;
    align-items: center;
    flex-shrink: 0;
    white-space: nowrap;
}

.header-link:hover {
    background: #1E40AF;
}

/* === FORMULARIOS === */
.form-section {
    display: none;
}

.form-section.active {
    display: block;
}

.form-input {
    width: 100%;
    padding: 12px 12px 12px clamp(40px, 10vw, 48px);
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    font-size: clamp(15px, 4vw, 17px);
    font-family: inherit;
    color: #0F172A;
    transition: all 0.2s ease;
    font-weight: 500;
    min-height: 48px;
}

.form-input:focus {
    outline: none;
    border-color: #1E3A8A;
    background: white;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.form-input.error {
    border-color: #EF4444;
    background: #FEF2F2;
}

.error-message {
    display: none;
    color: #EF4444;
    font-size: clamp(12px, 3vw, 14px);
    margin-top: 6px;
    font-weight: 600;
}

.error-message.show {
    display: block;
}

.form-label {
    display: block;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 700;
    color: #0F172A;
    margin-bottom: 8px;
}

.form-group {
    margin-bottom: 20px;
}

/* === MODAL FINAL === */
.final-summary-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 200;
    visibility: hidden;
    opacity: 0;
    transition: all 0.2s ease;
    padding: 12px;
}

.final-summary-modal.open {
    visibility: visible;
    opacity: 1;
}

.final-summary-content {
    background: white;
    border-radius: 8px;
    padding: clamp(14px, 4vw, 24px);
    width: 100%;
    max-width: 600px;
    max-height: 92vh;
    overflow-y: auto;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.summary-header h2 {
    font-size: clamp(1.25rem, 5vw, 1.75rem);
    font-weight: 800;
    color: #1E3A8A;
    margin-bottom: 6px;
    line-height: 1.2;
}

.summary-header p {
    color: #64748B;
    font-size: clamp(13px, 3.5vw, 16px);
    margin: 0;
    font-weight: 500;
}

.summary-section {
    background: #F8FAFC;
    border-radius: 6px;
    padding: clamp(12px, 3vw, 16px);
    margin-bottom: 12px;
    border: 1px solid #E2E8F0;
    position: relative;
}

.summary-section-title {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
    font-size: clamp(14px, 4vw, 18px);
    font-weight: 700;
    color: #1E293B;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 2px solid #E2E8F0;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 10px;
    border-radius: 6px;
    position: relative;
    flex-wrap: wrap;
}

.summary-section-title:hover {
    background: #F1F5F9;
}

.summary-section-title .edit-icon {
    margin-left: auto;
    font-size: clamp(14px, 3.5vw, 16px);
    color: #64748B;
    display: flex;
    align-items: center;
    gap: 6px;
    opacity: 0;
    transition: opacity 0.3s ease;
    flex-shrink: 0;
}

.summary-section-title:hover .edit-icon {
    opacity: 1;
}

.edit-icon-text {
    font-size: clamp(11px, 3vw, 13px);
    font-weight: 600;
    text-transform: uppercase;
}

.edit-tooltip {
    position: absolute;
    top: -35px;
    right: 12px;
    background: #1E293B;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: 600;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 10;
}

.summary-section-title:hover .edit-tooltip {
    opacity: 1;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 8px 0;
    border-bottom: 1px solid #E2E8F0;
    gap: 12px;
    flex-wrap: wrap;
}

.summary-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.summary-item-label {
    font-size: clamp(13px, 3.5vw, 16px);
    color: #475569;
    font-weight: 600;
    line-height: 1.5;
    flex: 1;
    min-width: 0;
    word-break: break-word;
}

.summary-item-value {
    font-size: clamp(13px, 3.5vw, 16px);
    color: #1E293B;
    font-weight: 700;
    text-align: right;
    line-height: 1.5;
    flex-shrink: 0;
}

.activation-fee-highlight {
    background: #FEF3C7;
    border: 2px solid #F59E0B;
    border-radius: 6px;
    padding: clamp(12px, 3vw, 16px);
    margin-bottom: 12px;
}

.activation-fee-highlight .summary-item-label,
.activation-fee-highlight .summary-item-value {
    color: #92400E;
    font-weight: 800;
}

.summary-total {
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 6px;
    padding: clamp(14px, 4vw, 20px);
    margin-top: 16px;
    margin-bottom: 16px;
    text-align: center;
}

.summary-total-label {
    font-size: clamp(10px, 2.5vw, 13px);
    font-weight: 700;
    color: #64748B;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.summary-total-value {
    font-size: clamp(1.75rem, 7vw, 2.25rem);
    font-weight: 900;
    color: #1E3A8A;
    line-height: 1;
    margin-bottom: 12px;
}

.summary-total-per-person {
    background: #EFF6FF;
    border: 1px solid #BFDBFE;
    border-radius: 6px;
    padding: 10px;
    text-align: center;
    font-weight: 700;
    font-size: clamp(13px, 3.5vw, 16px);
    color: #1E40AF;
    margin-top: 12px;
}

.summary-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.summary-btn {
    flex: 1;
    min-width: 140px;
    padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 20px);
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(14px, 3.5vw, 17px);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 50px;
}

.summary-btn-cancel {
    background: #F1F5F9;
    color: #475569;
    border: 2px solid #E2E8F0;
}

.summary-btn-cancel:hover {
    background: #E2E8F0;
}

.summary-btn-send {
    background: #10B981;
    color: white;
}

.summary-btn-send:hover {
    background: #059669;
}

/* === TARJETAS DE FORMULARIO === */
.form-card {
    background: white;
    border: 1px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(16px, 4vw, 24px);
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.form-card-header {
    display: flex;
    align-items: center;
    gap: clamp(12px, 3vw, 16px);
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #F1F5F9;
}

.form-card-icon {
    width: clamp(40px, 10vw, 48px);
    height: clamp(40px, 10vw, 48px);
    background: #EFF6FF;
    color: #1E3A8A;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(20px, 5vw, 24px);
    border-radius: 8px;
    flex-shrink: 0;
}

.form-card-title {
    font-size: clamp(1.125rem, 4.5vw, 1.5rem);
    font-weight: 700;
    color: #1E293B;
    margin: 0;
    line-height: 1.3;
}

.form-input-wrapper {
    position: relative;
    margin-bottom: 16px;
}

.form-input-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: clamp(16px, 4vw, 20px);
    color: #64748B;
    pointer-events: none;
}

.form-input-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
}

.cost-display {
    background: #EFF6FF;
    border: 2px solid #BFDBFE;
    border-radius: 8px;
    padding: clamp(16px, 4vw, 24px);
    text-align: center;
    margin-bottom: 20px;
}

.cost-display h3 {
    font-size: clamp(12px, 3vw, 15px);
    color: #64748B;
    font-weight: 700;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.cost-per-person {
    background: white;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    text-align: center;
}

.cost-per-person p:first-child {
    font-size: clamp(11px, 3vw, 13px);
    color: #64748B;
    font-weight: 700;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.cost-per-person p:last-child {
    font-size: clamp(1.5rem, 6vw, 2rem);
    font-weight: 900;
    color: #1E3A8A;
    line-height: 1;
}

.date-selector {
    background: white;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    transition: all 0.2s ease;
}

.date-selector:hover {
    border-color: #CBD5E1;
}

.date-selector-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 700;
    color: #475569;
    margin-bottom: 10px;
}

.date-selector input {
    width: 100%;
    padding: 12px;
    background: white;
    border: 2px solid #CBD5E1;
    border-radius: 6px;
    font-size: clamp(15px, 4vw, 17px);
    font-family: inherit;
    color: #0F172A;
    transition: all 0.2s ease;
    font-weight: 500;
    min-height: 48px;
}

.date-selector input:focus {
    outline: none;
    border-color: #1E3A8A;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

/* === BANNERS === */
.security-banner {
    background: #D1FAE5;
    border: 2px solid #10B981;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    display: flex;
    align-items: center;
    gap: clamp(10px, 3vw, 16px);
    margin-bottom: 20px;
}

.security-banner-icon {
    font-size: clamp(24px, 6vw, 32px);
    flex-shrink: 0;
}

.security-banner-content h4 {
    font-size: clamp(15px, 4vw, 18px);
    font-weight: 800;
    color: #065F46;
    margin: 0 0 4px 0;
}

.security-banner-content p {
    font-size: clamp(13px, 3.5vw, 16px);
    color: #065F46;
    margin: 0;
    font-weight: 600;
}

.info-banner {
    background: #DBEAFE;
    border: 2px solid #3B82F6;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    display: flex;
    align-items: start;
    gap: clamp(10px, 3vw, 16px);
    margin-bottom: 20px;
}

.info-banner-icon {
    font-size: clamp(24px, 6vw, 32px);
    flex-shrink: 0;
}

.info-banner-content h4 {
    font-size: clamp(15px, 4vw, 18px);
    font-weight: 800;
    color: #1E40AF;
    margin: 0 0 6px 0;
}

.info-banner-content p {
    font-size: clamp(14px, 3.5vw, 17px);
    color: #1E40AF;
    margin: 0;
    font-weight: 600;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 24px;
    flex-wrap: wrap;
}

.form-btn {
    flex: 1;
    min-width: 140px;
    padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 24px);
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(15px, 4vw, 18px);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    min-height: 50px;
}

.form-btn-back {
    background: white;
    color: #475569;
    border: 2px solid #E2E8F0;
}

.form-btn-back:hover {
    background: #F8FAFC;
    border-color: #CBD5E1;
}

.form-btn-submit {
    background: #1E3A8A;
    color: white;
}

.form-btn-submit:hover {
    background: #1E40AF;
}

.modal-continue-btn {
    width: 100%;
    padding: clamp(12px, 3vw, 16px);
    background: #1E3A8A;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: clamp(15px, 4vw, 18px);
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 12px;
    min-height: 50px;
}

.modal-continue-btn:hover {
    background: #1E40AF;
}

.referral-code-display {
    background: #D1FAE5;
    border: 2px solid #10B981;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    text-align: center;
    margin-bottom: 20px;
}

.referral-code-display .label {
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 700;
    color: #065F46;
    margin-bottom: 6px;
}

.referral-code-display .code {
    font-size: clamp(20px, 5vw, 24px);
    font-weight: 900;
    color: #065F46;
    letter-spacing: 0.08em;
}

.referral-input-wrapper {
    background: #D1FAE5;
    border: 2px solid #10B981;
    border-radius: 8px;
    padding: clamp(14px, 3.5vw, 20px);
    margin-bottom: 16px;
}

.referral-input-wrapper label {
    display: block;
    font-size: clamp(14px, 3.5vw, 17px);
    font-weight: 700;
    color: #065F46;
    margin-bottom: 10px;
    text-align: center;
}

.referral-input-wrapper input {
    width: 100%;
    padding: 12px;
    background: white;
    border: 2px solid #10B981;
    border-radius: 6px;
    font-size: clamp(15px, 4vw, 18px);
    font-family: inherit;
    color: #065F46;
    font-weight: 700;
    text-align: center;
    letter-spacing: 0.05em;
    transition: all 0.2s ease;
    min-height: 48px;
}

.referral-input-wrapper input:focus {
    outline: none;
    border-color: #059669;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
}

.referral-input-wrapper input::placeholder {
    color: #6EE7B7;
    font-weight: 600;
}

/* === RESPONSIVE ESPEC√çFICO PARA M√ìVILES === */

/* M√≥viles peque√±os (<400px) */
@media (max-width: 400px) {
    .header-content {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    
    .logo {
        justify-content: center;
    }
    
    .header-link {
        width: 100%;
        text-align: center;
        justify-content: center;
    }
    
    .summary-actions {
        flex-direction: column;
    }
    
    .summary-btn {
        width: 100%;
        min-width: unset;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-btn {
        width: 100%;
        min-width: unset;
    }
    
    .final-summary-content {
        padding: 12px;
    }
    
    .edit-icon-text {
        display: none;
    }
    
    .summary-section-title .edit-icon {
        opacity: 1;
    }
    
    .edit-tooltip {
        display: none;
    }
}

/* M√≥viles medianos (400px - 640px) */
@media (min-width: 401px) and (max-width: 640px) {
    .header-content {
        flex-wrap: wrap;
    }
    
    .edit-icon-text {
        display: none;
    }
    
    .summary-section-title .edit-icon {
        opacity: 1;
    }
}

/* Tablets y pantallas medianas (641px - 768px) */
@media (min-width: 641px) and (max-width: 768px) {
    .summary-actions {
        flex-wrap: nowrap;
    }
    
    .form-actions {
        flex-wrap: nowrap;
    }
}

/* Desktop (>768px) */
@media (min-width: 769px) {
    .modal-content {
        padding: 24px;
    }
    
    .final-summary-content {
        padding: 24px;
    }
}

/* Ajuste adicional para overflow horizontal */
@media (max-width: 768px) {
    body {
        overflow-x: hidden;
    }
    
    .modal-content,
    .final-summary-content {
        max-width: calc(100vw - 24px);
    }
    
    .summary-item {
        align-items: center;
    }
    
    .modal-item-controls {
        flex-wrap: nowrap;
    }
    
    .count-controls {
        flex-wrap: nowrap;
    }
}

    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png" alt="TeEchoUnaMano Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>TeEchoUnaMano TUM</h1>
                        <p>Servicios de Limpieza Profesional</p>
                    </div>
                </div>
                <a href="https://te-echounamano.blogspot.com" target="_blank" rel="noopener noreferrer" class="header-link">
                    M√°s informaci√≥n
                </a>
            </div>
        </div>
    </header>

    <!-- Secci√≥n de la calculadora -->
    <main class="container mx-auto px-4 py-6 md:py-12" id="calculator-section">
        <div class="text-center mb-12 md:mb-16">
            <div class="relative max-w-7xl mx-auto flex flex-col items-center">
                <div class="flex space-x-4 md:space-x-6 mb-6 md:mb-8 md:absolute md:top-0 md:right-0">
                    <a href="https://te-echounamano.blogspot.com/" target="_blank" title="TUM TeEchoUnaMano Web" class="text-xl md:text-3xl text-gray-700 hover:text-gray-900 transition-all duration-300 hover:scale-110">
                        üè†
                    </a>
                    <a href="https://apm-tum.blogspot.com/" target="_blank" title="Soporte A-TUM" class="text-xl md:text-3xl text-gray-700 hover:text-gray-900 transition-all duration-300 hover:scale-110">
                        üéß
                    </a>
                    <a href="https://t.me/TumAgenda_bot" target="_blank" title="Bot de Telegram" class="text-xl md:text-3xl text-gray-700 hover:text-gray-900 transition-all duration-300 hover:scale-110">
                        ü§ñ
                    </a>
                </div>
                <h1 class="main-title text-gray-900 mb-4 md:mb-6">üßπ Calculadora-Limpieza10</h1>
                <p class="text-base md:text-2xl text-gray-800 max-w-4xl mx-auto leading-relaxed px-4 font-medium">La limpieza de tu <b>piso de estudiante</b>, solucionada. Es la forma m√°s f√°cil y econ√≥mica de mantener vuestro piso limpio. Personaliza tu plan, comparte los gastos y olv√≠date de discutir por turnos.</p>
            </div>
        </div>

        <section id="how-it-works" class="mb-16 md:mb-20">
            <div class="max-w-5xl mx-auto">
                <h2 class="section-title text-center mb-12 md:mb-16 text-gray-900">¬øC√≥mo Funciona? Sencillo y Transparente</h2>
                <div class="flex flex-col md:flex-row items-stretch justify-center text-center gap-6 md:gap-8">
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-blue-900 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">1</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Una √∫nica cuota de <b>10‚Ç¨</b> te da acceso a un servicio de limpieza completo y a medida. Es tu pase directo a un espacio limpio.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-indigo-900 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">2</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Elige las √°reas de tu piso que necesitan un repaso por solo <b>10‚Ç¨</b> cada una y a√±ade los complementos que quieras.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-emerald-700 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">‚úì</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Disfruta de tu casa impecable y divide el coste total entre tus compa√±eros de piso. Sin estr√©s, sin peleas.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="simulator" class="glass-effect rounded-3xl shadow-2xl p-5 md:p-12 mb-16 md:mb-20">
            <h2 class="text-2xl md:text-4xl font-bold text-center mb-3 md:mb-4 text-gray-800">Dise√±a tu Limpieza a Medida</h2>
            <p class="text-center text-gray-600 text-sm md:text-lg mb-3 md:mb-4 font-medium">Construye tu paquete de limpieza y mira el coste en tiempo real.</p>
            <p class="text-center text-gray-600 italic max-w-3xl mx-auto mb-8 md:mb-12 text-xs md:text-base font-medium">Este servicio est√° dise√±ado para una <b>limpieza r√°pida y eficiente</b>. Si necesitas un servicio m√°s profundo, limpieza de ventanas u otras tareas, ofrecemos planes por hora y presupuestos personalizados. ¬°Solo tienes que consultarnos!</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-16">
                <div>
                    <h3 id="areas-section" class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">1. Elige las √°reas a limpiar (10‚Ç¨ c/u)</h3>
                    <div class="space-y-3 md:space-y-4 card-spacing">
                        <input type="checkbox" id="salon" class="hidden peer" data-price="10" data-label="Sal√≥n / Comedor" data-type="area">
                        <label for="salon" class="checkbox-label">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">üõãÔ∏è</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Sal√≥n / Comedor</span>
                            </div>
                            <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                        </label>
                        
                        <input type="checkbox" id="cocina" class="hidden peer" data-price="10" data-label="Cocina" data-type="area">
                        <label for="cocina" class="checkbox-label">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">üç≥</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Cocina</span>
                            </div>
                            <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                        </label>
                        
                        <div id="bano-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300" style="min-height: 48px; gap: 12px; flex-wrap: wrap;">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">üöø</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Ba√±os</span>
                            </div>
                            <div class="count-controls">
                                <button id="bano-decrement" class="count-btn">-</button>
                                <span id="bano-display" class="count-display">0</span>
                                <button id="bano-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <div id="habitacion-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300" style="min-height: 48px; gap: 12px; flex-wrap: wrap;">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">üõèÔ∏è</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Habitaciones</span>
                            </div>
                            <div class="count-controls">
                                <button id="habitacion-decrement" class="count-btn">-</button>
                                <span id="habitacion-display" class="count-display">0</span>
                                <button id="habitacion-increment" class="count-btn">+</button>
                            </div>
                        </div>

                        <input type="checkbox" id="lavanderia" class="hidden peer" data-price="10" data-label="Lavander√≠a" data-type="area">
                        <label for="lavanderia" class="checkbox-label">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">üß∫</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Lavander√≠a</span>
                            </div>
                            <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                        </label>

                        <input type="checkbox" id="terrazas" class="hidden peer" data-price="10" data-label="Limpieza de Terrazas" data-type="area">
                        <label for="terrazas" class="checkbox-label">
                            <div class="flex items-center gap-2">
                                <span style="font-size: clamp(20px, 5vw, 28px);">‚òÄÔ∏è</span>
                                <span class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px);">Limpieza de Terrazas</span>
                            </div>
                            <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                        </label>
                    </div>

                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 mt-8 md:mt-10 text-gray-800">2. A√±ade complementos</h3>
                    <div class="space-y-4 md:space-y-6">
                        <div class="addon-container">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span style="font-size: clamp(20px, 5vw, 28px); margin-right: 8px;">üö™</span>
                                <span>Pasillo (√°rea com√∫n)</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="pasillo">
                                <input type="checkbox" id="pasillo-5" class="hidden peer" data-price="5" data-label="Pasillo: menos de 5m¬≤" data-type="addon">
                                <label for="pasillo-5" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">Menos de 5m¬≤</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="pasillo-10" class="hidden peer" data-price="10" data-label="Pasillo: 5m¬≤ o m√°s" data-type="addon">
                                <label for="pasillo-10" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">5m¬≤ o m√°s</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span style="font-size: clamp(20px, 5vw, 28px); margin-right: 8px;">üçΩÔ∏è</span>
                                <span>Fregar Platos</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="platos">
                                <input type="checkbox" id="platos-5" class="hidden peer" data-price="5" data-label="Fregar Platos: 1 carga" data-type="addon">
                                <label for="platos-5" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">1 Carga</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="platos-10" class="hidden peer" data-price="10" data-label="Fregar Platos: M√°s de 1 carga" data-type="addon">
                                <label for="platos-10" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">M√°s de 1 Carga</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span style="font-size: clamp(20px, 5vw, 28px); margin-right: 8px;">ü™ü</span>
                                <span>Limpieza de Mamparas</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="mamparas">
                                <input type="checkbox" id="mamparas-5" class="hidden peer" data-price="5" data-label="Mamparas: 1 unidad" data-type="addon">
                                <label for="mamparas-5" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">1 Unidad</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="mamparas-10" class="hidden peer" data-price="10" data-label="Mamparas: 2 o m√°s" data-type="addon">
                                <label for="mamparas-10" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">2 o M√°s</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span style="font-size: clamp(20px, 5vw, 28px); margin-right: 8px;">üóëÔ∏è</span>
                                <span>Sacar Basura</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="basura">
                                <input type="checkbox" id="basura-5" class="hidden peer" data-price="5" data-label="Sacar Basura: 1-2 bolsas" data-type="addon">
                                <label for="basura-5" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">1-2 Bolsas</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="basura-10" class="hidden peer" data-price="10" data-label="Sacar Basura: 3+ bolsas" data-type="addon">
                                <label for="basura-10" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">3+ Bolsas</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span style="font-size: clamp(20px, 5vw, 28px); margin-right: 8px;">üî•</span>
                                <span>Limpieza Profunda</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="profunda">
                                <input type="checkbox" id="profunda-20" class="hidden peer" data-price="20" data-label="Limpieza Profunda: Horno" data-type="addon">
                                <label for="profunda-20" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">Horno</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">20‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="profunda-15" class="hidden peer" data-price="15" data-label="Limpieza Profunda: Nevera" data-type="addon">
                                <label for="profunda-15" class="checkbox-label flex-1 flex flex-col items-center justify-center">
                                    <span class="font-semibold text-center mb-2" style="font-size: clamp(14px, 3.5vw, 18px);">Nevera</span>
                                    <span class="text-gray-600 font-bold" style="font-size: clamp(14px, 3.5vw, 18px);">15‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">Tu presupuesto</h3>
                    <div class="glass-effect rounded-2xl p-5 md:p-8 mb-6 md:mb-8">
                        <div class="chart-container mb-4 md:mb-6">
                            <canvas id="costChart"></canvas>
                        </div>
                        
                        <div class="cost-display mb-4 md:mb-6">
                            <h3>Coste Total</h3>
                            <p id="total-cost" style="font-size: clamp(2rem, 8vw, 3rem);" class="font-black text-blue-900 mb-0">0 ‚Ç¨</p>
                        </div>
                        
                        <div class="mb-6 md:mb-8">
                            <label class="block text-center font-bold mb-3 md:mb-4 text-gray-700" style="font-size: clamp(14px, 3.5vw, 18px);">¬øCu√°ntos sois en el piso?</label>
                            <div class="flex items-center justify-center gap-3 md:gap-4">
                                <button id="roommates-decrement" class="count-btn">-</button>
                                <span id="roommates-count" class="count-display">1</span>
                                <button id="roommates-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <div class="cost-per-person">
                            <p>Coste por Persona</p>
                            <p id="cost-per-person">0,00 ‚Ç¨</p>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-5 md:p-8">
                        <h3 class="text-lg md:text-xl font-bold mb-4 md:mb-6 text-gray-800 text-center">Resumen de tu Selecci√≥n</h3>
                        <div id="summary-list" class="space-y-3 md:space-y-4">
                            <p class="text-gray-500 text-center py-6 md:py-8 font-medium" style="font-size: clamp(14px, 3.5vw, 18px);">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>
                        </div>
                        
                        <button id="continue-to-form-btn" class="button-gradient mt-6 md:mt-8">
                            Continuar con la Solicitud ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Resumen -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6 md:mb-8" style="gap: 12px;">
                <h3 class="text-xl md:text-2xl font-bold text-gray-800" style="font-size: clamp(1.125rem, 5vw, 1.5rem);">Tu Carrito de Limpieza</h3>
                <button id="close-modal" class="modal-close-btn">‚úï</button>
            </div>
            
            <div id="modal-summary-list" class="space-y-3 md:space-y-4 mb-6 md:mb-8"></div>
            
            <div class="border-t-2 border-gray-200 pt-4 md:pt-6 mb-4 md:mb-6">
                <div class="flex justify-between items-center font-bold mb-4 md:mb-6" style="font-size: clamp(1rem, 4.5vw, 1.25rem);">
                    <span>Total:</span>
                    <span id="summary-total">0 ‚Ç¨</span>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label class="block text-center font-bold mb-3 text-gray-700" style="font-size: clamp(14px, 3.5vw, 16px);">¬øCu√°ntos sois en el piso?</label>
                    <div class="flex items-center justify-center gap-3">
                        <button id="modal-roommates-decrement" class="count-btn">-</button>
                        <span id="modal-roommates-count" class="count-display">1</span>
                        <button id="modal-roommates-increment" class="count-btn">+</button>
                    </div>
                </div>
                
                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 md:p-5 text-center">
                    <p class="text-blue-700 font-bold mb-2" style="font-size: clamp(11px, 3vw, 14px);">Coste por Persona</p>
                    <p id="modal-cost-per-person" class="font-black text-blue-900" style="font-size: clamp(1.5rem, 6vw, 2rem);">0,00 ‚Ç¨</p>
                </div>
            </div>
            
            <button id="modal-continue-btn" class="modal-continue-btn">
                Continuar con el Pedido ‚Üí
            </button>
        </div>
    </div>

    <!-- Formulario del Cliente -->
    <div id="client-form-section" class="form-section container mx-auto px-4 py-6 md:py-12 max-w-4xl">
        <div class="text-center mb-8 md:mb-12">
            <h2 class="font-bold text-gray-900 mb-3 md:mb-4" style="font-size: clamp(1.5rem, 6vw, 2.5rem);">Completa tus Datos</h2>
            <p class="text-gray-600 font-medium" style="font-size: clamp(15px, 4vw, 20px);">Solo un paso m√°s para reservar tu servicio de limpieza</p>
        </div>

        <div class="security-banner">
            <div class="security-banner-icon">üîí</div>
            <div class="security-banner-content">
                <h4>Tus datos est√°n seguros</h4>
                <p>Toda tu informaci√≥n se env√≠a de forma segura y solo se usa para gestionar tu solicitud de servicio.</p>
            </div>
        </div>

        <div class="form-card">
            <div class="form-card-header">
                <div class="form-card-icon">üë§</div>
                <h3 class="form-card-title">Informaci√≥n Personal</h3>
            </div>
            
            <div class="form-input-wrapper">
                <span class="form-input-icon">üìù</span>
                <input type="text" id="nombre" class="form-input" placeholder="Nombre completo" autocomplete="name">
                <div id="errorNombre" class="error-message"></div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-card-header">
                <div class="form-card-icon">üìç</div>
                <h3 class="form-card-title">Direcci√≥n del Servicio</h3>
            </div>

            <div class="info-banner">
                <div class="info-banner-icon">‚ÑπÔ∏è</div>
                <div class="info-banner-content">
                    <h4>Actualmente solo operamos en Valencia Capital</h4>
                    <p>Si est√°s fuera de esta zona, puedes contactarnos para consultar disponibilidad.</p>
                </div>
            </div>
            
            <div class="form-input-wrapper">
                <span class="form-input-icon">üè†</span>
                <input type="text" id="calle" class="form-input" placeholder="Calle y n√∫mero" autocomplete="street-address">
                <div id="errorCalle" class="error-message"></div>
            </div>
            
            <div class="form-input-group">
                <div class="form-input-wrapper">
                    <span class="form-input-icon">üö™</span>
                    <input type="text" id="portal" class="form-input" placeholder="Portal">
                    <div id="errorPortal" class="error-message"></div>
                </div>
                <div class="form-input-wrapper">
                    <span class="form-input-icon">üè¢</span>
                    <input type="text" id="piso" class="form-input" placeholder="Piso">
                    <div id="errorPiso" class="error-message"></div>
                </div>
                <div class="form-input-wrapper">
                    <span class="form-input-icon">üö™</span>
                    <input type="text" id="puerta" class="form-input" placeholder="Puerta">
                    <div id="errorPuerta" class="error-message"></div>
                </div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-card-header">
                <div class="form-card-icon">üìÖ</div>
                <h3 class="form-card-title">Fechas Preferidas</h3>
            </div>

            <div class="info-banner">
                <div class="info-banner-icon">üí°</div>
                <div class="info-banner-content">
                    <h4>Flexibilidad es tu mejor aliada</h4>
                    <p>Proporciona dos opciones de fecha para aumentar las probabilidades de conseguir tu cita. Te confirmaremos la disponibilidad por WhatsApp.</p>
                </div>
            </div>

            <div class="space-y-4 md:space-y-6">
                <div class="date-selector">
                    <div class="date-selector-label">
                        <span style="font-size: clamp(18px, 4.5vw, 24px);">üìÖ</span>
                        <span>Primera opci√≥n</span>
                    </div>
                    <input type="date" id="fecha1" autocomplete="off">
                    <div id="errorFecha1" class="error-message"></div>
                </div>

                <div class="date-selector">
                    <div class="date-selector-label">
                        <span style="font-size: clamp(18px, 4.5vw, 24px);">üìÖ</span>
                        <span>Segunda opci√≥n</span>
                    </div>
                    <input type="date" id="fecha2" autocomplete="off">
                    <div id="errorFecha2" class="error-message"></div>
                </div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-card-header">
                <div class="form-card-icon">üéÅ</div>
                <h3 class="form-card-title">C√≥digo de Referido (Opcional)</h3>
            </div>

            <div class="referral-code-display" style="display:none;" id="user-referral-code-display">
                <div class="label">Tu c√≥digo de referido para compartir:</div>
                <div class="code" id="user-referral-code-value">TUMXXXXXX</div>
            </div>

            <div class="referral-input-wrapper">
                <label for="referral-code-input">
                    ¬øTe recomend√≥ alguien? Introduce su c√≥digo aqu√≠
                </label>
                <input type="text" id="referral-code-input" placeholder="TUM123456" maxlength="10">
            </div>

            <div class="text-center text-gray-600 mt-4 font-medium" style="font-size: clamp(12px, 3vw, 14px);">
                Comparte tu propio c√≥digo con amigos despu√©s de completar tu primera limpieza y obt√©n descuentos en futuros servicios.
            </div>
        </div>

        <div class="form-actions">
            <button type="button" id="back-to-calculator-btn" class="form-btn form-btn-back">
                <span>‚Üê</span>
                <span>Volver a la Calculadora</span>
            </button>
            <button type="button" id="submit-form-btn" class="form-btn form-btn-submit">
                <span>Revisar Solicitud</span>
                <span>‚Üí</span>
            </button>
        </div>
    </div>

    <!-- Modal Final de Resumen -->
    <div id="final-summary-modal" class="final-summary-modal">
        <div class="final-summary-content">
            <div class="summary-header mb-6 md:mb-8">
                <h2>‚úÖ Resumen de tu Solicitud</h2>
                <p>Revisa todos los detalles antes de enviar</p>
            </div>

            <div class="summary-section">
                <div class="summary-section-title" onclick="showSection('form')">
                    <span style="font-size: clamp(18px, 4.5vw, 24px);">üë§</span>
                    <span>Datos del Cliente</span>
                    <div class="edit-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar datos personales</div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Nombre</span>
                    <span class="summary-item-value" id="final-nombre">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Direcci√≥n</span>
                    <span class="summary-item-value" id="final-direccion">-</span>
                </div>
            </div>

            <div class="summary-section">
                <div class="summary-section-title" onclick="showCalculatorSection()">
                    <span style="font-size: clamp(18px, 4.5vw, 24px);">üßπ</span>
                    <span>Servicios Seleccionados</span>
                    <div class="edit-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar servicios</div>
                </div>
                <div id="final-services-list"></div>
            </div>

            <div class="activation-fee-highlight">
                <div class="summary-item">
                    <span class="summary-item-label">üí≥ Cuota de activaci√≥n</span>
                    <span class="summary-item-value">10 ‚Ç¨</span>
                </div>
            </div>

            <div id="referral-code-section" class="summary-section" style="display: none;">
                <div class="summary-section-title" onclick="showSection('form')">
                    <span style="font-size: clamp(18px, 4.5vw, 24px);">üéÅ</span>
                    <span>C√≥digo de Referido</span>
                    <div class="edit-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar c√≥digo</div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">C√≥digo</span>
                    <span class="summary-item-value" id="final-referral-code">-</span>
                </div>
            </div>

            <div class="summary-section">
                <div class="summary-section-title" onclick="showSection('form')">
                    <span style="font-size: clamp(18px, 4.5vw, 24px);">üìÖ</span>
                    <span>Fechas Disponibles</span>
                    <div class="edit-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar fechas</div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Primera opci√≥n</span>
                    <span class="summary-item-value" id="final-fecha1">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Segunda opci√≥n</span>
                    <span class="summary-item-value" id="final-fecha2">-</span>
                </div>
            </div>

            <div class="summary-total">
                <div class="summary-total-label">Coste Total del Servicio</div>
                <div class="summary-total-value" id="final-total-cost">0 ‚Ç¨</div>
                <div class="summary-total-per-person">
                    üí∞ <span id="final-cost-per-person">0,00 ‚Ç¨</span> por persona (<span id="final-roommates-count">1</span> compa√±ero<span id="final-roommates-plural">s</span>)
                </div>
            </div>

            <div class="summary-actions">
                <button type="button" id="cancel-final-summary-btn" class="summary-btn summary-btn-cancel">
                    <span>‚úï</span>
                    <span>Cancelar</span>
                </button>
                <button type="button" id="send-whatsapp-btn" class="summary-btn summary-btn-send">
                    <span>üì±</span>
                    <span>Enviar por WhatsApp</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Elemento Flotante del Carrito -->
    <div id="floating-elements-container">
        <button id="floating-cart-button" title="Ver resumen">
            üõí
        </button>
        <div id="floating-total-cost-display"></div>
    </div>

    <script>
        const ACTIVATION_FEE = 10;
        const WHATSAPP_NUMBER = '34602846694';

        const state = {
            banoCount: 0,
            habitacionCount: 0,
            roommatesCount: 1,
            selectedItems: {},
            totalCost: 0,
            costPerPerson: 0,
            currentSection: 'calculator',
            referralCode: ''
        };

        const totalCostDisplay = document.getElementById('total-cost');
        const costPerPersonDisplay = document.getElementById('cost-per-person');
        const floatingCostDisplay = document.getElementById('floating-total-cost-display');
        const summaryList = document.getElementById('summary-list');
        const summaryTotal = document.getElementById('summary-total');
        const modalCostPerPerson = document.getElementById('modal-cost-per-person');
        const modal = document.getElementById('summary-modal');
        const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
        const addonGroups = document.querySelectorAll('.addon-group');
        let costChart;

        const formatCurrency = (value, useDecimals = false) => {
            const options = useDecimals ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : { minimumFractionDigits: 0, maximumFractionDigits: 0 };
            return value.toLocaleString('es-ES', options) + ' ‚Ç¨';
        };

        const formatDate = (dateString) => {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        const updateUI = () => {
            totalCostDisplay.textContent = formatCurrency(state.totalCost);
            costPerPersonDisplay.textContent = formatCurrency(state.costPerPerson, true);
            summaryTotal.textContent = formatCurrency(state.totalCost, true);
            modalCostPerPerson.textContent = formatCurrency(state.costPerPerson, true);

            if (state.totalCost > 0) {
                floatingCostDisplay.textContent = formatCurrency(state.totalCost);
                floatingCostDisplay.classList.add('visible');
            } else {
                floatingCostDisplay.classList.remove('visible');
            }

            document.getElementById('bano-display').textContent = state.banoCount;
            document.getElementById('habitacion-display').textContent = state.habitacionCount;
            document.getElementById('roommates-count').textContent = state.roommatesCount;
            document.getElementById('modal-roommates-count').textContent = state.roommatesCount;

            document.getElementById('bano-container').classList.toggle('is-selected', state.banoCount > 0);
            document.getElementById('habitacion-container').classList.toggle('is-selected', state.habitacionCount > 0);
            
            updateSummaryList();
            updateChart();
        };
        
        const updateSummaryList = () => {
            summaryList.innerHTML = '';

            if (state.totalCost === 0) {
                summaryList.innerHTML = '<p class="text-gray-500 text-center py-6 md:py-8 font-medium" style="font-size: clamp(14px, 3.5vw, 18px);">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>';
                return;
            }

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area').sort((a,b) => a.label.localeCompare(b.label));
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon').sort((a,b) => a.label.localeCompare(b.label));

            const createItemNode = (item) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center py-3 md:py-3 px-4 md:px-4 bg-gray-50 rounded-lg';
                itemElement.style.gap = '12px';
                itemElement.style.flexWrap = 'wrap';
                
                let controls = '';
                if (item.id === 'bano' || item.id === 'habitacion') {
                    controls = `
                        <div class="modal-item-controls">
                            <button class="modal-item-btn" data-action="decrement" data-id="${item.id}">-</button>
                            <span class="font-bold text-center" style="width: clamp(28px, 7vw, 32px); font-size: clamp(13px, 3.5vw, 16px);">${item.quantity}</span>
                            <button class="modal-item-btn" data-action="increment" data-id="${item.id}">+</button>
                        </div>
                    `;
                } else {
                    controls = `<button class="modal-remove-btn" data-action="remove" data-id="${item.id}">üóëÔ∏è</button>`;
                }
                
                const totalItemPrice = item.price * (item.quantity || 1);

                itemElement.innerHTML = `
                    <div class="flex-grow pr-3 md:pr-4" style="min-width: 0;">
                        <p class="font-semibold" style="font-size: clamp(14px, 3.5vw, 18px); word-break: break-word;">${item.label}</p>
                        ${item.quantity > 1 ? `<p class="text-gray-500 font-medium" style="font-size: clamp(12px, 3vw, 14px);">${item.quantity} x ${formatCurrency(item.price)}</p>` : ''}
                    </div>
                    <div class="flex items-center" style="gap: clamp(8px, 2vw, 12px); flex-shrink: 0;">
                        <span class="font-bold text-gray-700 text-right" style="font-size: clamp(14px, 3.5vw, 18px); min-width: clamp(60px, 15vw, 80px);">${formatCurrency(totalItemPrice)}</span>
                        ${controls}
                    </div>
                `;
                return itemElement;
            };

            if (areas.length > 0) {
                const container = document.createElement('div');
                container.className = 'p-4 md:p-4 border-2 border-gray-200 rounded-xl mb-4 md:mb-4';
                const title = document.createElement('h4');
                title.className = 'font-bold text-gray-700 mb-3 md:mb-3 pb-2 md:pb-2 border-b-2';
                title.style.fontSize = 'clamp(14px, 3.5vw, 18px)';
                title.textContent = '√Åreas';
                container.appendChild(title);
                areas.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            if (addons.length > 0) {
                const container = document.createElement('div');
                container.className = 'p-4 md:p-4 border-2 border-gray-200 rounded-xl mb-4 md:mb-4';
                const title = document.createElement('h4');
                title.className = 'font-bold text-gray-700 mb-3 md:mb-3 pb-2 md:pb-2 border-b-2';
                title.style.fontSize = 'clamp(14px, 3.5vw, 18px)';
                title.textContent = 'Complementos';
                container.appendChild(title);
                addons.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            const feeContainer = document.createElement('div');
            feeContainer.className = 'p-4 md:p-4 border-2 border-amber-300 bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl';
            feeContainer.innerHTML = `
                <div class="flex justify-between items-center" style="gap: 12px; flex-wrap: wrap;">
                    <p class="font-bold text-amber-900" style="font-size: clamp(14px, 3.5vw, 18px);">üí≥ Cuota de activaci√≥n</p>
                    <span class="font-extrabold text-amber-900" style="font-size: clamp(15px, 4vw, 20px);">${formatCurrency(ACTIVATION_FEE)}</span>
                </div>
            `;
            summaryList.appendChild(feeContainer);
        };

        const updateChart = () => {
            if (!costChart) return;
            
            const hasItems = Object.keys(state.selectedItems).length > 0 || state.totalCost > 0;
            const labels = [];
            const data = [];
            const colors = [];

            if (hasItems) {
                labels.push('Cuota Fija');
                data.push(ACTIVATION_FEE);
                colors.push('#f59e0b');
            }

            const areasCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'area')
                .reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

            if (areasCost > 0) {
                labels.push('√Åreas');
                data.push(areasCost);
                colors.push('#667eea');
            }

            const addonsCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'addon')
                .reduce((sum, item) => sum + item.price, 0);

            if (addonsCost > 0) {
                labels.push('Complementos');
                data.push(addonsCost);
                colors.push('#764ba2');
            }

            if (data.length === 0) {
                costChart.data.labels = ['Vac√≠o'];
                costChart.data.datasets[0].data = [1];
                costChart.data.datasets[0].backgroundColor = ['#e5e7eb'];
            } else {
                costChart.data.labels = labels;
                costChart.data.datasets[0].data = data;
                costChart.data.datasets[0].backgroundColor = colors;
            }

            costChart.update();
        };

        const calculateTotal = () => {
            const hasArea = Object.values(state.selectedItems).some(item => item.type === 'area');
            const hasGarbage = state.selectedItems['basura-5'] || state.selectedItems['basura-10'];

            if (hasArea && !hasGarbage) {
                const garbageCheckbox = document.getElementById('basura-5');
                if (garbageCheckbox) {
                    state.selectedItems['basura-5'] = {
                        id: 'basura-5',
                        price: parseFloat(garbageCheckbox.dataset.price),
                        label: garbageCheckbox.dataset.label,
                        type: 'addon'
                    };
                    garbageCheckbox.checked = true;
                }
            }

            let subtotal = 0;
            const items = Object.values(state.selectedItems);

            items.forEach(item => {
                const quantity = item.quantity || 1;
                subtotal += item.price * quantity;
            });
            
            if (items.length > 0) {
                state.totalCost = ACTIVATION_FEE + subtotal;
            } else {
                state.totalCost = 0;
            }
            
            state.costPerPerson = state.totalCost > 0 ? state.totalCost / state.roommatesCount : 0;
            updateUI();
        };
        
        const handleCheckboxChange = (e) => {
            const checkbox = e.target;
            const id = checkbox.id;
            const price = parseFloat(checkbox.dataset.price);
            const label = checkbox.dataset.label;
            const type = checkbox.dataset.type;
            const groupContainer = checkbox.closest('.addon-group');

            if (groupContainer) {
                const groupName = groupContainer.dataset.groupName;
                const otherCheckboxes = groupContainer.querySelectorAll(`input[type="checkbox"]:not(#${id})`);
                
                if (checkbox.checked) {
                    otherCheckboxes.forEach(other => {
                        if (other.checked) {
                            other.checked = false;
                            delete state.selectedItems[other.id];
                        }
                    });
                }
            }
            
            if (checkbox.checked) {
                state.selectedItems[id] = { id, price, label, type };
            } else {
                delete state.selectedItems[id];
            }

            calculateTotal();
        };

        const setupCounter = (id, stateKey, min, max, label, price, type) => {
            const decrementBtn = document.getElementById(`${id}-decrement`);
            const incrementBtn = document.getElementById(`${id}-increment`);
            const display = document.getElementById(`${id}-display`);

            const update = (newValue) => {
                newValue = Math.max(min, Math.min(newValue, max));
                state[stateKey] = newValue;
                
                if (label && price) {
                    const itemId = id;
                    if (newValue > 0) {
                        state.selectedItems[itemId] = {
                            id: itemId,
                            price: price,
                            label: label,
                            type: type,
                            quantity: newValue
                        };
                    } else {
                        delete state.selectedItems[itemId];
                    }
                }
                calculateTotal();
            };

            decrementBtn.addEventListener('click', () => update(state[stateKey] - 1));
            incrementBtn.addEventListener('click', () => update(state[stateKey] + 1));
        };
        
        const setupRoommatesCounter = () => {
            const decrementBtns = [document.getElementById('roommates-decrement'), document.getElementById('modal-roommates-decrement')];
            const incrementBtns = [document.getElementById('roommates-increment'), document.getElementById('modal-roommates-increment')];
            
            const update = (newValue) => {
                newValue = Math.max(1, Math.min(newValue, 10));
                state.roommatesCount = newValue;
                calculateTotal();
            };

            decrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount - 1)));
            incrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount + 1)));
        };

        const showError = (fieldId, message) => {
            const input = document.getElementById(fieldId);
            const error = document.getElementById(`error${fieldId.charAt(0).toUpperCase() + fieldId.slice(1)}`);
            input.classList.add('error');
            error.textContent = message;
            error.classList.add('show');
        };

        const hideError = (fieldId) => {
            const input = document.getElementById(fieldId);
            const error = document.getElementById(`error${fieldId.charAt(0).toUpperCase() + fieldId.slice(1)}`);
            input.classList.remove('error');
            error.classList.remove('show');
        };

        const validateClientForm = () => {
            let isValid = true;
            const today = new Date().toISOString().split('T')[0];

            const nombre = document.getElementById('nombre');
            if (!nombre.value.trim()) {
                showError('nombre', 'Por favor, ingresa tu nombre completo');
                isValid = false;
            } else {
                hideError('nombre');
            }

            const fields = ['calle', 'portal', 'piso', 'puerta'];
            fields.forEach(field => {
                const input = document.getElementById(field);
                if (!input.value.trim()) {
                    showError(field, field === 'calle' ? 'Por favor, ingresa la calle y n√∫mero' : 'Campo requerido');
                    isValid = false;
                } else {
                    hideError(field);
                }
            });

            const fecha1 = document.getElementById('fecha1');
            const fecha2 = document.getElementById('fecha2');

            if (!fecha1.value) {
                showError('fecha1', 'Selecciona la primera fecha');
                isValid = false;
            } else if (fecha1.value < today) {
                showError('fecha1', 'La fecha no puede ser anterior a hoy');
                isValid = false;
            } else {
                hideError('fecha1');
            }

            if (!fecha2.value) {
                showError('fecha2', 'Selecciona la segunda fecha');
                isValid = false;
            } else if (fecha2.value < today) {
                showError('fecha2', 'La fecha no puede ser anterior a hoy');
                isValid = false;
            } else {
                hideError('fecha2');
            }

            return isValid;
        };
        
        const showSection = (sectionId) => {
            document.getElementById('calculator-section').style.display = sectionId === 'calculator' ? 'block' : 'none';
            document.getElementById('client-form-section').classList.toggle('active', sectionId === 'form');
            state.currentSection = sectionId;
            document.getElementById('final-summary-modal').classList.remove('open');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const showCalculatorSection = () => {
            showSection('calculator');
        };

        const showClientFormSection = () => {
            if (state.totalCost === 0) {
                alert('Por favor, selecciona al menos un servicio antes de continuar.');
                document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            showSection('form');
        };

        const showFinalSummary = () => {
            const nombre = document.getElementById('nombre').value;
            const calle = document.getElementById('calle').value;
            const portal = document.getElementById('portal').value;
            const piso = document.getElementById('piso').value;
            const puerta = document.getElementById('puerta').value;
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;

            const referralCode = state.referralCode;

            document.getElementById('final-nombre').textContent = nombre;
            document.getElementById('final-direccion').textContent = `${calle}, Portal ${portal}, ${piso}, Puerta ${puerta}`;
            document.getElementById('final-fecha1').textContent = formatDate(fecha1);
            document.getElementById('final-fecha2').textContent = formatDate(fecha2);
            document.getElementById('final-total-cost').textContent = formatCurrency(state.totalCost);
            document.getElementById('final-cost-per-person').textContent = formatCurrency(state.costPerPerson, true);
            document.getElementById('final-roommates-count').textContent = state.roommatesCount;
            document.getElementById('final-roommates-plural').textContent = state.roommatesCount === 1 ? '' : 's';

            if (referralCode) {
                document.getElementById('final-referral-code').textContent = referralCode;
                document.getElementById('referral-code-section').style.display = 'block';
            } else {
                document.getElementById('referral-code-section').style.display = 'none';
            }

            const servicesList = document.getElementById('final-services-list');
            servicesList.innerHTML = '';

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area');
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon');

            [...areas, ...addons].forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'summary-item';
                const quantityText = item.quantity > 1 ? ` (x${item.quantity})` : '';
                const totalItemPrice = item.price * (item.quantity || 1);
                itemDiv.innerHTML = `
                    <span class="summary-item-label">${item.label}${quantityText}</span>
                    <span class="summary-item-value">${formatCurrency(totalItemPrice)}</span>
                `;
                servicesList.appendChild(itemDiv);
            });

            document.getElementById('final-summary-modal').classList.add('open');
        };

        const sendWhatsAppMessage = () => {
            const nombre = document.getElementById('nombre').value;
            const calle = document.getElementById('calle').value;
            const portal = document.getElementById('portal').value;
            const piso = document.getElementById('piso').value;
            const puerta = document.getElementById('puerta').value;
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;
            const referralCode = state.referralCode;
            
            let message = "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += "*SOLICITUD DE SERVICIO*\n";
            message += "*PLAN LIMPIEZA10*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
            
            message += "*DATOS DEL CLIENTE*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `Nombre: *${nombre}*\n`;
            message += `Direcci√≥n: *${calle}*\n`;
            message += `Portal: *${portal}* | Piso: *${piso}* | Puerta: *${puerta}*\n`;
            message += `Ciudad: *Valencia capital*\n\n`;

            message += "*FECHAS DISPONIBLES*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `Primera opci√≥n: *${formatDate(fecha1)}*\n`;
            message += `Segunda opci√≥n: *${formatDate(fecha2)}*\n\n`;
            
            if (referralCode) {
                message += "*C√ìDIGO DE REFERIDO*\n";
                message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
                message += `C√≥digo: *${referralCode}*\n\n`;
            }
            
            message += "*SERVICIOS SOLICITADOS*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            
            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area');
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon');
            
            if (areas.length > 0) {
                message += "\nüè† *√ÅREAS*\n";
                areas.forEach(item => {
                    const qty = item.quantity > 1 ? ` (x${item.quantity})` : '';
                    const totalPrice = item.price * (item.quantity || 1);
                    message += `‚Ä¢ ${item.label}${qty}: *${formatCurrency(totalPrice)}*\n`;
                });
            }
            
            if (addons.length > 0) {
                message += "\n‚ú® *COMPLEMENTOS*\n";
                addons.forEach(item => {
                    message += `‚Ä¢ ${item.label}: *${formatCurrency(item.price)}*\n`;
                });
            }
            
            message += "\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `üí≥ Cuota de activaci√≥n: *${formatCurrency(ACTIVATION_FEE)}*\n`;
            message += `üí∞ *TOTAL: ${formatCurrency(state.totalCost)}*\n`;
            message += `üë• Compa√±eros de piso: *${state.roommatesCount}*\n`;
            message += `üíµ Coste por persona: *${formatCurrency(state.costPerPerson, true)}*\n`;
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        };

        document.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('costChart').getContext('2d');
            costChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vac√≠o'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#e5e7eb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: window.innerWidth < 768 ? 12 : 14,
                                    weight: '600'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed);
                                    return `${label}: ${value}`;
                                }
                            },
                            backgroundColor: '#1E293B',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            padding: 12,
                            cornerRadius: 6
                        }
                    }
                }
            });

            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });

            setupCounter('bano', 'banoCount', 0, 5, 'Ba√±os', 10, 'area');
            setupCounter('habitacion', 'habitacionCount', 0, 10, 'Habitaciones', 10, 'area');
            setupRoommatesCounter();

            document.getElementById('floating-cart-button').addEventListener('click', () => {
                modal.classList.add('open');
                const modalSummaryList = document.getElementById('modal-summary-list');
                modalSummaryList.innerHTML = summaryList.innerHTML;
                
                modalSummaryList.querySelectorAll('[data-action]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const id = e.currentTarget.dataset.id;
                        
                        if (action === 'remove') {
                            const checkbox = document.getElementById(id);
                            if (checkbox) checkbox.checked = false;
                            delete state.selectedItems[id];
                            calculateTotal();
                            modal.classList.remove('open');
                        } else if (action === 'increment') {
                            const stateKey = id + 'Count';
                            state[stateKey] = Math.min(state[stateKey] + 1, id === 'bano' ? 5 : 10);
                            if (state[stateKey] > 0) {
                                state.selectedItems[id].quantity = state[stateKey];
                            }
                            calculateTotal();
                            modal.classList.remove('open');
                        } else if (action === 'decrement') {
                            const stateKey = id + 'Count';
                            state[stateKey] = Math.max(state[stateKey] - 1, 0);
                            if (state[stateKey] > 0) {
                                state.selectedItems[id].quantity = state[stateKey];
                            } else {
                                delete state.selectedItems[id];
                            }
                            calculateTotal();
                            modal.classList.remove('open');
                        }
                    });
                });
            });

            document.getElementById('close-modal').addEventListener('click', () => {
                modal.classList.remove('open');
            });

            document.getElementById('modal-continue-btn').addEventListener('click', () => {
                modal.classList.remove('open');
                showClientFormSection();
            });

            document.getElementById('continue-to-form-btn').addEventListener('click', showClientFormSection);
            document.getElementById('back-to-calculator-btn').addEventListener('click', showCalculatorSection);

            document.getElementById('submit-form-btn').addEventListener('click', () => {
                if (!validateClientForm()) {
                    return;
                }

                const referralInput = document.getElementById('referral-code-input');
                state.referralCode = referralInput.value.trim().toUpperCase();

                showFinalSummary();
            });

            document.getElementById('cancel-final-summary-btn').addEventListener('click', () => {
                document.getElementById('final-summary-modal').classList.remove('open');
            });

            document.getElementById('send-whatsapp-btn').addEventListener('click', sendWhatsAppMessage);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('open');
                }
            });

            document.getElementById('final-summary-modal').addEventListener('click', (e) => {
                if (e.target.id === 'final-summary-modal') {
                    e.target.classList.remove('open');
                }
            });

            updateUI();
        });
    </script>
</body>
</html>