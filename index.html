<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale= 1.0">
    <title>Plan-Limpieza10 | App de Limpieza para Estudiantes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Estilos base para la fuente y el cuerpo del documento */
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-50 text-gray-800;
        }
        
        /* Estilo para el texto con gradiente, usado en el t√≠tulo principal */
        .gradient-text {
            background: linear-gradient(to right, #3357FF, #FF33A1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Contenedor del gr√°fico para asegurar la correcta visualizaci√≥n */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 280px;
            max-height: 320px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 320px;
                max-height: 350px;
            }
        }
        
        /* Estilos para las etiquetas de las opciones de limpieza */
        .checkbox-label {
            transition: all 0.2s ease-in-out;
        }
        
        /* Efecto de hover */
        .checkbox-label:hover {
            background-color: #f0f3ff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        /* Estilo cuando una opci√≥n est√° seleccionada (basado en el estado del checkbox) */
        input:checked + .checkbox-label {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            transform: scale(1.02);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        /* Clase para los contenedores de los campos num√©ricos cuando est√°n seleccionados */
        .is-selected {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Estilos para los nuevos botones de incremento/decremento */
        .count-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .count-btn {
            background-color: #e5e7eb;
            color: #4b5563;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .count-btn:hover {
            background-color: #d1d5db;
        }
        
        .count-display {
            width: 2.5rem;
            text-align: center;
            font-weight: 600;
            user-select: none;
        }

        /* Contenedor principal para los elementos flotantes */
        #floating-elements-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: flex-end; /* Alinea los elementos a la derecha */
        }

        /* Estilos para el bot√≥n flotante del carrito */
        #floating-cart-button {
            background-color: #3b82f6; /* Tailwind blue-500 */
            color: white;
            border-radius: 9999px; /* rounded-full */
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, transform 0.2s, opacity 0.3s;
            cursor: pointer;
            visibility: visible;
            opacity: 1;
            position: relative;
        }
        
        #floating-cart-button:hover {
            background-color: #2563eb; /* Tailwind blue-600 */
            transform: translateY(-2px);
        }
        
        /* Estilos para el contador del bot√≥n flotante */
        #floating-total-cost-display {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 9999px;
            padding: 0.25rem 0.6rem;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            display: none;
            transition: opacity 0.2s, transform 0.2s;
            transform: scale(0.8);
            opacity: 0;
        }
        
        #floating-total-cost-display.visible {
            display: block;
            transform: scale(1);
            opacity: 1;
        }

        /* Estilo espec√≠fico para el icono de persona para que sea del color exacto de la cuota fija */
        .icon-pink {
            color: #FF33A1;
        }

        /* Animaci√≥n para el bot√≥n de reserva */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulsing-button {
            animation: pulse 2s infinite ease-in-out;
        }
        
        /* Estilos del modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s linear;
        }

        .modal-overlay.open {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.open .modal-content {
            transform: scale(1);
        }
        
        /* Controles de cantidad en el modal */
        .modal-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-item-btn {
            background-color: #e5e7eb;
            color: #4b5563;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .modal-item-btn:hover {
            background-color: #d1d5db;
        }
        
        .modal-remove-btn {
            background-color: transparent;
            color: #ef4444; /* red-500 */
            border: none;
            cursor: pointer;
            font-size: 1.2rem; /* Reduced size a bit */
            padding: 0;
            transition: color 0.2s;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-remove-btn:hover {
            color: #b91c1c; /* red-700 */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    
    <!-- Contenedor principal de la p√°gina -->
    <main class="container mx-auto px-4 py-8 md:py-12">

        <!-- Cabecera de la p√°gina -->
        <header class="text-center mb-16 pt-10">
            <div class="relative max-w-7xl mx-auto flex flex-col items-center">
                <!-- Contenedor de iconos de acceso directo -->
                <div class="flex space-x-4 mb-6 md:absolute md:top-0 md:right-0">
                    <a href="https://te-echounamano.blogspot.com/" target="_blank" title="TUM TeEchoUnaMano Web" class="text-xl md:text-2xl text-gray-500 hover:text-blue-600 transition-colors">
                        <i class="fas fa-home"></i>
                    </a>
                    <a href="https://apm-tum.blogspot.com/" target="_blank" title="Soporte A-TUM" class="text-xl md:text-2xl text-gray-500 hover:text-blue-600 transition-colors">
                        <i class="fas fa-headset"></i>
                    </a>
                    <a href="https://t.me/TumAgenda_bot" target="_blank" title="Bot de Telegram" class="text-xl md:text-2xl text-gray-500 hover:text-blue-600 transition-colors">
                        <i class="fas fa-robot"></i>
                    </a>
                </div>
                <!-- Contenido principal de la cabecera -->
                <h1 class="text-4xl md:text-6xl font-black mb-4"><span class="gradient-text">Plan-Limpieza10</span></h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">La limpieza de tu<b> piso de estudiante</b>, solucionada. Es la forma m√°s f√°cil y econ√≥mica de mantener vuestro piso limpio. Personaliza tu plan, comparte los gastos y olv√≠date de discutir por turnos.</p>
            </div>
        </header>

        <!-- Secci√≥n "C√≥mo Funciona" -->
        <section id="how-it-works" class="mb-20">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-12">¬øC√≥mo Funciona? Sencillo y Transparente</h2>
                <div class="flex flex-col md:flex-row items-stretch justify-center text-center">
                    <!-- Paso 1 -->
                    <div class="flex-1 p-4 flex flex-col items-center">
                        <div class="bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl font-bold mb-4 shadow-lg">1</div>
                        <p class="text-gray-600">Una √∫nica cuota de 10‚Ç¨ te da acceso a un servicio de limpieza completo y a medida. Es tu pase directo a un espacio limpio.</p>
                    </div>
                    <!-- Separador vertical/horizontal -->
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 bg-gray-300 md:h-12 md:w-0.5"></div></div>
                    <!-- Paso 2 -->
                    <div class="flex-1 p-4 flex flex-col items-center">
                        <div class="bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl font-bold mb-4 shadow-lg">2</div>
                        <p class="text-gray-600">Elige las √°reas de tu piso que necesitan un repaso por solo 10‚Ç¨ cada una y a√±ade los complementos que quieras.</p>
                    </div>
                    <!-- Separador vertical/horizontal -->
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 bg-gray-300 md:h-12 md:w-0.5"></div></div>
                    <!-- Paso 3 -->
                    <div class="flex-1 p-4 flex flex-col items-center">
                        <div class="bg-green-500 text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl font-bold mb-4 shadow-lg">‚úì</div>
                        <p class="text-gray-600">Disfruta de tu casa impecable y divide el coste total entre tus compa√±eros de piso. Sin estr√©s, sin peleas.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n del Simulador -->
        <section id="simulator" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 mb-20">
            <h2 class="text-3xl font-bold text-center mb-2">Dise√±a tu Limpieza a Medida</h2>
            <p class="text-center text-gray-600 mb-2">Construye tu paquete de limpieza y mira el coste en tiempo real.</p>
            <p class="text-center text-gray-600 italic max-w-2xl mx-auto mb-10">Este servicio est√° dise√±ado para una <b>limpieza r√°pida y eficiente</b>. Si necesitas un servicio m√°s profundo, limpieza de ventanas u otras tareas, ofrecemos planes por hora y presupuestos personalizados. ¬°Solo tienes que consultarnos!</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                <!-- Columna de selecci√≥n de √°reas y complementos -->
                <div>
                    <!-- √Åreas a limpiar -->
                    <h3 id="areas-section" class="text-xl font-bold mb-4">1. Elige las √°reas a limpiar (10‚Ç¨ c/u)</h3>
                    <div class="space-y-3">
                        <input type="checkbox" id="salon" class="hidden peer" data-price="10" data-label="Sal√≥n / Comedor" data-type="area">
                        <label for="salon" class="checkbox-label cursor-pointer flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg"><div><span class="text-2xl mr-3">üõãÔ∏è</span> <span class="font-semibold">Sal√≥n / Comedor</span></div><span class="text-gray-500 font-bold">10‚Ç¨</span></label>
                        
                        <input type="checkbox" id="cocina" class="hidden peer" data-price="10" data-label="Cocina" data-type="area">
                        <label for="cocina" class="checkbox-label cursor-pointer flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg"><div><span class="text-2xl mr-3">üç≥</span> <span class="font-semibold">Cocina</span></div><span class="text-gray-500 font-bold">10‚Ç¨</span></label>
                        
                        <!-- Contador de ba√±os -->
                        <div id="bano-container" class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg transition-colors">
                            <div><span class="text-2xl mr-3">üöΩ</span> <span class="font-semibold">Ba√±os</span></div>
                            <div class="count-controls">
                                <button id="bano-decrement" class="count-btn">-</button>
                                <span id="bano-display" class="count-display">0</span>
                                <button id="bano-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <!-- Contador de habitaciones -->
                        <div id="habitacion-container" class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg transition-colors">
                            <div><span class="text-2xl mr-3">üõèÔ∏è</span> <span class="font-semibold">Habitaciones</span></div>
                            <div class="count-controls">
                                <button id="habitacion-decrement" class="count-btn">-</button>
                                <span id="habitacion-display" class="count-display">0</span>
                                <button id="habitacion-increment" class="count-btn">+</button>
                            </div>
                        </div>

                        <input type="checkbox" id="lavanderia" class="hidden peer" data-price="10" data-label="Lavander√≠a" data-type="area">
                        <label for="lavanderia" class="checkbox-label cursor-pointer flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg"><div><span class="text-2xl mr-3">üß∫</span> <span class="font-semibold">Lavander√≠a</span></div><span class="text-gray-500 font-bold">10‚Ç¨</span></label>

                        <input type="checkbox" id="terrazas" class="hidden peer" data-price="10" data-label="Limpieza de Terrazas" data-type="area">
                        <label for="terrazas" class="checkbox-label cursor-pointer flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg"><div><span class="text-2xl mr-3">‚òÄÔ∏è</span> <span class="font-semibold">Limpieza de Terrazas</span></div><span class="text-gray-500 font-bold">10‚Ç¨</span></label>
                    </div>

                    <!-- Complementos -->
                    <h3 class="text-xl font-bold mb-4 mt-8">2. A√±ade complementos</h3>
                    <div class="space-y-3">
                        <!-- Add-on: Pasillo -->
                        <div class="addon-container p-4 border-2 border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3"><span class="text-2xl mr-3">üö™</span> Pasillo (√°rea com√∫n)</h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="pasillo">
                                <input type="checkbox" id="pasillo-5" class="hidden peer" data-price="5" data-label="Pasillo: menos de 5m¬≤" data-type="addon">
                                <label for="pasillo-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">Menos de 5m¬≤</span>
                                    <span class="text-gray-500 font-bold">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="pasillo-10" class="hidden peer" data-price="10" data-label="Pasillo: 5m¬≤ o m√°s" data-type="addon">
                                <label for="pasillo-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">5m¬≤ o m√°s</span>
                                    <span class="text-gray-500 font-bold">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Fregar Platos -->
                        <div class="addon-container p-4 border-2 border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3">
                                <span class="text-2xl mr-3">üçΩÔ∏è</span> Fregar Platos
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="platos">
                                <input type="checkbox" id="platos-5" class="hidden peer" data-price="5" data-label="Fregar Platos: 1 carga" data-type="addon">
                                <label for="platos-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">1 Carga</span>
                                    <span class="text-gray-500 font-bold">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="platos-10" class="hidden peer" data-price="10" data-label="Fregar Platos: M√°s de 1 carga" data-type="addon">
                                <label for="platos-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">M√°s de 1 Carga</span>
                                    <span class="text-gray-500 font-bold">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Limpieza de Mamparas -->
                        <div class="addon-container p-4 border-2 border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3"><span class="text-2xl mr-3">üöø</span> Limpieza de Mamparas</h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="mamparas">
                                <input type="checkbox" id="mamparas-5" class="hidden peer" data-price="5" data-label="Mamparas: 1-2m" data-type="addon">
                                <label for="mamparas-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">1-2m</span>
                                    <span class="text-gray-500 font-bold">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="mamparas-10" class="hidden peer" data-price="10" data-label="Mamparas: M√°s de 2m" data-type="addon">
                                <label for="mamparas-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">M√°s de 2m</span>
                                    <span class="text-gray-500 font-bold">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Recogida de Basura -->
                        <div class="addon-container p-4 border-2 border-gray-200 rounded-lg">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3"><span class="text-2xl mr-3">üóëÔ∏è</span> Recogida de Basura</h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="basura">
                                <input type="checkbox" id="basura-5" class="hidden peer" data-price="5" data-label="Recogida de Basura: 1-2 bolsas" data-type="addon">
                                <label for="basura-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">1-2 bolsas <span class="font-normal">(Obligatorio con √°reas)</span></span>
                                    <span class="text-gray-500 font-bold">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="basura-10" class="hidden peer" data-price="10" data-label="Recogida de Basura: M√°s de 2 bolsas" data-type="addon">
                                <label for="basura-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg">
                                    <span class="font-semibold text-center mb-1">M√°s de 2 bolsas</span>
                                    <span class="text-gray-500 font-bold">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Columna de resumen de costes -->
                <div>
                    <!-- Contador de compa√±eros de piso -->
                    <h3 class="text-xl font-bold mb-4">3. ¬øCu√°ntos sois en el piso?</h3>
                    <p class="text-gray-600 text-sm mb-4">Si pagas el servicio para ti, selecciona 1 persona. Si sois m√°s, selecciona el n√∫mero de compa√±eros para dividir los gastos.</p>
                    <div id="roommates-container" class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg transition-colors mb-6">
                        <div><span class="text-2xl icon-pink mr-3">üë§</span> <span class="font-semibold">Compa√±eros</span></div>
                        <div class="count-controls">
                            <button id="roommates-decrement" class="count-btn">-</button>
                            <span id="roommates-count" class="count-display">1</span>
                            <button id="roommates-increment" class="count-btn">+</button>
                        </div>
                    </div>

                    <!-- Visualizaci√≥n de costes -->
                    <div class="sticky top-6">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="p-4 bg-gray-100 rounded-lg text-center">
                                <p class="text-gray-600 text-sm">COSTE TOTAL</p>
                                <p id="total-cost" class="text-3xl font-extrabold text-blue-600">0‚Ç¨</p>
                            </div>
                            <div class="p-4 bg-gray-100 rounded-lg text-center">
                                <p class="text-gray-600 text-sm">COSTE POR PERSONA</p>
                                <p id="cost-per-person" class="text-3xl font-extrabold text-green-600">0.00‚Ç¨</p>
                            </div>
                        </div>

                        <!-- Gr√°fico de desglose de costes -->
                        <h3 class="text-xl font-bold mb-4 text-center">Desglose del Coste</h3>
                        <div class="chart-container">
                            <canvas id="costBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pie de p√°gina con el bot√≥n de reserva -->
        <footer class="text-center mt-16 mb-20">
            <h3 class="text-2xl md:text-3xl font-bold mb-4">¬øTodo claro?</h3>
            <p class="text-gray-600 mb-8 max-w-xl mx-auto">Contacta con nosotros para reservar tu primera limpieza y descubre lo f√°cil que es tener un piso impecable.</p>
            
            <!-- Campo de Cup√≥n/C√≥digo en la vista principal -->
            <div class="max-w-sm mx-auto mb-6">
                <label for="main-coupon-code" class="block mb-2 text-sm font-medium text-gray-700">¬øTienes un cup√≥n o c√≥digo de referido?</label>
                <input type="text" id="main-coupon-code" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Escribe tu c√≥digo aqu√≠">
            </div>

            <button id="book-now-btn" class="bg-pink-500 text-white font-bold py-4 px-10 rounded-full hover:bg-pink-600 transition-transform hover:scale-105 text-lg shadow-lg pulsing-button">¬°Reservar Mi Limpieza Ahora!</button>
        </footer>

    </main>

    <!-- Contenedor principal para los elementos flotantes -->
    <div id="floating-elements-container">
        <!-- Bot√≥n flotante para el resumen de costes -->
        <button id="floating-cart-button" aria-label="Mostrar resumen de costes">
            <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.023.832l.638 3.092m3.228-3.092h8.252a1.875 1.875 0 011.875 1.875V15.75m-4.125-9H15.82a1.125 1.125 0 011.125 1.125v1.25m-14.25-3.625L7.926 17.53A2.875 2.875 0 0010.597 19h9.378a2.875 2.875 0 002.875-2.875V11.25m-15.375-3.625H11.25m5.25 7.125a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
            </svg>
            <span id="floating-total-cost-display">0‚Ç¨</span>
        </button>
    </div>

    <!-- Modal para el resumen del pedido -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center pb-4 border-b border-gray-200 mb-4">
                <h3 class="text-2xl font-bold text-gray-800">Resumen de mi pedido</h3>
                <button id="close-modal-button" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Lista de elementos del pedido -->
            <div>
                <div id="summary-list" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                    <!-- Los √≠tems seleccionados se insertar√°n aqu√≠ din√°micamente -->
                    <p class="text-gray-500 text-center py-4">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>
                </div>
            </div>

            <!-- Secci√≥n de compa√±eros de piso en el modal -->
            <div id="modal-roommates-container" class="mt-4 p-4 border-2 border-gray-200 rounded-lg transition-colors">
                <div class="flex items-center justify-between mb-2">
                    <div><span class="text-2xl icon-pink mr-3">üë§</span> <span class="font-semibold">Compa√±eros</span></div>
                    <div class="count-controls">
                        <button id="modal-roommates-decrement" class="count-btn">-</button>
                        <span id="modal-roommates-count" class="count-display">1</span>
                        <button id="modal-roommates-increment" class="count-btn">+</button>
                    </div>
                </div>
                <!-- Coste por persona en el modal -->
                <div class="text-center font-bold text-lg text-green-600">
                    <span id="modal-cost-per-person">0.00‚Ç¨</span> por persona
                </div>
            </div>
            
            <!-- Secci√≥n de Cup√≥n/C√≥digo -->
            <div class="mt-4">
                <label for="coupon-code" class="block mb-2 text-sm font-medium text-gray-700">¬øTienes un cup√≥n o c√≥digo de referido?</label>
                <input type="text" id="coupon-code" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Escribe tu c√≥digo aqu√≠">
            </div>

            <div class="mt-4 flex justify-between items-center font-bold text-lg">
                <span class="text-gray-800">Total:</span>
                <span id="summary-total" class="text-blue-600 text-2xl">0.00‚Ç¨</span>
            </div>
            <button id="modal-book-now-btn" class="mt-6 w-full bg-pink-500 text-white font-bold py-3 px-6 rounded-full hover:bg-pink-600 transition-transform hover:scale-105 text-lg shadow-lg text-center">¬°Reservar Mi Limpieza Ahora!</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTES Y CONFIGURACI√ìN ---
            const ACTIVATION_FEE = 10;
            const WHATSAPP_NUMBER = '34602846694'; // Reemplazar con tu n√∫mero real

            // --- ESTADO DE LA APLICACI√ìN (nuestra "memoria" central) ---
            const state = {
                banoCount: 0,
                habitacionCount: 0,
                roommatesCount: 1,
                selectedItems: {}, // Un objeto para guardar todo lo seleccionado
                totalCost: 0,
                costPerPerson: 0
            };

            // --- ELEMENTOS DEL DOM (accesos directos a los elementos HTML) ---
            const totalCostDisplay = document.getElementById('total-cost');
            const costPerPersonDisplay = document.getElementById('cost-per-person');
            const floatingCostDisplay = document.getElementById('floating-total-cost-display');
            const summaryList = document.getElementById('summary-list');
            const summaryTotal = document.getElementById('summary-total');
            const modalCostPerPerson = document.getElementById('modal-cost-per-person');
            const modal = document.getElementById('summary-modal');
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            const addonGroups = document.querySelectorAll('.addon-group');
            let costChart;

            // --- FUNCIONES ---

            /**
             * Formatea un n√∫mero a una cadena de texto con el s√≠mbolo del euro.
             */
            const formatCurrency = (value, useDecimals = false) => {
                const options = useDecimals ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : { minimumFractionDigits: 0, maximumFractionDigits: 0 };
                return value.toLocaleString('es-ES', options) + '‚Ç¨';
            };


            /**
             * Actualiza la interfaz de usuario con los valores del estado actual.
             */
            const updateUI = () => {
                totalCostDisplay.textContent = formatCurrency(state.totalCost);
                costPerPersonDisplay.textContent = formatCurrency(state.costPerPerson, true);
                summaryTotal.textContent = formatCurrency(state.totalCost, true);
                modalCostPerPerson.textContent = formatCurrency(state.costPerPerson, true);

                // Update floating cart button
                if (state.totalCost > 0) {
                    floatingCostDisplay.textContent = formatCurrency(state.totalCost);
                    floatingCostDisplay.classList.add('visible');
                } else {
                    floatingCostDisplay.classList.remove('visible');
                }

                // Update display values for counters
                document.getElementById('bano-display').textContent = state.banoCount;
                document.getElementById('habitacion-display').textContent = state.habitacionCount;
                document.getElementById('roommates-count').textContent = state.roommatesCount;
                document.getElementById('modal-roommates-count').textContent = state.roommatesCount;

                // Update visual state for counters
                document.getElementById('bano-container').classList.toggle('is-selected', state.banoCount > 0);
                document.getElementById('habitacion-container').classList.toggle('is-selected', state.habitacionCount > 0);
                
                updateSummaryList();
                updateChart();
            };
            
            /**
             * Re-renderiza la lista de √≠tems en el modal de resumen.
             */
            const updateSummaryList = () => {
                summaryList.innerHTML = ''; // Limpiar la lista actual

                if (state.totalCost === 0) {
                    summaryList.innerHTML = '<p class="text-gray-500 text-center py-4">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>';
                    return;
                }

                const areas = Object.values(state.selectedItems).filter(item => item.type === 'area').sort((a,b) => a.label.localeCompare(b.label));
                const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon').sort((a,b) => a.label.localeCompare(b.label));

                const createItemNode = (item) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center py-1';
                    
                    let controls = '';
                    if (item.id === 'bano' || item.id === 'habitacion') {
                        controls = `
                            <div class="modal-item-controls">
                                <button class="modal-item-btn" data-action="decrement" data-id="${item.id}">-</button>
                                <span class="font-bold w-6 text-center">${item.quantity}</span>
                                <button class="modal-item-btn" data-action="increment" data-id="${item.id}">+</button>
                            </div>
                        `;
                    } else {
                        controls = `<button class="modal-remove-btn" data-action="remove" data-id="${item.id}"><i class="fas fa-trash-alt"></i></button>`;
                    }
                    
                    const totalItemPrice = item.price * (item.quantity || 1);

                    itemElement.innerHTML = `
                        <div class="flex-grow pr-2">
                            <p class="font-semibold">${item.label}</p>
                            ${item.quantity > 1 ? `<p class="text-sm text-gray-500">${item.quantity} x ${formatCurrency(item.price)}</p>` : ''}
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-bold text-gray-700 w-16 text-right">${formatCurrency(totalItemPrice)}</span>
                            ${controls}
                        </div>
                    `;
                    return itemElement;
                };

                // Render Areas
                if (areas.length > 0) {
                    const container = document.createElement('div');
                    container.className = 'p-3 border-2 border-gray-200 rounded-lg';
                    const title = document.createElement('h4');
                    title.className = 'font-bold text-md text-gray-700 mb-2 pb-2 border-b';
                    title.textContent = '√Åreas';
                    container.appendChild(title);
                    areas.forEach(item => container.appendChild(createItemNode(item)));
                    summaryList.appendChild(container);
                }

                // Render Addons
                if (addons.length > 0) {
                    const container = document.createElement('div');
                    container.className = 'p-3 border-2 border-gray-200 rounded-lg';
                    const title = document.createElement('h4');
                    title.className = 'font-bold text-md text-gray-700 mb-2 pb-2 border-b';
                    title.textContent = 'Complementos';
                    container.appendChild(title);
                    addons.forEach(item => container.appendChild(createItemNode(item)));
                    summaryList.appendChild(container);
                }

                // Render Activation Fee
                const feeContainer = document.createElement('div');
                feeContainer.className = 'p-3 border-2 border-gray-200 rounded-lg';
                feeContainer.innerHTML = `
                    <div class="flex justify-between items-center">
                        <p class="font-semibold">Cuota de activaci√≥n</p>
                        <span class="font-bold text-gray-700">${formatCurrency(ACTIVATION_FEE)}</span>
                    </div>
                `;
                summaryList.appendChild(feeContainer);
            };

            /**
             * Actualiza el gr√°fico de desglose de costes.
             */
            const updateChart = () => {
                if (!costChart) return;
                
                const hasItems = Object.keys(state.selectedItems).length > 0 || state.totalCost > 0;
                const labels = [];
                const data = [];
                const colors = [];

                if (hasItems) {
                    labels.push('Cuota Fija');
                    data.push(ACTIVATION_FEE);
                    colors.push('#FF33A1'); // Rosa para cuota fija
                }

                const areasCost = Object.values(state.selectedItems)
                    .filter(item => item.type === 'area')
                    .reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

                if (areasCost > 0) {
                    labels.push('√Åreas');
                    data.push(areasCost);
                    colors.push('#3357FF'); // Azul para √°reas
                }

                const addonsCost = Object.values(state.selectedItems)
                    .filter(item => item.type === 'addon')
                    .reduce((sum, item) => sum + item.price, 0);

                if (addonsCost > 0) {
                    labels.push('Complementos');
                    data.push(addonsCost);
                    colors.push('#4ade80'); // Verde para complementos
                }

                if (data.length === 0) { // Si no hay nada, mostrar un estado por defecto
                    costChart.data.labels = ['Vac√≠o'];
                    costChart.data.datasets[0].data = [1];
                    costChart.data.datasets[0].backgroundColor = ['#e5e7eb']; // Gris
                } else {
                    costChart.data.labels = labels;
                    costChart.data.datasets[0].data = data;
                    costChart.data.datasets[0].backgroundColor = colors;
                }

                costChart.update();
            };


            /**
             * Calcula el coste total y por persona bas√°ndose en el estado.
             */
            const calculateTotal = () => {
                // --- L√≥gica para "Recogida de Basura" obligatoria ---
                const hasArea = Object.values(state.selectedItems).some(item => item.type === 'area');
                const hasGarbage = state.selectedItems['basura-5'] || state.selectedItems['basura-10'];

                if (hasArea && !hasGarbage) {
                    const garbageCheckbox = document.getElementById('basura-5');
                    if (garbageCheckbox) { // No es necesario comprobar si est√° marcado, si no est√° en el state, lo a√±adimos
                        state.selectedItems['basura-5'] = {
                            id: 'basura-5',
                            price: parseFloat(garbageCheckbox.dataset.price),
                            label: garbageCheckbox.dataset.label,
                            type: 'addon'
                        };
                        garbageCheckbox.checked = true;
                    }
                }
                // --- Fin de la l√≥gica ---

                let subtotal = 0;
                const items = Object.values(state.selectedItems);

                items.forEach(item => {
                    const quantity = item.quantity || 1;
                    subtotal += item.price * quantity;
                });
                
                if (items.length > 0) {
                    state.totalCost = ACTIVATION_FEE + subtotal;
                } else {
                    state.totalCost = 0;
                }
                
                state.costPerPerson = state.totalCost > 0 ? state.totalCost / state.roommatesCount : 0;
                updateUI();
            };
            
            /**
             * Maneja el cambio de estado de un checkbox.
             */
            const handleCheckboxChange = (e) => {
                const checkbox = e.target;
                const id = checkbox.id;
                const price = parseFloat(checkbox.dataset.price);
                const label = checkbox.dataset.label;
                const type = checkbox.dataset.type;
                const groupContainer = checkbox.closest('.addon-group');

                // L√≥gica para grupos de addons exclusivos
                if (groupContainer) {
                    const groupName = groupContainer.dataset.groupName;
                    const otherCheckboxes = groupContainer.querySelectorAll(`input[type="checkbox"]:not(#${id})`);
                    
                    if (checkbox.checked) {
                        // Desmarcar otros en el mismo grupo
                        otherCheckboxes.forEach(other => {
                            if (other.checked) {
                                other.checked = false;
                                delete state.selectedItems[other.id];
                            }
                        });
                    }
                }
                
                if (checkbox.checked) {
                    state.selectedItems[id] = { id, price, label, type };
                } else {
                    delete state.selectedItems[id];
                }

                calculateTotal();
            };

            /**
             * Configura los controles de un contador (incremento/decremento).
             */
            const setupCounter = (id, stateKey, min, max, label, price, type) => {
                const decrementBtn = document.getElementById(`${id}-decrement`);
                const incrementBtn = document.getElementById(`${id}-increment`);
                const display = document.getElementById(`${id}-display`);

                const update = (newValue) => {
                    newValue = Math.max(min, Math.min(newValue, max));
                    state[stateKey] = newValue;
                    
                    if (label && price) { // Solo para contadores que son servicios (ba√±o, habitaci√≥n)
                        const itemId = id;
                        if (newValue > 0) {
                            state.selectedItems[itemId] = {
                                id: itemId,
                                price: price,
                                label: label,
                                type: type,
                                quantity: newValue
                            };
                        } else {
                            delete state.selectedItems[itemId];
                        }
                    }
                    calculateTotal();
                };

                decrementBtn.addEventListener('click', () => update(state[stateKey] - 1));
                incrementBtn.addEventListener('click', () => update(state[stateKey] + 1));
            };
            
            /**
             * Configura los contadores de compa√±eros de piso y los sincroniza.
             */
            const setupRoommatesCounter = () => {
                const decrementBtns = [document.getElementById('roommates-decrement'), document.getElementById('modal-roommates-decrement')];
                const incrementBtns = [document.getElementById('roommates-increment'), document.getElementById('modal-roommates-increment')];
                
                const update = (newValue) => {
                    newValue = Math.max(1, Math.min(newValue, 10)); // Min 1, Max 10 compa√±eros
                    state.roommatesCount = newValue;
                    calculateTotal();
                };

                decrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount - 1)));
                incrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount + 1)));
            };

            /**
             * Genera y abre el enlace de WhatsApp con el resumen del pedido.
             */
            const generateWhatsAppMessage = () => {
                if (state.totalCost === 0) {
                    // Create a custom alert message
                    const alertBox = document.createElement('div');
                    alertBox.style.position = 'fixed';
                    alertBox.style.top = '20px';
                    alertBox.style.left = '50%';
                    alertBox.style.transform = 'translateX(-50%)';
                    alertBox.style.backgroundColor = '#fef2f2'; // red-50
                    alertBox.style.color = '#991b1b'; // red-800
                    alertBox.style.padding = '1rem 1.5rem';
                    alertBox.style.borderRadius = '0.5rem';
                    alertBox.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                    alertBox.style.zIndex = '200';
                    alertBox.style.opacity = '0';
                    alertBox.style.transition = 'opacity 0.3s ease-in-out';
                    alertBox.textContent = 'Por favor, selecciona al menos un servicio para continuar.';
                    document.body.appendChild(alertBox);

                    // Fade in
                    setTimeout(() => { alertBox.style.opacity = '1'; }, 10);
                    // Fade out and remove
                    setTimeout(() => {
                        alertBox.style.opacity = '0';
                        setTimeout(() => { alertBox.remove(); }, 300);
                    }, 3000);


                    // Opcional: desplazar la vista a la secci√≥n de √°reas
                    document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                    return;
                }

                const modalCoupon = document.getElementById('coupon-code').value.trim();
                const mainCoupon = document.getElementById('main-coupon-code').value.trim();
                const couponCode = mainCoupon || modalCoupon; // Usa el cup√≥n de la vista principal o el del modal
                
                let message = "¬°Hola! üëã Me gustar√≠a reservar una limpieza con Plan-Limpieza10 con la siguiente configuraci√≥n:\n\n";
                
                message += `*CUOTA DE ACTIVACI√ìN:* ${formatCurrency(ACTIVATION_FEE)}\n`;
                
                const areas = Object.values(state.selectedItems).filter(i => i.type === 'area');
                if(areas.length > 0) {
                    message += "\n*√ÅREAS SELECCIONADAS:*\n";
                    areas.forEach(item => {
                        const quantityText = item.quantity > 0 ? ` (x${item.quantity})` : '';
                        message += `- ${item.label}${quantityText}\n`;
                    });
                }

                const addons = Object.values(state.selectedItems).filter(i => i.type === 'addon');
                if(addons.length > 0) {
                    message += "\n*COMPLEMENTOS:*\n";
                    addons.forEach(item => {
                        message += `- ${item.label}\n`;
                    });
                }
                
                message += "\n----------------------------------\n";
                if (couponCode) {
                    message += `*CUP√ìN/C√ìDIGO:* ${couponCode}\n`;
                }
                message += `*COSTE TOTAL:* ${formatCurrency(state.totalCost)}\n`;
                message += `*N¬∫ de Compa√±eros:* ${state.roommatesCount}\n`;
                message += `*COSTE POR PERSONA:* ${formatCurrency(state.costPerPerson, true)}\n\n`;
                message += "Por favor, confirmadme la disponibilidad. ¬°Gracias!";

                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
            };

            /**
             * Inicializa el gr√°fico de Chart.js.
             */
            const initChart = () => {
                const ctx = document.getElementById('costBreakdownChart').getContext('2d');
                costChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Vac√≠o'],
                        datasets: [{
                            label: 'Coste',
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderColor: '#ffffff',
                            borderWidth: 3,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: "'Inter', sans-serif",
                                        size: 14
                                    },
                                    padding: 20,
                                    boxWidth: 15,
                                    usePointStyle: true,
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += formatCurrency(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            };

            // --- INICIALIZACI√ìN Y EVENT LISTENERS ---

            // Configurar contadores
            setupCounter('bano', 'banoCount', 0, 10, 'Ba√±os', 10, 'area');
            setupCounter('habitacion', 'habitacionCount', 0, 10, 'Habitaciones', 10, 'area');
            setupRoommatesCounter();

            // Listeners para checkboxes
            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });
            
            // Listeners para el modal
            const openModalBtn = document.getElementById('floating-cart-button');
            const closeModalBtn = document.getElementById('close-modal-button');
            
            openModalBtn.addEventListener('click', () => modal.classList.add('open'));
            closeModalBtn.addEventListener('click', () => modal.classList.remove('open'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) { // Cierra si se hace clic en el fondo oscuro
                    modal.classList.remove('open');
                }
            });
            
            // Listener para los controles dentro del modal
            summaryList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const action = button.dataset.action;
                const id = button.dataset.id;

                if (action === 'remove') {
                    document.getElementById(id).checked = false;
                    delete state.selectedItems[id];
                    calculateTotal();
                } else if (action === 'increment' || action === 'decrement') {
                    const isIncrement = action === 'increment';
                    const key = id === 'bano' ? 'banoCount' : 'habitacionCount';
                    
                    let newValue = state[key] + (isIncrement ? 1 : -1);
                    newValue = Math.max(0, Math.min(newValue, 10)); // Clamp between 0 and 10

                    state[key] = newValue;

                    if (newValue > 0) {
                        state.selectedItems[id].quantity = newValue;
                    } else {
                        delete state.selectedItems[id];
                    }
                    
                    calculateTotal();
                }
            });

            // Listeners para los botones de reserva
            document.getElementById('book-now-btn').addEventListener('click', generateWhatsAppMessage);
            document.getElementById('modal-book-now-btn').addEventListener('click', generateWhatsAppMessage);

            // Inicializar la aplicaci√≥n
            initChart();
            calculateTotal(); // Calcular y mostrar estado inicial (todo a 0)
        });
    </script>
</body>
</html>





