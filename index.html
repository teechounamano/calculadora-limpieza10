<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calcular presupuesto online y solicitar servicio de limpieza en menos de 2 minutos.">
    <link rel="icon" type="image/png" href="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png">
    <title>Calculadora y Solicitud - TeEchoUnaMano TUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #3ec2f2 0%, #0067b0 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        /* Cambiando gradientes a paleta profesional azul corporativo */
        .button-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 24px rgba(37, 99, 235, 0.4);
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .button-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .button-gradient:hover::before {
            left: 100%;
        }
        
        .button-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(37, 99, 235, 0.5);
        }
        
        .button-gradient:active {
            transform: translateY(-1px);
        }
        
        /* Bot√≥n secundario con gris pizarra profesional */
        .button-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 24px rgba(100, 116, 139, 0.4);
            border: none;
        }
        
        .button-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(100, 116, 139, 0.5);
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 280px;
        }
        
        /* Mejorando interactividad de checkboxes con transiciones suaves */
        .checkbox-label {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            cursor: pointer;
        }
        
        .checkbox-label:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }
        
        input:checked + .checkbox-label {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-color: #667eea;
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .is-selected {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-color: #667eea;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Controles de contador con azul corporativo en hover */
        .count-controls {
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }
        
        .count-btn {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 700;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .count-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.4);
        }
        
        .count-btn:active {
            transform: scale(1.05);
        }
        
        .count-display {
            width: 3.5rem;
            text-align: center;
            font-weight: 800;
            font-size: 1.25rem;
            color: #1e293b;
        }
        
        #floating-elements-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 50;
        }
        
        /* Carrito flotante con azul corporativo */
        #floating-cart-button {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border-radius: 50%;
            width: 4rem;
            height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        #floating-cart-button:hover {
            transform: translateY(-4px) scale(1.08);
            box-shadow: 0 15px 40px rgba(37, 99, 235, 0.6);
        }
        
        /* Badge del carrito con √≠ndigo profesional */
        #floating-total-cost-display {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            color: white;
            border-radius: 50%;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            font-weight: 800;
            display: none;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.5);
        }
        
        #floating-total-cost-display.visible {
            display: block;
            animation: pulse 2s infinite;
        }
        
        /* Modal mejorado con mejor backdrop y animaciones */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            padding: 1rem;
        }
        
        .modal-overlay.open {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            width: 100%;
            max-width: 550px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-overlay.open .modal-content {
            transform: scale(1) translateY(0);
        }
        
        /* Bot√≥n de cierre mejorado con mejor visibilidad */
        .modal-close-btn {
            /* Haciendo el bot√≥n X m√°s sutil y discreto */
            background: transparent;
            color: #94a3b8;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            opacity: 0.5;
            box-shadow: none;
        }
        
        .modal-close-btn:hover {
            /* Efecto hover m√°s prominente y profesional */
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            transform: rotate(90deg) scale(1.15);
            opacity: 1;
            box-shadow: 0 2px 12px rgba(239, 68, 68, 0.2);
        }
        
        .modal-item-controls {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }
        
        /* Botones de modal con azul corporativo */
        .modal-item-btn {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.875rem;
        }
        
        .modal-item-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 3px 10px rgba(37, 99, 235, 0.4);
        }
        
        .modal-remove-btn {
            background: transparent;
            color: #ef4444;
            border: none;
            cursor: pointer;
            font-size: 1.125rem;
            padding: 0;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .modal-remove-btn:hover {
            color: #dc2626;
            background: #fee2e2;
            transform: scale(1.15);
        }
        
        /* Bot√≥n general con gris pizarra profesional */
        .button {
            display: inline-block;
            padding: 0.875rem 1.75rem;
            font-weight: 700;
            font-size: 0.9375rem;
            color: #ffffff;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.4);
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(100, 116, 139, 0.6);
        }
        
        .pulsing-button {
            animation: pulse 2s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Tipograf√≠a mejorada con mejor jerarqu√≠a visual */
        .main-title {
            text-shadow: 2px 4px 12px rgba(0, 0, 0, 0.3);
            font-size: 2.75rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }
        
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            letter-spacing: -0.01em;
            line-height: 1.2;
        }
        
        .card-spacing {
            margin-bottom: 1.25rem;
        }
        
        .button-spacing {
            margin-bottom: 1rem;
        }
        
        /* Contenedores de addons m√°s profesionales */
        .addon-container {
            margin-bottom: 1.25rem;
            border-radius: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .addon-container:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .addon-container h4 {
            color: #1e293b;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .addon-group {
            gap: 1rem;
        }

        /* Header m√°s profesional y responsive */
        header {
            background: white;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
            padding: 1.25rem 0;
            margin-bottom: 2.5rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .logo-img {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(to right, #3ec2f2, #0067b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            line-height: 1.2;
        }

        .logo-text p {
            font-size: 0.9375rem;
            color: #64748b;
            margin: 0;
            font-weight: 500;
        }

        /* Header link con azul corporativo */
        .header-link {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 0.875rem 1.75rem;
            border-radius: 50px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.4);
            font-size: 0.9375rem;
        }

        .header-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.6);
        }

        /* Formulario con dise√±o moderno y profesional */
        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3.25rem;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            font-size: 1rem;
            font-family: inherit;
            color: #0f172a;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: #3ec2f2;
            background: white;
            box-shadow: 0 0 0 4px rgba(62, 194, 242, 0.15);
        }

        .form-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .error-message {
            display: none;
            color: #ef4444;
            font-size: 0.8125rem;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        .error-message.show {
            display: block;
            animation: shake 0.4s ease-in-out;
        }

        .form-label {
            display: block;
            font-size: 0.9375rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.625rem;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        /* Modal de resumen final optimizado para m√≥viles */
        .final-summary-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            padding: 1rem;
        }

        .final-summary-modal.open {
            visibility: visible;
            opacity: 1;
        }

        .final-summary-content {
            background: white;
            border-radius: 24px;
            padding: 1.75rem;
            width: 100%;
            max-width: 600px;
            max-height: 92vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .final-summary-modal.open .final-summary-content {
            transform: scale(1);
        }

        /* T√≠tulo del resumen con azul corporativo */
        .summary-header h2 {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .summary-header p {
            color: #64748b;
            font-size: 0.9375rem;
            margin: 0;
            font-weight: 500;
        }

        .summary-section {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            border: 2px solid #e2e8f0;
        }

        /* Estilos para iconos de edici√≥n en el resumen final */
        .summary-section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.75rem;
            border-radius: 12px;
        }

        .summary-section-title:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom-color: #667eea;
            transform: translateX(4px);
        }

        .summary-section-title .edit-icon {
            margin-left: auto;
            font-size: 1rem;
            color: #94a3b8;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .summary-section-title:hover .edit-icon {
            opacity: 1;
            color: #667eea;
        }

        .edit-icon-text {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Tooltip para los iconos de edici√≥n */
        .edit-tooltip {
            position: absolute;
            top: -2.5rem;
            right: 0;
            background: #1e293b;
            color: white;
            padding: 0.5rem 0.875rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .edit-tooltip::after {
            content: '';
            position: absolute;
            bottom: -4px;
            right: 1rem;
            width: 8px;
            height: 8px;
            background: #1e293b;
            transform: rotate(45deg);
        }

        /* Animaci√≥n sutil para indicar interactividad */
        @keyframes pulse-edit {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .summary-section-title:hover .edit-icon svg {
            animation: pulse-edit 0.6s ease-in-out;
        }

        /* Responsive para m√≥viles - mostrar iconos siempre */
        @media (max-width: 768px) {
            .summary-section-title .edit-icon {
                opacity: 0.7;
                font-size: 0.875rem;
            }

            .summary-section-title:hover .edit-icon {
                opacity: 1;
            }

            .edit-icon-text {
                display: none;
            }
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.625rem 0;
            border-bottom: 1px solid #e2e8f0;
            gap: 1rem;
        }

        .summary-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .summary-item-label {
            font-size: 0.9375rem;
            color: #475569;
            font-weight: 600;
            line-height: 1.5;
            flex: 1;
        }

        .summary-item-value {
            font-size: 0.9375rem;
            color: #1e293b;
            font-weight: 700;
            text-align: right;
            line-height: 1.5;
        }

        /* Destacar cuota de activaci√≥n con gradiente llamativo */
        .activation-fee-highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 3px solid #f59e0b;
            border-radius: 14px;
            padding: 1rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
        }

        .activation-fee-highlight .summary-item {
            border-bottom: none;
            padding: 0;
        }

        .activation-fee-highlight .summary-item-label {
            color: #92400e;
            font-weight: 800;
            font-size: 1.0625rem;
        }

        .activation-fee-highlight .summary-item-value {
            color: #92400e;
            font-weight: 900;
            font-size: 1.25rem;
        }

        /* Restaurando estilos originales de coste por persona en calculadora principal */
        .cost-per-person {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .cost-per-person p:first-child {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .cost-per-person p:last-child {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .summary-total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .summary-total-label {
            font-size: 0.8125rem;
            font-weight: 700;
            opacity: 0.95;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .summary-total-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        /* Estilo profesional y distintivo para coste por persona SOLO en modal final */
        .summary-total-per-person {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 1rem;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            border: 2px solid #818cf8;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .summary-total-per-person::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .summary-total-per-person:hover::before {
            left: 100%;
        }

        .summary-actions {
            display: flex;
            gap: 1rem;
            flex-direction: column;
        }

        .summary-btn {
            width: 100%;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.625rem;
            position: relative;
            overflow: hidden;
        }

        .summary-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .summary-btn:hover::before {
            left: 100%;
        }

        /* Bot√≥n de env√≠o con azul corporativo */
        .summary-btn-send {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 6px 24px rgba(37, 99, 235, 0.4);
        }

        .summary-btn-send:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(37, 99, 235, 0.6);
        }

        /* Bot√≥n de cancelaci√≥n con gris pizarra profesional */
        .summary-btn-cancel {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        }

        .summary-btn-cancel:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
        }

        /* Formulario de cliente con dise√±o premium */
        .form-card {
            background: white;
            border-radius: 24px;
            padding: 2.25rem;
            margin-bottom: 2rem;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .form-card:hover {
            border-color: #3ec2f2;
            box-shadow: 0 10px 35px rgba(62, 194, 242, 0.2);
            transform: translateY(-3px);
        }

        .form-card-header {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            margin-bottom: 1.75rem;
            padding-bottom: 1.25rem;
            border-bottom: 3px solid #f1f5f9;
        }

        .form-card-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.4);
        }

        .form-card-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            margin: 0;
        }

        .form-input-wrapper {
            position: relative;
            margin-bottom: 1.75rem;
        }

        /* Iconos de formulario con gris pizarra profesional */
        .form-input-icon {
            position: absolute;
            left: 1.125rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.375rem;
            color: #64748b;
            pointer-events: none;
            z-index: 1;
        }

        .form-input-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
        }

        .date-selector {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 18px;
            padding: 1.75rem;
            transition: all 0.3s ease;
        }

        .date-selector:hover {
            border-color: #3ec2f2;
            box-shadow: 0 6px 18px rgba(62, 194, 242, 0.15);
        }

        .date-selector-label {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            font-size: 0.9375rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 1rem;
        }

        .date-selector input {
            width: 100%;
            padding: 1rem;
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            color: #0f172a;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .date-selector input:focus {
            outline: none;
            border-color: #3ec2f2;
            box-shadow: 0 0 0 4px rgba(62, 194, 242, 0.15);
        }

        /* Banner de seguridad para tranquilizar al usuario */
        .security-banner {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 3px solid #10b981;
            border-radius: 18px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            margin-bottom: 2rem;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.2);
        }

        .security-banner-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .security-banner-content h4 {
            font-size: 1.25rem;
            font-weight: 800;
            color: #065f46;
            margin: 0 0 0.5rem 0;
        }

        .security-banner-content p {
            font-size: 0.9375rem;
            color: #065f46;
            margin: 0;
            font-weight: 600;
        }

        .info-banner {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 3px solid #3b82f6;
            border-radius: 18px;
            padding: 1.75rem;
            display: flex;
            align-items: start;
            gap: 1.25rem;
            margin-bottom: 2rem;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.2);
        }

        .info-banner-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .info-banner-content h4 {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e40af;
            margin: 0 0 0.625rem 0;
        }

        .info-banner-content p {
            font-size: 1rem;
            color: #1e40af;
            margin: 0;
            font-weight: 600;
        }

        .form-actions {
            display: flex;
            gap: 1.25rem;
            margin-top: 2.5rem;
        }

        .form-btn {
            flex: 1;
            padding: 1.25rem 2rem;
            border: none;
            border-radius: 18px;
            font-weight: 700;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.875rem;
        }

        .form-btn-back {
            background: white;
            color: #475569;
            border: 3px solid #e2e8f0;
        }

        .form-btn-back:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        /* Bot√≥n de env√≠o con azul corporativo */
        .form-btn-submit {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .form-btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.6);
        }
        
        /* Bot√≥n continuar modal con azul corporativo */
        .modal-continue-btn {
            width: 100%;
            padding: 1.125rem;
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            font-size: 1.0625rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.25rem;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .modal-continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.6);
        }

        /* Destacar c√≥digo de referido con gradiente verde esmeralda */
        .referral-code-display {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 3px solid #10b981;
            border-radius: 18px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.75rem;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .referral-code-display .label {
            font-size: 1rem;
            font-weight: 700;
            color: #065f46;
            margin-bottom: 0.5rem;
        }

        .referral-code-display .code {
            font-size: 1.75rem;
            font-weight: 900;
            color: #065f46;
            letter-spacing: 0.08em;
        }

        /* Input de c√≥digo de referido destacado */
        .referral-input-wrapper {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 3px solid #10b981;
            border-radius: 18px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .referral-input-wrapper label {
            display: block;
            font-size: 1rem;
            font-weight: 700;
            color: #065f46;
            margin-bottom: 0.875rem;
            text-align: center;
        }

        .referral-input-wrapper input {
            width: 100%;
            padding: 1rem;
            background: white;
            border: 2px solid #10b981;
            border-radius: 12px;
            font-size: 1.0625rem;
            font-family: inherit;
            color: #065f46;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
        }

        .referral-input-wrapper input:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }

        .referral-input-wrapper input::placeholder {
            color: #6ee7b7;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(1.5rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-0.625rem); }
            75% { transform: translateX(0.625rem); }
        }
        
        /* Mejorando responsive design para m√≥vil - inputs, botones y modales */
        @media (max-width: 768px) {
            header {
                padding: 0.75rem 0;
                margin-bottom: 1.5rem;
            }

            .header-content {
                padding: 0 1rem;
                gap: 0.75rem;
            }

            .logo {
                gap: 0.75rem;
            }

            .logo-img {
                width: 45px;
                height: 45px;
                border-radius: 12px;
            }

            .logo-text h1 {
                font-size: 0.95rem;
                line-height: 1.3;
            }

            .logo-text p {
                font-size: 0.7rem;
            }

            .header-link {
                padding: 0.5rem 0.875rem;
                font-size: 0.75rem;
                white-space: nowrap;
            }

            .main-title {
                font-size: 1.5rem !important;
                margin-bottom: 1rem !important;
            }

            .section-title {
                font-size: 1.25rem !important;
            }

            .text-xl {
                font-size: 1.25rem !important;
            }

            .summary-section-title .edit-icon {
                opacity: 0.7;
                font-size: 0.875rem;
            }

            .summary-section-title:hover .edit-icon {
                opacity: 1;
            }

            .edit-icon-text {
                display: none;
            }

            /* Ajustar modales para m√≥vil - m√°s compactos */
            .modal-content {
                max-width: 95%;
                max-height: 90vh;
                padding: 1.25rem;
                margin: 1rem;
                border-radius: 20px;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .modal-body {
                padding: 1rem;
                font-size: 0.875rem;
            }

            /* Ajustar formularios en m√≥vil */
            .form-card {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                border-radius: 18px;
            }

            .form-card-header {
                gap: 0.875rem;
                margin-bottom: 1.25rem;
                padding-bottom: 1rem;
            }

            .form-card-icon {
                width: 2.75rem;
                height: 2.75rem;
                font-size: 1.5rem;
                border-radius: 14px;
            }

            .form-card-title {
                font-size: 1.25rem;
            }

            /* Ajustar inputs con iconos para evitar sobreposici√≥n */
            .form-input {
                padding: 0.875rem 0.875rem 0.875rem 2.75rem;
                font-size: 0.875rem;
                border-radius: 12px;
            }

            .form-input-icon {
                left: 0.875rem;
                font-size: 1.125rem;
            }

            .form-input-wrapper {
                margin-bottom: 1.25rem;
            }

            /* Cambiar grid de 3 columnas a 1 columna en m√≥vil */
            .form-input-group {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Ajustar botones del formulario - vertical y m√°s compactos */
            .form-actions {
                flex-direction: column;
                gap: 0.875rem;
                margin-top: 1.75rem;
            }

            .form-btn {
                width: 100%;
                padding: 0.875rem 1.25rem;
                font-size: 0.9375rem;
                border-radius: 14px;
                gap: 0.625rem;
            }

            /* Ajustar banners informativos */
            .security-banner,
            .info-banner {
                padding: 1rem;
                gap: 0.875rem;
                border-radius: 14px;
                margin-bottom: 1.5rem;
            }

            .security-banner-icon,
            .info-banner-icon {
                font-size: 1.75rem;
            }

            .security-banner-content h4,
            .info-banner-content h4 {
                font-size: 1rem;
                margin-bottom: 0.375rem;
            }

            .security-banner-content p,
            .info-banner-content p {
                font-size: 0.8125rem;
            }

            /* Ajustar selectores de fecha */
            .date-selector {
                padding: 1.25rem;
                border-radius: 14px;
            }

            .date-selector-label {
                font-size: 0.875rem;
                margin-bottom: 0.625rem;
            }

            .date-selector input[type="date"] {
                font-size: 0.875rem;
                padding: 0.75rem;
            }

            /* Ajustes responsive para coste por persona en calculadora */
            .cost-per-person p:first-child {
                font-size: 0.625rem;
            }

            .cost-per-person p:last-child {
                font-size: 1.75rem;
            }

            /* Ajustes responsive para coste por persona en modal final */
            .summary-total-per-person {
                font-size: 1rem;
                padding: 0.875rem 1.25rem;
            }
        }

        @media (max-width: 480px) {
            /* Optimizaci√≥n adicional para pantallas muy peque√±as */
            header {
                padding: 0.625rem 0;
            }

            .header-content {
                padding: 0 0.75rem;
            }

            .logo-img {
                width: 40px;
                height: 40px;
            }

            .logo-text h1 {
                font-size: 0.875rem;
            }

            .logo-text p {
                font-size: 0.65rem;
            }

            .header-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.7rem;
            }

            .main-title {
                font-size: 1.375rem !important;
                padding: 0 0.5rem;
            }
            
            .section-title {
                font-size: 1.125rem !important;
            }
            
            .checkbox-label {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
            
            .count-btn {
                width: 2.25rem;
                height: 2.25rem;
                font-size: 0.875rem;
            }
            
            .count-display {
                width: 2.5rem;
                font-size: 1rem;
            }
            
            .addon-container {
                padding: 0.875rem;
            }
            
            /* Modal a√∫n m√°s compacto en pantallas peque√±as */
            .modal-content {
                padding: 1rem;
                max-width: 98%;
                margin: 0.5rem;
                border-radius: 16px;
            }

            .modal-header h2 {
                font-size: 1.125rem;
            }

            .modal-body {
                padding: 0.875rem;
                font-size: 0.8125rem;
            }

            /* Formularios m√°s compactos */
            .form-card {
                padding: 1.25rem;
                border-radius: 16px;
            }

            .form-card-header {
                gap: 0.75rem;
                margin-bottom: 1rem;
            }

            .form-card-icon {
                width: 2.5rem;
                height: 2.5rem;
                font-size: 1.25rem;
                border-radius: 12px;
            }

            .form-card-title {
                font-size: 1.125rem;
            }

            /* Inputs m√°s peque√±os y mejor espaciados */
            .form-input {
                padding: 0.75rem 0.75rem 0.75rem 2.5rem;
                font-size: 0.8125rem;
                border-radius: 10px;
            }

            .form-input-icon {
                left: 0.75rem;
                font-size: 1rem;
            }

            .form-input-wrapper {
                margin-bottom: 1rem;
            }

            /* Botones m√°s compactos */
            .form-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                border-radius: 12px;
            }

            .form-actions {
                gap: 0.75rem;
                margin-top: 1.5rem;
            }

            /* Banners m√°s compactos */
            .security-banner,
            .info-banner {
                padding: 0.875rem;
                gap: 0.75rem;
                border-radius: 12px;
            }

            .security-banner-icon,
            .info-banner-icon {
                font-size: 1.5rem;
            }

            .security-banner-content h4,
            .info-banner-content h4 {
                font-size: 0.9375rem;
            }

            .security-banner-content p,
            .info-banner-content p {
                font-size: 0.75rem;
            }

            /* Selectores de fecha m√°s compactos */
            .date-selector {
                padding: 1rem;
                border-radius: 12px;
            }

            .date-selector-label {
                font-size: 0.8125rem;
                margin-bottom: 0.5rem;
            }

            .date-selector input[type="date"] {
                font-size: 0.8125rem;
                padding: 0.625rem;
            }

            #floating-elements-container {
                bottom: 1rem;
                right: 1rem;
            }

            /* Ajustar botones generales */
            .button-gradient,
            .summary-btn,
            .modal-continue-btn {
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
            }

            /* Ajustar resumen final */
            .final-summary-content {
                padding: 1rem;
            }

            .summary-header h2 {
                font-size: 1.25rem;
            }

            .summary-total-value {
                font-size: 1.75rem;
            }

            /* Ajustes responsive adicionales para coste por persona */
            .cost-per-person p:last-child {
                font-size: 1.5rem;
            }

            .summary-total-per-person {
                font-size: 0.9rem;
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png" alt="TeEchoUnaMano Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>TeEchoUnaMano TUM</h1>
                        <p>Servicios de Limpieza Profesional</p>
                    </div>
                </div>
                <a href="https://te-echounamano.blogspot.com" target="_blank" rel="noopener noreferrer" class="header-link">
                    M√°s informaci√≥n
                </a>
            </div>
        </div>
    </header>

    <!-- Secci√≥n de la calculadora -->
    <main class="container mx-auto px-4 py-6 md:py-12" id="calculator-section">
        <div class="text-center mb-12 md:mb-16">
            <div class="relative max-w-7xl mx-auto flex flex-col items-center">
                <div class="flex space-x-4 md:space-x-6 mb-6 md:mb-8 md:absolute md:top-0 md:right-0">
                    <a href="https://te-echounamano.blogspot.com/" target="_blank" title="TUM TeEchoUnaMano Web" class="text-xl md:text-3xl text-white hover:text-cyan-200 transition-all duration-300 hover:scale-110">
                        üè†
                    </a>
                    <a href="https://apm-tum.blogspot.com/" target="_blank" title="Soporte A-TUM" class="text-xl md:text-3xl text-white hover:text-cyan-200 transition-all duration-300 hover:scale-110">
                        üéß
                    </a>
                    <a href="https://t.me/TumAgenda_bot" target="_blank" title="Bot de Telegram" class="text-xl md:text-3xl text-white hover:text-cyan-200 transition-all duration-300 hover:scale-110">
                        ü§ñ
                    </a>
                </div>
                <h1 class="main-title text-white mb-4 md:mb-6">üßπ Calculadora-Limpieza10</h1>
                <p class="text-base md:text-2xl text-white max-w-4xl mx-auto leading-relaxed px-4 font-medium">La limpieza de tu <b>piso de estudiante</b>, solucionada. Es la forma m√°s f√°cil y econ√≥mica de mantener vuestro piso limpio. Personaliza tu plan, comparte los gastos y olv√≠date de discutir por turnos.</p>
            </div>
        </div>

        <section id="how-it-works" class="mb-16 md:mb-20">
            <div class="max-w-5xl mx-auto">
                <h2 class="section-title text-center mb-12 md:mb-16 text-white">¬øC√≥mo Funciona? Sencillo y Transparente</h2>
                <div class="flex flex-col md:flex-row items-stretch justify-center text-center gap-6 md:gap-8">
                    <!-- Iconos con azul corporativo profesional -->
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-blue-600 to-blue-800 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">1</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Una √∫nica cuota de <b>10‚Ç¨</b> te da acceso a un servicio de limpieza completo y a medida. Es tu pase directo a un espacio limpio.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-indigo-600 to-indigo-800 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">2</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Elige las √°reas de tu piso que necesitan un repaso por solo <b>10‚Ç¨</b> cada una y a√±ade los complementos que quieras.</p>
                    </div>
                    <div class="flex justify-center items-center"><div class="h-0.5 w-12 md:w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <div class="flex-1 p-5 md:p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-emerald-600 to-emerald-800 text-white rounded-full w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold mb-4 md:mb-6 shadow-xl">‚úì</div>
                        <p class="text-gray-700 text-sm md:text-lg leading-relaxed font-medium">Disfruta de tu casa impecable y divide el coste total entre tus compa√±eros de piso. Sin estr√©s, sin peleas.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="simulator" class="glass-effect rounded-3xl shadow-2xl p-5 md:p-12 mb-16 md:mb-20">
            <h2 class="text-2xl md:text-4xl font-bold text-center mb-3 md:mb-4 text-gray-800">Dise√±a tu Limpieza a Medida</h2>
            <p class="text-center text-gray-600 text-sm md:text-lg mb-3 md:mb-4 font-medium">Construye tu paquete de limpieza y mira el coste en tiempo real.</p>
            <p class="text-center text-gray-600 italic max-w-3xl mx-auto mb-8 md:mb-12 text-xs md:text-base font-medium">Este servicio est√° dise√±ado para una <b>limpieza r√°pida y eficiente</b>. Si necesitas un servicio m√°s profundo, limpieza de ventanas u otras tareas, ofrecemos planes por hora y presupuestos personalizados. ¬°Solo tienes que consultarnos!</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-16">
                <div>
                    <h3 id="areas-section" class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">1. Elige las √°reas a limpiar (10‚Ç¨ c/u)</h3>
                    <div class="space-y-3 md:space-y-4 card-spacing">
                        <input type="checkbox" id="salon" class="hidden peer" data-price="10" data-label="Sal√≥n / Comedor" data-type="area">
                        <label for="salon" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">üõãÔ∏è</span>
                                <span class="font-semibold text-sm md:text-lg">Sal√≥n / Comedor</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                        </label>
                        
                        <input type="checkbox" id="cocina" class="hidden peer" data-price="10" data-label="Cocina" data-type="area">
                        <label for="cocina" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">üç≥</span>
                                <span class="font-semibold text-sm md:text-lg">Cocina</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                        </label>
                        
                        <div id="bano-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">üöø</span>
                                <span class="font-semibold text-sm md:text-lg">Ba√±os</span>
                            </div>
                            <div class="count-controls">
                                <button id="bano-decrement" class="count-btn">-</button>
                                <span id="bano-display" class="count-display">0</span>
                                <button id="bano-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <div id="habitacion-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">üõèÔ∏è</span>
                                <span class="font-semibold text-sm md:text-lg">Habitaciones</span>
                            </div>
                            <div class="count-controls">
                                <button id="habitacion-decrement" class="count-btn">-</button>
                                <span id="habitacion-display" class="count-display">0</span>
                                <button id="habitacion-increment" class="count-btn">+</button>
                            </div>
                        </div>

                        <input type="checkbox" id="lavanderia" class="hidden peer" data-price="10" data-label="Lavander√≠a" data-type="area">
                        <label for="lavanderia" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">üß∫</span>
                                <span class="font-semibold text-sm md:text-lg">Lavander√≠a</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                        </label>

                        <input type="checkbox" id="terrazas" class="hidden peer" data-price="10" data-label="Limpieza de Terrazas" data-type="area">
                        <label for="terrazas" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">‚òÄÔ∏è</span>
                                <span class="font-semibold text-sm md:text-lg">Limpieza de Terrazas</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                        </label>
                    </div>

                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 mt-8 md:mt-10 text-gray-800">2. A√±ade complementos</h3>
                    <div class="space-y-4 md:space-y-6">
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">üö™</span>
                                <span class="text-sm md:text-lg">Pasillo (√°rea com√∫n)</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="pasillo">
                                <input type="checkbox" id="pasillo-5" class="hidden peer" data-price="5" data-label="Pasillo: menos de 5m¬≤" data-type="addon">
                                <label for="pasillo-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">Menos de 5m¬≤</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="pasillo-10" class="hidden peer" data-price="10" data-label="Pasillo: 5m¬≤ o m√°s" data-type="addon">
                                <label for="pasillo-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">5m¬≤ o m√°s</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">üçΩÔ∏è</span>
                                <span class="text-sm md:text-lg">Fregar Platos</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="platos">
                                <input type="checkbox" id="platos-5" class="hidden peer" data-price="5" data-label="Fregar Platos: 1 carga" data-type="addon">
                                <label for="platos-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1 Carga</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="platos-10" class="hidden peer" data-price="10" data-label="Fregar Platos: M√°s de 1 carga" data-type="addon">
                                <label for="platos-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">M√°s de 1 Carga</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">ü™ü</span>
                                <span class="text-sm md:text-lg">Limpieza de Mamparas</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="mamparas">
                                <input type="checkbox" id="mamparas-5" class="hidden peer" data-price="5" data-label="Mamparas: 1-2m" data-type="addon">
                                <label for="mamparas-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1-2m</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="mamparas-10" class="hidden peer" data-price="10" data-label="Mamparas: M√°s de 2m" data-type="addon">
                                <label for="mamparas-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">M√°s de 2m</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <div class="addon-container p-5 md:p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-3 md:mb-4">
                                <span class="text-2xl md:text-3xl mr-2 md:mr-3">üóëÔ∏è</span>
                                <span class="text-sm md:text-lg">Recogida de Basura</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-3 md:space-y-0 addon-group" data-group-name="basura">
                                <input type="checkbox" id="basura-5" class="hidden peer" data-price="5" data-label="Recogida de Basura: 1-2 bolsas" data-type="addon">
                                <label for="basura-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">1-2 bolsas</span>
                                    <span class="text-xs md:text-sm text-gray-500 mb-1 font-medium">(Obligatorio con √°reas)</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">5‚Ç¨</span>
                                </label>
                                <input type="checkbox" id="basura-10" class="hidden peer" data-price="10" data-label="Recogida de Basura: M√°s de 2 bolsas" data-type="addon">
                                <label for="basura-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-sm md:text-lg">M√°s de 2 bolsas</span>
                                    <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                                </label>
                            </div>
                        </div>
                        <input type="checkbox" id="escalera" class="hidden peer" data-price="10" data-label="Limpieza de Escalera" data-type="addon">
                        <label for="escalera" class="checkbox-label cursor-pointer flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl md:text-3xl mr-3 md:mr-4">ü™ú</span>
                                <span class="font-semibold text-sm md:text-lg">Limpieza de Escalera</span>
                            </div>
                            <span class="text-gray-600 font-bold text-sm md:text-lg">10‚Ç¨</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-gray-800">3. ¬øCu√°ntos sois en el piso?</h3>
                    <p class="text-gray-600 text-sm md:text-base mb-4 md:mb-6 font-medium">Si pagas el servicio para ti, selecciona 1 persona. Si sois m√°s, selecciona el n√∫mero de compa√±eros para dividir los gastos.</p>
                    <div id="roommates-container" class="flex items-center justify-between p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300 mb-6 md:mb-8">
                        <div class="flex items-center">
                            <span class="text-2xl md:text-3xl mr-3 md:mr-4">üë•</span>
                            <span class="font-semibold text-sm md:text-lg">Compa√±eros</span>
                        </div>
                        <div class="count-controls">
                            <button id="roommates-decrement" class="count-btn">-</button>
                            <span id="roommates-count" class="count-display">1</span>
                            <button id="roommates-increment" class="count-btn">+</button>
                        </div>
                    </div>

                    <div class="sticky top-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                            <div class="p-5 md:p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl text-center border-2 border-blue-200">
                                <p class="text-gray-600 text-xs md:text-sm font-bold mb-2 uppercase tracking-wide">COSTE TOTAL</p>
                                <p id="total-cost" class="text-3xl md:text-4xl font-extrabold text-blue-600">0 ‚Ç¨</p>
                            </div>
                            <!-- Restaurando coste por persona original sin icono de edici√≥n -->
                            <div class="cost-per-person">
                                <p>POR PERSONA</p>
                                <p id="cost-per-person">0,00 ‚Ç¨</p>
                            </div>
                        </div>

                        <h3 class="text-lg md:text-2xl font-bold mb-4 md:mb-6 text-center text-gray-800">Desglose del Coste</h3>
                        <div class="chart-container">
                            <canvas id="costBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center mt-12 md:mt-16 mb-16 md:mb-20">
            <h3 class="text-2xl md:text-4xl font-bold mb-4 md:mb-6 text-white">¬øTodo claro?</h3>
            <p class="text-white mb-8 md:mb-10 max-w-2xl mx-auto text-sm md:text-lg leading-relaxed px-4 font-medium">Ahora completa tus datos para solicitar tu primera limpieza y descubre lo f√°cil que es tener un piso impecable.</p>
            
            <!-- Campo de c√≥digo de referido destacado con estilo premium -->
            <div class="max-w-md mx-auto mb-6 md:mb-8 px-4">
                <div class="referral-input-wrapper">
                    <label for="main-coupon-code">üéüÔ∏è ¬øTienes un c√≥digo de referido?</label>
                    <div class="button-spacing">
                        <a class="button" href="https://teechounamano.github.io/activar-referido/" target="_blank" rel="noopener noreferrer" title="Activar Cup√≥n">Quiero mi c√≥digo</a>
                    </div>
                    <input type="text" id="main-coupon-code" placeholder="ESCRIBE TU C√ìDIGO AQU√ç">
                </div>
            </div>

            <button id="proceed-to-form-btn" class="button-gradient text-white font-bold py-5 md:py-6 px-10 md:px-14 rounded-full transition-all duration-300 text-lg md:text-xl shadow-2xl pulsing-button">Rellenar Datos del Cliente para la Solicitud</button>
        </footer>
    </main>

    <!-- Secci√≥n del formulario con banner de seguridad -->
    <section class="form-section container mx-auto px-4 py-6 md:py-12" id="client-form-section">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8 md:mb-12">
                <div class="inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-white rounded-3xl shadow-2xl mb-6 text-4xl md:text-5xl">
                    üìã
                </div>
                <h2 class="text-3xl md:text-5xl font-bold text-white mb-3 md:mb-4">Datos del Solicitante</h2>
                <p class="text-white text-base md:text-xl max-w-2xl mx-auto font-medium">Completa tu informaci√≥n para procesar la solicitud de limpieza</p>
            </div>

            <!-- Banner de seguridad para tranquilizar al usuario -->
            <div class="security-banner">
                <div class="security-banner-icon">üîí</div>
                <div class="security-banner-content">
                    <h4>Tus datos est√°n seguros</h4>
                    <p>Toda tu informaci√≥n est√° protegida y solo se usa para coordinar tu servicio de limpieza.</p>
                </div>
            </div>

            <form id="client-form">
                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">üë§</div>
                        <h3 class="form-card-title">Informaci√≥n Personal</h3>
                    </div>
                    
                    <div class="form-input-wrapper">
                        <div class="form-input-icon">‚úçÔ∏è</div>
                        <input type="text" id="nombre" class="form-input" placeholder="Tu nombre completo" required>
                        <div class="error-message" id="errorNombre">Por favor, ingresa tu nombre completo</div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">üè†</div>
                        <h3 class="form-card-title">Direcci√≥n del Servicio</h3>
                    </div>
                    
                    <div class="form-input-wrapper">
                        <div class="form-input-icon">üìç</div>
                        <input type="text" id="calle" class="form-input" placeholder="Calle y n√∫mero (Ej: Calle Mayor, 123)" required>
                        <div class="error-message" id="errorCalle">Por favor, ingresa la calle y n√∫mero</div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-input-wrapper">
                            <div class="form-input-icon">üö™</div>
                            <input type="text" id="portal" class="form-input" placeholder="Portal" required>
                            <div class="error-message" id="errorPortal">Requerido</div>
                        </div>

                        <div class="form-input-wrapper">
                            <div class="form-input-icon">üî¢</div>
                            <input type="text" id="piso" class="form-input" placeholder="Piso" required>
                            <div class="error-message" id="errorPiso">Requerido</div>
                        </div>

                        <div class="form-input-wrapper">
                            <div class="form-input-icon">üö™</div>
                            <input type="text" id="puerta" class="form-input" placeholder="Puerta" required>
                            <div class="error-message" id="errorPuerta">Requerido</div>
                        </div>
                    </div>

                    <div class="info-banner">
                        <div class="info-banner-icon">‚ÑπÔ∏è</div>
                        <div class="info-banner-content">
                            <h4>Valencia capital</h4>
                            <p>La visita es <strong>gratuita y sin compromiso</strong>. Nos desplazamos a tu domicilio para evaluar el servicio.</p>
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-card-header">
                        <div class="form-card-icon">üìÖ</div>
                        <h3 class="form-card-title">Fechas Disponibles</h3>
                    </div>
                    
                    <p class="text-gray-600 text-sm md:text-base mb-4 md:mb-6 font-medium">Selecciona dos opciones de fecha para coordinar la visita. Nos pondremos en contacto contigo para confirmar.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="date-selector">
                            <div class="date-selector-label">
                                <span>üìÜ</span>
                                <span>Primera opci√≥n</span>
                            </div>
                            <input type="date" id="fecha1" required>
                            <div class="error-message" id="errorFecha1">Selecciona la primera fecha</div>
                        </div>

                        <div class="date-selector">
                            <div class="date-selector-label">
                                <span>üìÜ</span>
                                <span>Segunda opci√≥n</span>
                            </div>
                            <input type="date" id="fecha2" required>
                            <div class="error-message" id="errorFecha2">Selecciona la segunda fecha</div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="back-to-calculator-btn" class="form-btn form-btn-back">
                        <span>‚Üê</span>
                        <span>Volver a la Calculadora</span>
                    </button>
                    <button type="submit" class="form-btn form-btn-submit">
                        <span>Ver Resumen Completo</span>
                        <span>‚Üí</span>
                    </button>
                </div>
            </form>
        </div>
    </section>

    <div id="floating-elements-container">
        <button id="floating-cart-button" aria-label="Mostrar resumen de costes">
            <span style="font-size: 1.5rem;">üõí</span>
            <span id="floating-total-cost-display">0 ‚Ç¨</span>
        </button>
    </div>

    <!-- Modal de resumen simplificado - solo bot√≥n X para cerrar -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center pb-5 md:pb-6 border-b-2 border-gray-200 mb-5 md:mb-6">
                <h3 class="text-xl md:text-3xl font-bold text-gray-800">Resumen de mi pedido</h3>
                <button id="close-modal-button" class="modal-close-btn" aria-label="Cerrar">
                    ‚úï
                </button>
            </div>
            
            <div>
                <div id="summary-list" class="space-y-3 md:space-y-4 max-h-60 md:max-h-80 overflow-y-auto pr-2">
                    <p class="text-gray-500 text-center py-6 md:py-8 text-sm md:text-lg font-medium">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>
                </div>
            </div>

            <div id="modal-roommates-container" class="mt-5 md:mt-6 p-4 md:p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <span class="text-2xl md:text-3xl mr-2 md:mr-3">üë•</span>
                        <span class="font-semibold text-sm md:text-lg">Compa√±eros</span>
                    </div>
                    <div class="count-controls">
                        <button id="modal-roommates-decrement" class="count-btn">-</button>
                        <span id="modal-roommates-count" class="count-display">1</span>
                        <button id="modal-roommates-increment" class="count-btn">+</button>
                    </div>
                </div>
                <div class="text-center font-bold text-lg md:text-xl text-blue-600">
                    <span id="modal-cost-per-person">0,00 ‚Ç¨</span> por persona
                </div>
            </div>

            <!-- Campo de c√≥digo de referido destacado en el modal -->
            <div class="mt-5 md:mt-6">
                <div class="referral-input-wrapper">
                    <label for="coupon-code">üéüÔ∏è ¬øTienes un c√≥digo de referido?</label>
                    <input type="text" id="coupon-code" placeholder="ESCRIBE TU C√ìDIGO AQU√ç">
                </div>
            </div>

            <div class="mt-5 md:mt-6 flex justify-between items-center font-bold text-lg md:text-xl">
                <span class="text-gray-800">Total:</span>
                <span id="summary-total" class="text-blue-600 text-2xl md:text-3xl">0,00 ‚Ç¨</span>
            </div>

            <button id="modal-proceed-to-form-btn" class="modal-continue-btn">
                Continuar con los Datos del Cliente ‚Üí
            </button>
        </div>
    </div>

    <!-- Modal de resumen final con cuota de activaci√≥n y c√≥digo de referido destacados -->
    <div id="final-summary-modal" class="final-summary-modal">
        <div class="final-summary-content">
            <!-- A√±adiendo bot√≥n X sutil para cerrar el modal de resumen final -->
            <div class="flex justify-between items-start mb-4">
                <div class="summary-header" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none; text-align: left; flex: 1;">
                    <h2>‚ú® Resumen de tu Solicitud</h2>
                    <p>Revisa todos los detalles antes de enviar</p>
                </div>
                <button onclick="document.getElementById('final-summary-modal').classList.remove('open')" class="modal-close-btn" aria-label="Cerrar" style="flex-shrink: 0; margin-left: 1rem;">
                    ‚úï
                </button>
            </div>

            <!-- Banner de seguridad en el resumen final -->
            <div class="security-banner" style="margin-bottom: 1.5rem;">
                <div class="security-banner-icon">üîí</div>
                <div class="security-banner-content">
                    <h4>Informaci√≥n protegida</h4>
                    <p>Tus datos est√°n seguros con nosotros</p>
                </div>
            </div>

            <!-- C√≥digo de referido destacado con gradiente verde esmeralda -->
            <div id="referral-code-section" class="referral-code-display" style="display: none;">
                <div class="label">üéüÔ∏è C√≥digo de Referido</div>
                <div class="code" id="final-referral-code">-</div>
            </div>

            <!-- Secci√≥n de servicios con icono de edici√≥n interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('services')" role="button" tabindex="0">
                    <span>üßπ</span>
                    <span>Servicios Seleccionados</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar servicios</div>
                </div>
                <div id="final-services-list"></div>
            </div>

            <!-- Cuota de activaci√≥n destacada con gradiente dorado -->
            <div class="activation-fee-highlight">
                <div class="summary-item">
                    <span class="summary-item-label">üí≥ Cuota de Activaci√≥n</span>
                    <span class="summary-item-value" id="final-activation-fee">10 ‚Ç¨</span>
                </div>
            </div>

            <!-- Secci√≥n de datos del cliente con icono de edici√≥n interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('client-data')" role="button" tabindex="0">
                    <span>üë§</span>
                    <span>Datos del Cliente</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar datos</div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Nombre</span>
                    <span class="summary-item-value" id="final-nombre">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Direcci√≥n</span>
                    <span class="summary-item-value" id="final-direccion">-</span>
                </div>
            </div>

            <!-- Secci√≥n de fechas con icono de edici√≥n interactivo -->
            <div class="summary-section">
                <div class="summary-section-title" onclick="editSection('dates')" role="button" tabindex="0">
                    <span>üìÖ</span>
                    <span>Fechas Disponibles</span>
                    <div class="edit-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span class="edit-icon-text">Editar</span>
                    </div>
                    <div class="edit-tooltip">Click para editar fechas</div>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Primera opci√≥n</span>
                    <span class="summary-item-value" id="final-fecha1">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-item-label">Segunda opci√≥n</span>
                    <span class="summary-item-value" id="final-fecha2">-</span>
                </div>
            </div>

            <div class="summary-total">
                <div class="summary-total-label">Coste Total del Servicio</div>
                <div class="summary-total-value" id="final-total-cost">0 ‚Ç¨</div>
                <!-- Coste por persona destacado profesionalmente SOLO en modal final -->
                <div class="summary-total-per-person">
                    üí∞ <span id="final-cost-per-person">0,00 ‚Ç¨</span> por persona (<span id="final-roommates-count">1</span> compa√±ero<span id="final-roommates-plural">s</span>)
                </div>
            </div>

            <div class="summary-actions">
                <button type="button" id="cancel-final-summary-btn" class="summary-btn summary-btn-cancel">
                    <span>‚úï</span>
                    <span>Cancelar</span>
                </button>
                <button type="button" id="send-whatsapp-btn" class="summary-btn summary-btn-send">
                    <span>üì±</span>
                    <span>Enviar Solicitud por WhatsApp</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const ACTIVATION_FEE = 10;
        const WHATSAPP_NUMBER = '34602846694';

        const state = {
            banoCount: 0,
            habitacionCount: 0,
            roommatesCount: 1,
            selectedItems: {},
            totalCost: 0,
            costPerPerson: 0,
            currentSection: 'calculator',
            referralCode: ''
        };

        const totalCostDisplay = document.getElementById('total-cost');
        const costPerPersonDisplay = document.getElementById('cost-per-person');
        const floatingCostDisplay = document.getElementById('floating-total-cost-display');
        const summaryList = document.getElementById('summary-list');
        const summaryTotal = document.getElementById('summary-total');
        const modalCostPerPerson = document.getElementById('modal-cost-per-person');
        const modal = document.getElementById('summary-modal');
        const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
        const addonGroups = document.querySelectorAll('.addon-group');
        let costChart;

        const formatCurrency = (value, useDecimals = false) => {
            const options = useDecimals ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : { minimumFractionDigits: 0, maximumFractionDigits: 0 };
            return value.toLocaleString('es-ES', options) + ' ‚Ç¨';
        };

        const formatDate = (dateString) => {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        const updateUI = () => {
            totalCostDisplay.textContent = formatCurrency(state.totalCost);
            costPerPersonDisplay.textContent = formatCurrency(state.costPerPerson, true);
            summaryTotal.textContent = formatCurrency(state.totalCost, true);
            modalCostPerPerson.textContent = formatCurrency(state.costPerPerson, true);

            if (state.totalCost > 0) {
                floatingCostDisplay.textContent = formatCurrency(state.totalCost);
                floatingCostDisplay.classList.add('visible');
            } else {
                floatingCostDisplay.classList.remove('visible');
            }

            document.getElementById('bano-display').textContent = state.banoCount;
            document.getElementById('habitacion-display').textContent = state.habitacionCount;
            document.getElementById('roommates-count').textContent = state.roommatesCount;
            document.getElementById('modal-roommates-count').textContent = state.roommatesCount;

            document.getElementById('bano-container').classList.toggle('is-selected', state.banoCount > 0);
            document.getElementById('habitacion-container').classList.toggle('is-selected', state.habitacionCount > 0);
            
            updateSummaryList();
            updateChart();
        };
        
        const updateSummaryList = () => {
            summaryList.innerHTML = '';

            if (state.totalCost === 0) {
                summaryList.innerHTML = '<p class="text-gray-500 text-center py-6 md:py-8 text-sm md:text-lg font-medium">A√∫n no has a√±adido nada. ¬°Empieza a configurar tu limpieza!</p>';
                return;
            }

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area').sort((a,b) => a.label.localeCompare(b.label));
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon').sort((a,b) => a.label.localeCompare(b.label));

            const createItemNode = (item) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center py-3 md:py-3 px-4 md:px-4 bg-gray-50 rounded-lg';
                
                let controls = '';
                if (item.id === 'bano' || item.id === 'habitacion') {
                    controls = `
                        <div class="modal-item-controls">
                            <button class="modal-item-btn" data-action="decrement" data-id="${item.id}">-</button>
                            <span class="font-bold w-7 md:w-8 text-center text-sm md:text-base">${item.quantity}</span>
                            <button class="modal-item-btn" data-action="increment" data-id="${item.id}">+</button>
                        </div>
                    `;
                } else {
                    controls = `<button class="modal-remove-btn" data-action="remove" data-id="${item.id}">üóëÔ∏è</button>`;
                }
                
                const totalItemPrice = item.price * (item.quantity || 1);

                itemElement.innerHTML = `
                    <div class="flex-grow pr-3 md:pr-4">
                        <p class="font-semibold text-sm md:text-lg">${item.label}</p>
                        ${item.quantity > 1 ? `<p class="text-xs md:text-sm text-gray-500 font-medium">${item.quantity} x ${formatCurrency(item.price)}</p>` : ''}
                    </div>
                    <div class="flex items-center gap-3 md:gap-4">
                        <span class="font-bold text-gray-700 w-16 md:w-20 text-right text-sm md:text-lg">${formatCurrency(totalItemPrice)}</span>
                        ${controls}
                    </div>
                `;
                return itemElement;
            };

            if (areas.length > 0) {
                const container = document.createElement('div');
                container.className = 'p-4 md:p-4 border-2 border-gray-200 rounded-xl mb-4 md:mb-4';
                const title = document.createElement('h4');
                title.className = 'font-bold text-sm md:text-lg text-gray-700 mb-3 md:mb-3 pb-2 md:pb-2 border-b-2';
                title.textContent = '√Åreas';
                container.appendChild(title);
                areas.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            if (addons.length > 0) {
                const container = document.createElement('div');
                container.className = 'p-4 md:p-4 border-2 border-gray-200 rounded-xl mb-4 md:mb-4';
                const title = document.createElement('h4');
                title.className = 'font-bold text-sm md:text-lg text-gray-700 mb-3 md:mb-3 pb-2 md:pb-2 border-b-2';
                title.textContent = 'Complementos';
                container.appendChild(title);
                addons.forEach(item => container.appendChild(createItemNode(item)));
                summaryList.appendChild(container);
            }

            const feeContainer = document.createElement('div');
            feeContainer.className = 'p-4 md:p-4 border-2 border-amber-300 bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl';
            feeContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <p class="font-bold text-sm md:text-lg text-amber-900">üí≥ Cuota de activaci√≥n</p>
                    <span class="font-extrabold text-amber-900 text-base md:text-xl">${formatCurrency(ACTIVATION_FEE)}</span>
                </div>
            `;
            summaryList.appendChild(feeContainer);
        };

        const updateChart = () => {
            if (!costChart) return;
            
            const hasItems = Object.keys(state.selectedItems).length > 0 || state.totalCost > 0;
            const labels = [];
            const data = [];
            const colors = [];

            if (hasItems) {
                labels.push('Cuota Fija');
                data.push(ACTIVATION_FEE);
                colors.push('#f59e0b');
            }

            const areasCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'area')
                .reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

            if (areasCost > 0) {
                labels.push('√Åreas');
                data.push(areasCost);
                colors.push('#667eea');
            }

            const addonsCost = Object.values(state.selectedItems)
                .filter(item => item.type === 'addon')
                .reduce((sum, item) => sum + item.price, 0);

            if (addonsCost > 0) {
                labels.push('Complementos');
                data.push(addonsCost);
                colors.push('#764ba2');
            }

            if (data.length === 0) {
                costChart.data.labels = ['Vac√≠o'];
                costChart.data.datasets[0].data = [1];
                costChart.data.datasets[0].backgroundColor = ['#e5e7eb'];
            } else {
                costChart.data.labels = labels;
                costChart.data.datasets[0].data = data;
                costChart.data.datasets[0].backgroundColor = colors;
            }

            costChart.update();
        };

        const calculateTotal = () => {
            const hasArea = Object.values(state.selectedItems).some(item => item.type === 'area');
            const hasGarbage = state.selectedItems['basura-5'] || state.selectedItems['basura-10'];

            if (hasArea && !hasGarbage) {
                const garbageCheckbox = document.getElementById('basura-5');
                if (garbageCheckbox) {
                    state.selectedItems['basura-5'] = {
                        id: 'basura-5',
                        price: parseFloat(garbageCheckbox.dataset.price),
                        label: garbageCheckbox.dataset.label,
                        type: 'addon'
                    };
                    garbageCheckbox.checked = true;
                }
            }

            let subtotal = 0;
            const items = Object.values(state.selectedItems);

            items.forEach(item => {
                const quantity = item.quantity || 1;
                subtotal += item.price * quantity;
            });
            
            if (items.length > 0) {
                state.totalCost = ACTIVATION_FEE + subtotal;
            } else {
                state.totalCost = 0;
            }
            
            state.costPerPerson = state.totalCost > 0 ? state.totalCost / state.roommatesCount : 0;
            updateUI();
        };
        
        const handleCheckboxChange = (e) => {
            const checkbox = e.target;
            const id = checkbox.id;
            const price = parseFloat(checkbox.dataset.price);
            const label = checkbox.dataset.label;
            const type = checkbox.dataset.type;
            const groupContainer = checkbox.closest('.addon-group');

            if (groupContainer) {
                const groupName = groupContainer.dataset.groupName;
                const otherCheckboxes = groupContainer.querySelectorAll(`input[type="checkbox"]:not(#${id})`);
                
                if (checkbox.checked) {
                    otherCheckboxes.forEach(other => {
                        if (other.checked) {
                            other.checked = false;
                            delete state.selectedItems[other.id];
                        }
                    });
                }
            }
            
            if (checkbox.checked) {
                state.selectedItems[id] = { id, price, label, type };
            } else {
                delete state.selectedItems[id];
            }

            calculateTotal();
        };

        const setupCounter = (id, stateKey, min, max, label, price, type) => {
            const decrementBtn = document.getElementById(`${id}-decrement`);
            const incrementBtn = document.getElementById(`${id}-increment`);
            const display = document.getElementById(`${id}-display`);

            const update = (newValue) => {
                newValue = Math.max(min, Math.min(newValue, max));
                state[stateKey] = newValue;
                
                if (label && price) {
                    const itemId = id;
                    if (newValue > 0) {
                        state.selectedItems[itemId] = {
                            id: itemId,
                            price: price,
                            label: label,
                            type: type,
                            quantity: newValue
                        };
                    } else {
                        delete state.selectedItems[itemId];
                    }
                }
                calculateTotal();
            };

            decrementBtn.addEventListener('click', () => update(state[stateKey] - 1));
            incrementBtn.addEventListener('click', () => update(state[stateKey] + 1));
        };
        
        const setupRoommatesCounter = () => {
            const decrementBtns = [document.getElementById('roommates-decrement'), document.getElementById('modal-roommates-decrement')];
            const incrementBtns = [document.getElementById('roommates-increment'), document.getElementById('modal-roommates-increment')];
            
            const update = (newValue) => {
                newValue = Math.max(1, Math.min(newValue, 10));
                state.roommatesCount = newValue;
                calculateTotal();
            };

            decrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount - 1)));
            incrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount + 1)));
        };

        const showError = (fieldId, message) => {
            const input = document.getElementById(fieldId);
            const error = document.getElementById(`error${fieldId.charAt(0).toUpperCase() + fieldId.slice(1)}`);
            input.classList.add('error');
            error.textContent = message;
            error.classList.add('show');
        };

        const hideError = (fieldId) => {
            const input = document.getElementById(fieldId);
            const error = document.getElementById(`error${fieldId.charAt(0).toUpperCase() + fieldId.slice(1)}`);
            input.classList.remove('error');
            error.classList.remove('show');
        };

        const validateClientForm = () => {
            let isValid = true;
            const today = new Date().toISOString().split('T')[0];

            const nombre = document.getElementById('nombre');
            if (!nombre.value.trim()) {
                showError('nombre', 'Por favor, ingresa tu nombre completo');
                isValid = false;
            } else {
                hideError('nombre');
            }

            const fields = ['calle', 'portal', 'piso', 'puerta'];
            fields.forEach(field => {
                const input = document.getElementById(field);
                if (!input.value.trim()) {
                    showError(field, field === 'calle' ? 'Por favor, ingresa la calle y n√∫mero' : 'Campo requerido');
                    isValid = false;
                } else {
                    hideError(field);
                }
            });

            const fecha1 = document.getElementById('fecha1');
            const fecha2 = document.getElementById('fecha2');

            if (!fecha1.value) {
                showError('fecha1', 'Selecciona la primera fecha');
                isValid = false;
            } else if (fecha1.value < today) {
                showError('fecha1', 'La fecha no puede ser anterior a hoy');
                isValid = false;
            } else {
                hideError('fecha1');
            }

            if (!fecha2.value) {
                showError('fecha2', 'Selecciona la segunda fecha');
                isValid = false;
            } else if (fecha2.value < today) {
                showError('fecha2', 'La fecha no puede ser anterior a hoy');
                isValid = false;
            } else {
                hideError('fecha2');
            }

            return isValid;
        };
        
        // Helper function to show/hide sections
        const showSection = (sectionId) => {
            document.getElementById('calculator-section').style.display = sectionId === 'calculator' ? 'block' : 'none';
            document.getElementById('client-form-section').classList.toggle('active', sectionId === 'form');
            state.currentSection = sectionId;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const showCalculatorSection = () => {
            showSection('calculator');
        };

        const showClientFormSection = () => {
            if (state.totalCost === 0) {
                alert('Por favor, selecciona al menos un servicio antes de continuar.');
                document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            showSection('form');
        };

        const showFinalSummary = () => {
            const nombre = document.getElementById('nombre').value;
            const calle = document.getElementById('calle').value;
            const portal = document.getElementById('portal').value;
            const piso = document.getElementById('piso').value;
            const puerta = document.getElementById('puerta').value;
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;

            const referralCode = state.referralCode;

            document.getElementById('final-nombre').textContent = nombre;
            document.getElementById('final-direccion').textContent = `${calle}, Portal ${portal}, ${piso}, Puerta ${puerta}`;
            document.getElementById('final-fecha1').textContent = formatDate(fecha1);
            document.getElementById('final-fecha2').textContent = formatDate(fecha2);
            document.getElementById('final-total-cost').textContent = formatCurrency(state.totalCost);
            document.getElementById('final-cost-per-person').textContent = formatCurrency(state.costPerPerson, true);
            document.getElementById('final-roommates-count').textContent = state.roommatesCount;
            document.getElementById('final-roommates-plural').textContent = state.roommatesCount === 1 ? '' : 's';

            if (referralCode) {
                document.getElementById('final-referral-code').textContent = referralCode;
                document.getElementById('referral-code-section').style.display = 'block';
            } else {
                document.getElementById('referral-code-section').style.display = 'none';
            }

            const servicesList = document.getElementById('final-services-list');
            servicesList.innerHTML = '';

            const areas = Object.values(state.selectedItems).filter(item => item.type === 'area');
            const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon');

            [...areas, ...addons].forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'summary-item';
                const quantityText = item.quantity > 1 ? ` (x${item.quantity})` : '';
                const totalItemPrice = item.price * (item.quantity || 1);
                itemDiv.innerHTML = `
                    <span class="summary-item-label">${item.label}${quantityText}</span>
                    <span class="summary-item-value">${formatCurrency(totalItemPrice)}</span>
                `;
                servicesList.appendChild(itemDiv);
            });

            document.getElementById('final-summary-modal').classList.add('open');
        };

        const sendWhatsAppMessage = () => {
            const nombre = document.getElementById('nombre').value;
            const calle = document.getElementById('calle').value;
            const portal = document.getElementById('portal').value;
            const piso = document.getElementById('piso').value;
            const puerta = document.getElementById('puerta').value;
            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;
            const referralCode = state.referralCode;
            
            let message = "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += "*SOLICITUD DE SERVICIO*\n";
            message += "*PLAN LIMPIEZA10*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
            
            message += "*DATOS DEL CLIENTE*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `Nombre: *${nombre}*\n`;
            message += `Direcci√≥n: *${calle}*\n`;
            message += `Portal: *${portal}* | Piso: *${piso}* | Puerta: *${puerta}*\n`;
            message += `Ciudad: *Valencia capital*\n\n`;

            message += "*FECHAS DISPONIBLES*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `Primera opci√≥n: *${formatDate(fecha1)}*\n`;
            message += `Segunda opci√≥n: *${formatDate(fecha2)}*\n\n`;
            
            if (referralCode) {
                message += "*C√ìDIGO DE REFERIDO*\n";
                message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
                message += `C√≥digo: *${referralCode}*\n\n`;
            }

            message += "*DESGLOSE DE SERVICIOS*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `üí≥ Cuota de activaci√≥n: *${formatCurrency(ACTIVATION_FEE)}*\n\n`;
            
            const areas = Object.values(state.selectedItems).filter(i => i.type === 'area');
            if(areas.length > 0) {
                message += "*√Åreas seleccionadas:*\n";
                areas.forEach(item => {
                    const quantityText = item.quantity > 1 ? ` (√ó${item.quantity})` : '';
                    const totalItemPrice = item.price * (item.quantity || 1);
                    message += `  ‚Ä¢ ${item.label}${quantityText}: *${formatCurrency(totalItemPrice)}*\n`;
                });
                message += "\n";
            }

            const addons = Object.values(state.selectedItems).filter(i => i.type === 'addon');
            if(addons.length > 0) {
                message += "*Complementos:*\n";
                addons.forEach(item => {
                    message += `  ‚Ä¢ ${item.label}: *${formatCurrency(item.price)}*\n`;
                });
                message += "\n";
            }
            
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += "*RESUMEN FINANCIERO*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
            message += `Coste total: *${formatCurrency(state.totalCost)}*\n`;
            message += `N√∫mero de personas: *${state.roommatesCount}*\n`;
            message += `Coste por persona: *${formatCurrency(state.costPerPerson, true)}*\n`;
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
            
            message += "‚úì Visita gratuita y sin compromiso\n\n";
            message += "Por favor, confirme la disponibilidad para coordinar la visita.\n\n";
            message += "Gracias por confiar en nuestros servicios.";

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        };

        const initChart = () => {
            const ctx = document.getElementById('costBreakdownChart').getContext('2d');
            costChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vac√≠o'],
                    datasets: [{
                        label: 'Coste',
                        data: [1],
                        backgroundColor: ['#e5e7eb'],
                        borderColor: '#ffffff',
                        borderWidth: 4,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: "'Montserrat', sans-serif",
                                    size: window.innerWidth < 768 ? 12 : 16,
                                    weight: '700'
                                },
                                padding: window.innerWidth < 768 ? 15 : 25,
                                boxWidth: window.innerWidth < 768 ? 15 : 20,
                                usePointStyle: true,
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += formatCurrency(context.parsed, true); 
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        };
        
        const editSection = (section) => {
            // Cerrar el modal de resumen final
            document.getElementById('final-summary-modal').classList.remove('open');
            
            // Navegar a la secci√≥n correspondiente
            switch(section) {
                case 'services':
                    // Volver a la secci√≥n de calculadora
                    showCalculatorSection();
                    // Scroll suave a la secci√≥n de √°reas
                    setTimeout(() => {
                        const areasSection = document.getElementById('areas-section');
                        if (areasSection) {
                            areasSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 300);
                    break;
                    
                case 'client-data':
                    // Volver al formulario de datos del cliente
                    showClientFormSection();
                    // Scroll suave al formulario
                    setTimeout(() => {
                        const formSection = document.getElementById('client-form-section'); // Correct ID
                        if (formSection) {
                            formSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        // Enfocar el primer campo del formulario
                        const nombreInput = document.getElementById('nombre');
                        if (nombreInput) {
                            nombreInput.focus();
                        }
                    }, 300);
                    break;
                    
                case 'dates':
                    // Volver al formulario de fechas
                    showClientFormSection();
                    // Scroll suave a la secci√≥n de fechas
                    setTimeout(() => {
                        const fecha1Input = document.getElementById('fecha1');
                        if (fecha1Input) {
                            fecha1Input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            fecha1Input.focus();
                        }
                    }, 300);
                    break;
            }
        };

        const handleKeyPress = (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                e.currentTarget.click(); // Trigger the onclick event
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            setupCounter('bano', 'banoCount', 0, 10, 'Ba√±os', 10, 'area');
            setupCounter('habitacion', 'habitacionCount', 0, 10, 'Habitaciones', 10, 'area');
            setupRoommatesCounter();

            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });
            
            const openModalBtn = document.getElementById('floating-cart-button');
            const closeModalBtn = document.getElementById('close-modal-button');
            
            openModalBtn.addEventListener('click', () => modal.classList.add('open'));
            closeModalBtn.addEventListener('click', () => modal.classList.remove('open'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('open');
                }
            });
            
            summaryList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const action = button.dataset.action;
                const id = button.dataset.id;

                if (action === 'remove') {
                    document.getElementById(id).checked = false;
                    delete state.selectedItems[id];
                    calculateTotal();
                } else if (action === 'increment' || action === 'decrement') {
                    const isIncrement = action === 'increment';
                    const key = id === 'bano' ? 'banoCount' : 'habitacionCount';
                    
                    let newValue = state[key] + (isIncrement ? 1 : -1);
                    newValue = Math.max(0, Math.min(newValue, 10));

                    state[key] = newValue;

                    if (newValue > 0) {
                        state.selectedItems[id].quantity = newValue;
                    } else {
                        delete state.selectedItems[id];
                    }
                    
                    calculateTotal();
                }
            });

            const mainCouponInput = document.getElementById('main-coupon-code');
            const modalCouponInput = document.getElementById('coupon-code');

            mainCouponInput.addEventListener('input', (e) => {
                state.referralCode = e.target.value.trim().toUpperCase();
                modalCouponInput.value = state.referralCode;
            });

            modalCouponInput.addEventListener('input', (e) => {
                state.referralCode = e.target.value.trim().toUpperCase();
                mainCouponInput.value = state.referralCode;
            });

            document.getElementById('proceed-to-form-btn').addEventListener('click', showClientFormSection);
            document.getElementById('modal-proceed-to-form-btn').addEventListener('click', () => {
                modal.classList.remove('open');
                showClientFormSection();
            });
            document.getElementById('back-to-calculator-btn').addEventListener('click', showCalculatorSection);

            document.getElementById('client-form').addEventListener('submit', (e) => {
                e.preventDefault();
                if (validateClientForm()) {
                    showFinalSummary();
                }
            });

            document.getElementById('cancel-final-summary-btn').addEventListener('click', () => {
                document.getElementById('final-summary-modal').classList.remove('open');
            });

            document.getElementById('send-whatsapp-btn').addEventListener('click', sendWhatsAppMessage);

            document.querySelectorAll('.form-input').forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value.trim()) {
                        hideError(this.id);
                    }
                });
            });

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha1').setAttribute('min', today);
            document.getElementById('fecha2').setAttribute('min', today);

            initChart();
            calculateTotal();

            // A√±adir event listeners para la navegaci√≥n con teclado
            const editableTitles = document.querySelectorAll('.summary-section-title[role="button"]');
            editableTitles.forEach(title => {
                title.addEventListener('keypress', handleKeyPress);
            });
        });
    </script>
</body>
</html>
