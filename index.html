<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora-Limpieza10 | App de Limpieza para Estudiantes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .button-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .button-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        .button-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }
        
        .button-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.6);
            background: linear-gradient(135deg, #ed64a6 0%, #f56565 100%);
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 280px;
        }
        
        .checkbox-label {
            transition: all 0.3s ease-in-out;
            border-radius: 12px;
        }
        
        .checkbox-label:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        input:checked + .checkbox-label {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-color: #667eea;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .is-selected {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .count-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .count-btn {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            width: 2.75rem;
            height: 2.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .count-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .count-display {
            width: 3rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: #1e293b;
        }
        
        #floating-elements-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 50;
        }
        
        #floating-cart-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            width: 4rem;
            height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        #floating-cart-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        #floating-total-cost-display {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 50%;
            padding: 0.4rem 0.6rem;
            font-size: 0.75rem;
            font-weight: 800;
            display: none;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
        }
        
        #floating-total-cost-display.visible {
            display: block;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .modal-overlay.open {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-overlay.open .modal-content {
            transform: scale(1);
        }
        
        .modal-item-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-item-btn {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            width: 2.25rem;
            height: 2.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .modal-item-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }
        
        .modal-remove-btn {
            background: transparent;
            color: #ef4444;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0;
            width: 2.25rem;
            height: 2.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .modal-remove-btn:hover {
            color: #b91c1c;
            background: #fef2f2;
            transform: scale(1.1);
        }
        
        .button {
            display: inline-block;
            padding: 14px 28px;
            font-weight: 600;
            font-size: 16px;
            color: #ffffff;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.6);
            background: linear-gradient(135deg, #ed64a6 0%, #f56565 100%);
        }
        
        .pulsing-button {
            animation: pulse 2s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .main-title {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.01em;
        }
        
        .card-spacing {
            margin-bottom: 1.5rem;
        }
        
        .button-spacing {
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.75rem;
            }
            .section-title {
                font-size: 2rem;
            }
        }
        
        .addon-container {
            margin-bottom: 1.5rem;
            border-radius: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
        }
        
        .addon-container h4 {
            color: #1e293b;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .addon-group {
            gap: 1rem;
        }
        
        .addon-group .checkbox-label {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <!-- Contenedor principal de la página -->
    <main class="container mx-auto px-4 py-8 md:py-12">
        <!-- Cabecera de la página -->
        <header class="text-center mb-16 pt-10">
            <div class="relative max-w-7xl mx-auto flex flex-col items-center">
                <!-- Contenedor de iconos de acceso directo -->
                <div class="flex space-x-6 mb-8 md:absolute md:top-0 md:right-0">
                    <a href="https://te-echounamano.blogspot.com/" target="_blank" title="TUM TeEchoUnaMano Web" class="text-2xl md:text-3xl text-white hover:text-pink-200 transition-all duration-300 hover:scale-110">
                        🏠
                    </a>
                    <a href="https://apm-tum.blogspot.com/" target="_blank" title="Soporte A-TUM" class="text-2xl md:text-3xl text-white hover:text-pink-200 transition-all duration-300 hover:scale-110">
                        🎧
                    </a>
                    <a href="https://t.me/TumAgenda_bot" target="_blank" title="Bot de Telegram" class="text-2xl md:text-3xl text-white hover:text-pink-200 transition-all duration-300 hover:scale-110">
                        🤖
                    </a>
                </div>
                <!-- Contenido principal de la cabecera -->
                <h1 class="main-title text-white mb-6">🧹 Calculadora-Limpieza10</h1>
                <p class="text-xl md:text-2xl text-white max-w-4xl mx-auto leading-relaxed">La limpieza de tu <b>piso de estudiante</b>, solucionada. Es la forma más fácil y económica de mantener vuestro piso limpio. Personaliza tu plan, comparte los gastos y olvídate de discutir por turnos.</p>
            </div>
        </header>

        <!-- Sección "Cómo Funciona" -->
        <section id="how-it-works" class="mb-20">
            <div class="max-w-5xl mx-auto">
                <h2 class="section-title text-center mb-16 text-white">¿Cómo Funciona? Sencillo y Transparente</h2>
                <div class="flex flex-col md:flex-row items-stretch justify-center text-center gap-8">
                    <!-- Paso 1 -->
                    <div class="flex-1 p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full w-20 h-20 flex items-center justify-center text-3xl font-bold mb-6 shadow-xl">1</div>
                        <p class="text-gray-700 text-lg leading-relaxed">Una única cuota de <b>10€</b> te da acceso a un servicio de limpieza completo y a medida. Es tu pase directo a un espacio limpio.</p>
                    </div>
                    <!-- Separador -->
                    <div class="flex justify-center items-center"><div class="h-0.5 w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <!-- Paso 2 -->
                    <div class="flex-1 p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full w-20 h-20 flex items-center justify-center text-3xl font-bold mb-6 shadow-xl">2</div>
                        <p class="text-gray-700 text-lg leading-relaxed">Elige las áreas de tu piso que necesitan un repaso por solo <b>10€</b> cada una y añade los complementos que quieras.</p>
                    </div>
                    <!-- Separador -->
                    <div class="flex justify-center items-center"><div class="h-0.5 w-16 bg-white md:h-16 md:w-0.5"></div></div>
                    <!-- Paso 3 -->
                    <div class="flex-1 p-6 flex flex-col items-center glass-effect rounded-2xl">
                        <div class="bg-gradient-to-br from-green-500 to-emerald-600 text-white rounded-full w-20 h-20 flex items-center justify-center text-3xl font-bold mb-6 shadow-xl">✓</div>
                        <p class="text-gray-700 text-lg leading-relaxed">Disfruta de tu casa impecable y divide el coste total entre tus compañeros de piso. Sin estrés, sin peleas.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección del Simulador -->
        <section id="simulator" class="glass-effect rounded-3xl shadow-2xl p-8 md:p-12 mb-20">
            <h2 class="text-4xl font-bold text-center mb-4 text-gray-800">Diseña tu Limpieza a Medida</h2>
            <p class="text-center text-gray-600 text-lg mb-4">Construye tu paquete de limpieza y mira el coste en tiempo real.</p>
            <p class="text-center text-gray-600 italic max-w-3xl mx-auto mb-12 text-base">Este servicio está diseñado para una <b>limpieza rápida y eficiente</b>. Si necesitas un servicio más profundo, limpieza de ventanas u otras tareas, ofrecemos planes por hora y presupuestos personalizados. ¡Solo tienes que consultarnos!</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
                <!-- Columna de selección de áreas y complementos -->
                <div>
                    <!-- Áreas a limpiar -->
                    <h3 id="areas-section" class="text-2xl font-bold mb-6 text-gray-800">1. Elige las áreas a limpiar (10€ c/u)</h3>
                    <div class="space-y-4 card-spacing">
                        <input type="checkbox" id="salon" class="hidden peer" data-price="10" data-label="Salón / Comedor" data-type="area">
                        <label for="salon" class="checkbox-label cursor-pointer flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🛋️</span>
                                <span class="font-semibold text-lg">Salón / Comedor</span>
                            </div>
                            <span class="text-gray-600 font-bold text-lg">10€</span>
                        </label>
                        
                        <input type="checkbox" id="cocina" class="hidden peer" data-price="10" data-label="Cocina" data-type="area">
                        <label for="cocina" class="checkbox-label cursor-pointer flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🍳</span>
                                <span class="font-semibold text-lg">Cocina</span>
                            </div>
                            <span class="text-gray-600 font-bold text-lg">10€</span>
                        </label>
                        
                        <!-- Contador de baños -->
                        <div id="bano-container" class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🚿</span>
                                <span class="font-semibold text-lg">Baños</span>
                            </div>
                            <div class="count-controls">
                                <button id="bano-decrement" class="count-btn">-</button>
                                <span id="bano-display" class="count-display">0</span>
                                <button id="bano-increment" class="count-btn">+</button>
                            </div>
                        </div>
                        
                        <!-- Contador de habitaciones -->
                        <div id="habitacion-container" class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🛏️</span>
                                <span class="font-semibold text-lg">Habitaciones</span>
                            </div>
                            <div class="count-controls">
                                <button id="habitacion-decrement" class="count-btn">-</button>
                                <span id="habitacion-display" class="count-display">0</span>
                                <button id="habitacion-increment" class="count-btn">+</button>
                            </div>
                        </div>

                        <input type="checkbox" id="lavanderia" class="hidden peer" data-price="10" data-label="Lavandería" data-type="area">
                        <label for="lavanderia" class="checkbox-label cursor-pointer flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🧺</span>
                                <span class="font-semibold text-lg">Lavandería</span>
                            </div>
                            <span class="text-gray-600 font-bold text-lg">10€</span>
                        </label>

                        <input type="checkbox" id="terrazas" class="hidden peer" data-price="10" data-label="Limpieza de Terrazas" data-type="area">
                        <label for="terrazas" class="checkbox-label cursor-pointer flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">☀️</span>
                                <span class="font-semibold text-lg">Limpieza de Terrazas</span>
                            </div>
                            <span class="text-gray-600 font-bold text-lg">10€</span>
                        </label>
                    </div>

                    <!-- Complementos -->
                    <h3 class="text-2xl font-bold mb-6 mt-10 text-gray-800">2. Añade complementos</h3>
                    <div class="space-y-6">
                        <!-- Add-on: Pasillo -->
                        <div class="addon-container p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-4">
                                <span class="text-2xl mr-3">🚪</span>
                                <span class="text-lg">Pasillo (área común)</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="pasillo">
                                <input type="checkbox" id="pasillo-5" class="hidden peer" data-price="5" data-label="Pasillo: menos de 5m²" data-type="addon">
                                <label for="pasillo-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">Menos de 5m²</span>
                                    <span class="text-gray-600 font-bold text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="pasillo-10" class="hidden peer" data-price="10" data-label="Pasillo: 5m² o más" data-type="addon">
                                <label for="pasillo-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">5m² o más</span>
                                    <span class="text-gray-600 font-bold text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Fregar Platos -->
                        <div class="addon-container p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-4">
                                <span class="text-2xl mr-3">🍽️</span>
                                <span class="text-lg">Fregar Platos</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="platos">
                                <input type="checkbox" id="platos-5" class="hidden peer" data-price="5" data-label="Fregar Platos: 1 carga" data-type="addon">
                                <label for="platos-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">1 Carga</span>
                                    <span class="text-gray-600 font-bold text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="platos-10" class="hidden peer" data-price="10" data-label="Fregar Platos: Más de 1 carga" data-type="addon">
                                <label for="platos-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">Más de 1 Carga</span>
                                    <span class="text-gray-600 font-bold text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Limpieza de Mamparas -->
                        <div class="addon-container p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-4">
                                <span class="text-2xl mr-3">🪟</span>
                                <span class="text-lg">Limpieza de Mamparas</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="mamparas">
                                <input type="checkbox" id="mamparas-5" class="hidden peer" data-price="5" data-label="Mamparas: 1-2m" data-type="addon">
                                <label for="mamparas-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">1-2m</span>
                                    <span class="text-gray-600 font-bold text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="mamparas-10" class="hidden peer" data-price="10" data-label="Mamparas: Más de 2m" data-type="addon">
                                <label for="mamparas-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">Más de 2m</span>
                                    <span class="text-gray-600 font-bold text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <!-- Add-on: Recogida de Basura -->
                        <div class="addon-container p-6">
                            <h4 class="font-semibold text-gray-700 flex items-center mb-4">
                                <span class="text-2xl mr-3">🗑️</span>
                                <span class="text-lg">Recogida de Basura</span>
                            </h4>
                            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 addon-group" data-group-name="basura">
                                <input type="checkbox" id="basura-5" class="hidden peer" data-price="5" data-label="Recogida de Basura: 1-2 bolsas" data-type="addon">
                                <label for="basura-5" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">1-2 bolsas</span>
                                    <span class="text-sm text-gray-500 mb-1">(Obligatorio con áreas)</span>
                                    <span class="text-gray-600 font-bold text-lg">5€</span>
                                </label>
                                <input type="checkbox" id="basura-10" class="hidden peer" data-price="10" data-label="Recogida de Basura: Más de 2 bolsas" data-type="addon">
                                <label for="basura-10" class="checkbox-label cursor-pointer flex-1 flex flex-col items-center justify-center p-5 border-2 border-gray-200 rounded-xl">
                                    <span class="font-semibold text-center mb-2 text-lg">Más de 2 bolsas</span>
                                    <span class="text-gray-600 font-bold text-lg">10€</span>
                                </label>
                            </div>
                        </div>
                        <!-- Escalera Add-on -->
                        <input type="checkbox" id="escalera" class="hidden peer" data-price="10" data-label="Limpieza de Escalera" data-type="addon">
                        <label for="escalera" class="checkbox-label cursor-pointer flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🪜</span>
                                <span class="font-semibold text-lg">Limpieza de Escalera</span>
                            </div>
                            <span class="text-gray-600 font-bold text-lg">10€</span>
                        </label>
                    </div>
                </div>

                <!-- Columna de resumen de costes -->
                <div>
                    <!-- Contador de compañeros de piso -->
                    <h3 class="text-2xl font-bold mb-6 text-gray-800">3. ¿Cuántos sois en el piso?</h3>
                    <p class="text-gray-600 text-base mb-6">Si pagas el servicio para ti, selecciona 1 persona. Si sois más, selecciona el número de compañeros para dividir los gastos.</p>
                    <div id="roommates-container" class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl transition-all duration-300 mb-8">
                        <div class="flex items-center">
                            <span class="text-2xl mr-4">👥</span>
                            <span class="font-semibold text-lg">Compañeros</span>
                        </div>
                        <div class="count-controls">
                            <button id="roommates-decrement" class="count-btn">-</button>
                            <span id="roommates-count" class="count-display">1</span>
                            <button id="roommates-increment" class="count-btn">+</button>
                        </div>
                    </div>

                    <!-- Visualización de costes -->
                    <div class="sticky top-6">
                        <div class="grid grid-cols-2 gap-6 mb-8">
                            <div class="p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl text-center border-2 border-blue-200">
                                <p class="text-gray-600 text-sm font-medium mb-2">COSTE TOTAL</p>
                                <p id="total-cost" class="text-4xl font-extrabold text-blue-600">0 €</p>
                            </div>
                            <div class="p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-2xl text-center border-2 border-green-200">
                                <p class="text-gray-600 text-sm font-medium mb-2">COSTE POR PERSONA</p>
                                <p id="cost-per-person" class="text-4xl font-extrabold text-green-600">0,00 €</p>
                            </div>
                        </div>

                        <!-- Gráfico de desglose de costes -->
                        <h3 class="text-2xl font-bold mb-6 text-center text-gray-800">Desglose del Coste</h3>
                        <div class="chart-container">
                            <canvas id="costBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pie de página con el botón de reserva -->
        <footer class="text-center mt-16 mb-20">
            <h3 class="text-3xl md:text-4xl font-bold mb-6 text-white">¿Todo claro?</h3>
            <p class="text-white mb-10 max-w-2xl mx-auto text-lg leading-relaxed">Contacta con nosotros para reservar tu primera limpieza y descubre lo fácil que es tener un piso impecable.</p>
            
            <!-- Campo de Cupón/Código -->
            <div class="max-w-md mx-auto mb-8">
                <label for="main-coupon-code" class="block mb-4 text-lg font-medium text-white">¿Tienes un cupón o código de referido?</label>
                <div class="button-spacing">
                    <a class="button" href="https://teechounamano.github.io/activar-referido/" title="Buy Now">Quiero mi código</a>
                </div>
                <input type="text" id="main-coupon-code" class="bg-white border-2 border-gray-300 text-gray-900 text-lg rounded-2xl focus:ring-4 focus:ring-blue-500 focus:border-blue-500 block w-full p-4 shadow-lg" placeholder="Escribe tu código aquí">
            </div>

            <button id="book-now-btn" class="button-gradient text-white font-bold py-5 px-12 rounded-full hover:bg-pink-600 transition-all duration-300 text-xl shadow-2xl pulsing-button">¡Reservar Mi Limpieza Ahora!</button>
        </footer>
    </main>

    <!-- Botón flotante -->
    <div id="floating-elements-container">
        <button id="floating-cart-button" aria-label="Mostrar resumen de costes">
            <span style="font-size: 1.75rem;">🛒</span>
            <span id="floating-total-cost-display">0 €</span>
        </button>
    </div>

    <!-- Modal para el resumen del pedido -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center pb-6 border-b-2 border-gray-200 mb-6">
                <h3 class="text-3xl font-bold text-gray-800">Resumen de mi pedido</h3>
                <button id="close-modal-button" class="text-gray-400 hover:text-gray-600 transition-colors text-3xl">
                    ✕
                </button>
            </div>
            
            <div>
                <div id="summary-list" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                    <p class="text-gray-500 text-center py-8 text-lg">Aún no has añadido nada. ¡Empieza a configurar tu limpieza!</p>
                </div>
            </div>

            <div id="modal-roommates-container" class="mt-6 p-5 border-2 border-gray-200 rounded-xl transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">👥</span>
                        <span class="font-semibold text-lg">Compañeros</span>
                    </div>
                    <div class="count-controls">
                        <button id="modal-roommates-decrement" class="count-btn">-</button>
                        <span id="modal-roommates-count" class="count-display">1</span>
                        <button id="modal-roommates-increment" class="count-btn">+</button>
                    </div>
                </div>
                <div class="text-center font-bold text-xl text-green-600">
                    <span id="modal-cost-per-person">0,00 €</span> por persona
                </div>
            </div>

            <div class="mt-6">
                <label for="coupon-code" class="block mb-3 text-base font-medium text-gray-700">¿Tienes un cupón o código de referido?</label>
                <input type="text" id="coupon-code" class="bg-gray-50 border-2 border-gray-300 text-gray-900 text-base rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-blue-500 block w-full p-4" placeholder="Escribe tu código aquí">
            </div>

            <div class="mt-6 flex justify-between items-center font-bold text-xl">
                <span class="text-gray-800">Total:</span>
                <span id="summary-total" class="text-blue-600 text-3xl">0,00 €</span>
            </div>
            <button id="modal-book-now-btn" class="mt-8 w-full button-gradient text-white font-bold py-4 px-8 rounded-full hover:bg-pink-600 transition-all duration-300 text-xl shadow-2xl text-center">¡Reservar Mi Limpieza Ahora!</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTES Y CONFIGURACIÓN ---
            const ACTIVATION_FEE = 10;
            const WHATSAPP_NUMBER = '34602846694';

            // --- ESTADO DE LA APLICACIÓN ---
            const state = {
                banoCount: 0,
                habitacionCount: 0,
                roommatesCount: 1,
                selectedItems: {},
                totalCost: 0,
                costPerPerson: 0
            };

            // --- ELEMENTOS DEL DOM ---
            const totalCostDisplay = document.getElementById('total-cost');
            const costPerPersonDisplay = document.getElementById('cost-per-person');
            const floatingCostDisplay = document.getElementById('floating-total-cost-display');
            const summaryList = document.getElementById('summary-list');
            const summaryTotal = document.getElementById('summary-total');
            const modalCostPerPerson = document.getElementById('modal-cost-per-person');
            const modal = document.getElementById('summary-modal');
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            const addonGroups = document.querySelectorAll('.addon-group');
            let costChart;

            // --- FUNCIONES ---
            const formatCurrency = (value, useDecimals = false) => {
                const options = useDecimals ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : { minimumFractionDigits: 0, maximumFractionDigits: 0 };
                return value.toLocaleString('es-ES', options) + ' €';
            };

            const updateUI = () => {
                totalCostDisplay.textContent = formatCurrency(state.totalCost);
                costPerPersonDisplay.textContent = formatCurrency(state.costPerPerson, true);
                summaryTotal.textContent = formatCurrency(state.totalCost, true);
                modalCostPerPerson.textContent = formatCurrency(state.costPerPerson, true);

                if (state.totalCost > 0) {
                    floatingCostDisplay.textContent = formatCurrency(state.totalCost);
                    floatingCostDisplay.classList.add('visible');
                } else {
                    floatingCostDisplay.classList.remove('visible');
                }

                document.getElementById('bano-display').textContent = state.banoCount;
                document.getElementById('habitacion-display').textContent = state.habitacionCount;
                document.getElementById('roommates-count').textContent = state.roommatesCount;
                document.getElementById('modal-roommates-count').textContent = state.roommatesCount;

                document.getElementById('bano-container').classList.toggle('is-selected', state.banoCount > 0);
                document.getElementById('habitacion-container').classList.toggle('is-selected', state.habitacionCount > 0);
                
                updateSummaryList();
                updateChart();
            };
            
            const updateSummaryList = () => {
                summaryList.innerHTML = '';

                if (state.totalCost === 0) {
                    summaryList.innerHTML = '<p class="text-gray-500 text-center py-8 text-lg">Aún no has añadido nada. ¡Empieza a configurar tu limpieza!</p>';
                    return;
                }

                const areas = Object.values(state.selectedItems).filter(item => item.type === 'area').sort((a,b) => a.label.localeCompare(b.label));
                const addons = Object.values(state.selectedItems).filter(item => item.type === 'addon').sort((a,b) => a.label.localeCompare(b.label));

                const createItemNode = (item) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center py-3 px-4 bg-gray-50 rounded-lg';
                    
                    let controls = '';
                    if (item.id === 'bano' || item.id === 'habitacion') {
                        controls = `
                            <div class="modal-item-controls">
                                <button class="modal-item-btn" data-action="decrement" data-id="${item.id}">-</button>
                                <span class="font-bold w-8 text-center">${item.quantity}</span>
                                <button class="modal-item-btn" data-action="increment" data-id="${item.id}">+</button>
                            </div>
                        `;
                    } else {
                        controls = `<button class="modal-remove-btn" data-action="remove" data-id="${item.id}">🗑️</button>`;
                    }
                    
                    const totalItemPrice = item.price * (item.quantity || 1);

                    itemElement.innerHTML = `
                        <div class="flex-grow pr-4">
                            <p class="font-semibold text-lg">${item.label}</p>
                            ${item.quantity > 1 ? `<p class="text-sm text-gray-500">${item.quantity} x ${formatCurrency(item.price)}</p>` : ''}
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-bold text-gray-700 w-20 text-right text-lg">${formatCurrency(totalItemPrice)}</span>
                            ${controls}
                        </div>
                    `;
                    return itemElement;
                };

                if (areas.length > 0) {
                    const container = document.createElement('div');
                    container.className = 'p-4 border-2 border-gray-200 rounded-xl mb-4';
                    const title = document.createElement('h4');
                    title.className = 'font-bold text-lg text-gray-700 mb-3 pb-2 border-b-2';
                    title.textContent = 'Áreas';
                    container.appendChild(title);
                    areas.forEach(item => container.appendChild(createItemNode(item)));
                    summaryList.appendChild(container);
                }

                if (addons.length > 0) {
                    const container = document.createElement('div');
                    container.className = 'p-4 border-2 border-gray-200 rounded-xl mb-4';
                    const title = document.createElement('h4');
                    title.className = 'font-bold text-lg text-gray-700 mb-3 pb-2 border-b-2';
                    title.textContent = 'Complementos';
                    container.appendChild(title);
                    addons.forEach(item => container.appendChild(createItemNode(item)));
                    summaryList.appendChild(container);
                }

                const feeContainer = document.createElement('div');
                feeContainer.className = 'p-4 border-2 border-gray-200 rounded-xl';
                feeContainer.innerHTML = `
                    <div class="flex justify-between items-center">
                        <p class="font-semibold text-lg">Cuota de activación</p>
                        <span class="font-bold text-gray-700 text-lg">${formatCurrency(ACTIVATION_FEE)}</span>
                    </div>
                `;
                summaryList.appendChild(feeContainer);
            };

            const updateChart = () => {
                if (!costChart) return;
                
                const hasItems = Object.keys(state.selectedItems).length > 0 || state.totalCost > 0;
                const labels = [];
                const data = [];
                const colors = [];

                if (hasItems) {
                    labels.push('Cuota Fija');
                    data.push(ACTIVATION_FEE);
                    colors.push('#f093fb');
                }

                const areasCost = Object.values(state.selectedItems)
                    .filter(item => item.type === 'area')
                    .reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

                if (areasCost > 0) {
                    labels.push('Áreas');
                    data.push(areasCost);
                    colors.push('#667eea');
                }

                const addonsCost = Object.values(state.selectedItems)
                    .filter(item => item.type === 'addon')
                    .reduce((sum, item) => sum + item.price, 0);

                if (addonsCost > 0) {
                    labels.push('Complementos');
                    data.push(addonsCost);
                    colors.push('#4ade80');
                }

                if (data.length === 0) {
                    costChart.data.labels = ['Vacío'];
                    costChart.data.datasets[0].data = [1];
                    costChart.data.datasets[0].backgroundColor = ['#e5e7eb'];
                } else {
                    costChart.data.labels = labels;
                    costChart.data.datasets[0].data = data;
                    costChart.data.datasets[0].backgroundColor = colors;
                }

                costChart.update();
            };

            const calculateTotal = () => {
                const hasArea = Object.values(state.selectedItems).some(item => item.type === 'area');
                const hasGarbage = state.selectedItems['basura-5'] || state.selectedItems['basura-10'];

                if (hasArea && !hasGarbage) {
                    const garbageCheckbox = document.getElementById('basura-5');
                    if (garbageCheckbox) {
                        state.selectedItems['basura-5'] = {
                            id: 'basura-5',
                            price: parseFloat(garbageCheckbox.dataset.price),
                            label: garbageCheckbox.dataset.label,
                            type: 'addon'
                        };
                        garbageCheckbox.checked = true;
                    }
                }

                let subtotal = 0;
                const items = Object.values(state.selectedItems);

                items.forEach(item => {
                    const quantity = item.quantity || 1;
                    subtotal += item.price * quantity;
                });
                
                if (items.length > 0) {
                    state.totalCost = ACTIVATION_FEE + subtotal;
                } else {
                    state.totalCost = 0;
                }
                
                state.costPerPerson = state.totalCost > 0 ? state.totalCost / state.roommatesCount : 0;
                updateUI();
            };
            
            const handleCheckboxChange = (e) => {
                const checkbox = e.target;
                const id = checkbox.id;
                const price = parseFloat(checkbox.dataset.price);
                const label = checkbox.dataset.label;
                const type = checkbox.dataset.type;
                const groupContainer = checkbox.closest('.addon-group');

                if (groupContainer) {
                    const groupName = groupContainer.dataset.groupName;
                    const otherCheckboxes = groupContainer.querySelectorAll(`input[type="checkbox"]:not(#${id})`);
                    
                    if (checkbox.checked) {
                        otherCheckboxes.forEach(other => {
                            if (other.checked) {
                                other.checked = false;
                                delete state.selectedItems[other.id];
                            }
                        });
                    }
                }
                
                if (checkbox.checked) {
                    state.selectedItems[id] = { id, price, label, type };
                } else {
                    delete state.selectedItems[id];
                }

                calculateTotal();
            };

            const setupCounter = (id, stateKey, min, max, label, price, type) => {
                const decrementBtn = document.getElementById(`${id}-decrement`);
                const incrementBtn = document.getElementById(`${id}-increment`);
                const display = document.getElementById(`${id}-display`);

                const update = (newValue) => {
                    newValue = Math.max(min, Math.min(newValue, max));
                    state[stateKey] = newValue;
                    
                    if (label && price) {
                        const itemId = id;
                        if (newValue > 0) {
                            state.selectedItems[itemId] = {
                                id: itemId,
                                price: price,
                                label: label,
                                type: type,
                                quantity: newValue
                            };
                        } else {
                            delete state.selectedItems[itemId];
                        }
                    }
                    calculateTotal();
                };

                decrementBtn.addEventListener('click', () => update(state[stateKey] - 1));
                incrementBtn.addEventListener('click', () => update(state[stateKey] + 1));
            };
            
            const setupRoommatesCounter = () => {
                const decrementBtns = [document.getElementById('roommates-decrement'), document.getElementById('modal-roommates-decrement')];
                const incrementBtns = [document.getElementById('roommates-increment'), document.getElementById('modal-roommates-increment')];
                
                const update = (newValue) => {
                    newValue = Math.max(1, Math.min(newValue, 10));
                    state.roommatesCount = newValue;
                    calculateTotal();
                };

                decrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount - 1)));
                incrementBtns.forEach(btn => btn.addEventListener('click', () => update(state.roommatesCount + 1)));
            };

            const generateWhatsAppMessage = () => {
                if (state.totalCost === 0) {
                    alert('Por favor, selecciona al menos un servicio para continuar.');
                    document.getElementById('areas-section').scrollIntoView({ behavior: 'smooth' });
                    return;
                }

                const modalCoupon = document.getElementById('coupon-code').value.trim();
                const mainCoupon = document.getElementById('main-coupon-code').value.trim();
                const couponCode = mainCoupon || modalCoupon;
                
                let message = "Hola! 👋 Me gustaría reservar una limpieza con Plan-Limpieza10 con la siguiente configuración:\n\n";
                
                message += `*CUOTA DE ACTIVACIÓN:* ${formatCurrency(ACTIVATION_FEE)}\n`;
                
                const areas = Object.values(state.selectedItems).filter(i => i.type === 'area');
                if(areas.length > 0) {
                    message += "\n*ÁREAS SELECCIONADAS:*\n";
                    areas.forEach(item => {
                        const quantityText = item.quantity > 0 ? ` (x${item.quantity})` : '';
                        message += `- ${item.label}${quantityText}\n`;
                    });
                }

                const addons = Object.values(state.selectedItems).filter(i => i.type === 'addon');
                if(addons.length > 0) {
                    message += "\n*COMPLEMENTOS:*\n";
                    addons.forEach(item => {
                        message += `- ${item.label}\n`;
                    });
                }
                
                message += "\n----------------------------------\n";
                if (couponCode) {
                    message += `*CUPÓN/CÓDIGO:* ${couponCode}\n`;
                }
                message += `*COSTE TOTAL:* ${formatCurrency(state.totalCost)}\n`;
                message += `*Nº de Compañeros:* ${state.roommatesCount}\n`;
                message += `*COSTE POR PERSONA:* ${formatCurrency(state.costPerPerson, true)}\n\n`;
                message += "Por favor, confirmadme la disponibilidad. Gracias!";

                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
            };

            const initChart = () => {
                const ctx = document.getElementById('costBreakdownChart').getContext('2d');
                costChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Vacío'],
                        datasets: [{
                            label: 'Coste',
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderColor: '#ffffff',
                            borderWidth: 4,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: "'Inter', sans-serif",
                                        size: 16,
                                        weight: '600'
                                    },
                                    padding: 25,
                                    boxWidth: 20,
                                    usePointStyle: true,
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += formatCurrency(context.parsed, true); 
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            };

            // --- INICIALIZACIÓN Y EVENT LISTENERS ---
            setupCounter('bano', 'banoCount', 0, 10, 'Baños', 10, 'area');
            setupCounter('habitacion', 'habitacionCount', 0, 10, 'Habitaciones', 10, 'area');
            setupRoommatesCounter();

            allCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });
            
            const openModalBtn = document.getElementById('floating-cart-button');
            const closeModalBtn = document.getElementById('close-modal-button');
            
            openModalBtn.addEventListener('click', () => modal.classList.add('open'));
            closeModalBtn.addEventListener('click', () => modal.classList.remove('open'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('open');
                }
            });
            
            summaryList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const action = button.dataset.action;
                const id = button.dataset.id;

                if (action === 'remove') {
                    document.getElementById(id).checked = false;
                    delete state.selectedItems[id];
                    calculateTotal();
                } else if (action === 'increment' || action === 'decrement') {
                    const isIncrement = action === 'increment';
                    const key = id === 'bano' ? 'banoCount' : 'habitacionCount';
                    
                    let newValue = state[key] + (isIncrement ? 1 : -1);
                    newValue = Math.max(0, Math.min(newValue, 10));

                    state[key] = newValue;

                    if (newValue > 0) {
                        state.selectedItems[id].quantity = newValue;
                    } else {
                        delete state.selectedItems[id];
                    }
                    
                    calculateTotal();
                }
            });

            document.getElementById('book-now-btn').addEventListener('click', generateWhatsAppMessage);
            document.getElementById('modal-book-now-btn').addEventListener('click', generateWhatsAppMessage);

            initChart();
            calculateTotal();
        });
    </script>
</body>
</html>